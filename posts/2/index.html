
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>stafwag Blog</title>
  <meta name="author" content="staf wagemakers">

  
  <meta name="description" content="Install Arch on an Encrypted Btrfs Partition Aug 30th, 2016 8:59 am I&rsquo;m preparing to move my workstation to arch linux Before I&rsquo;ll &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://stafwag.github.io/blog/posts/2/">
  <link href="/blog/favicon.png" rel="icon">
  <link href="/blog/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/blog/atom.xml" rel="alternate" title="stafwag Blog" type="application/atom+xml">
  <script src="/blog/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/blog/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-37258385-2']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/blog/">stafwag Blog</a></h1>
  
    <h2>staf wagemakers blog</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/blog/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="stafwag.github.io/blog">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/blog/">Blog</a></li>
  <li><a href="/blog/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2016/08/30/arch-on-an-encrypted-btrfs-partition/">Install Arch on an Encrypted Btrfs Partition</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-08-30T08:59:00+02:00'><span class='date'><span class='date-month'>Aug</span> <span class='date-day'>30</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>8:59 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img class="right" src="/blog/images/Arch-linux-logo.png" width="300" height="225" title="&#34;Arch Linux Logo&#34;" alt="&#34;Arch Linux Logo&#34;"></p>

<p>I&rsquo;m preparing to move <a href="http://stafwag.github.io/blog/blog/2013/08/25/the-benefits-of-stopping-smoking-dot-dot-dot/">my workstation</a> to <a href="https://www.archlinux.org/">arch linux</a> Before I&rsquo;ll install it on my physical workstation I did the installation on a virtual machine. I&rsquo;ll use <a href="https://btrfs.wiki.kernel.org/index.php/Main_Page">btrfs</a> as the filesystem during the installation. btrfs is a nice filesystem but it had some serious dataloss issue with <a href="https://btrfs.wiki.kernel.org/index.php/RAID56">RAID5/RAID6</a> recently.</p>

<p>btrfs might not stable enough for a production environment but it has some nice features like snapshots, send/recieve, compression etc. I use <a href="http://www.open-zfs.org/wiki/Main_Page">zfs</a> for my important date anyway.</p>

<h2>To encrypt or not to encrypt&hellip;</h2>

<p>It&rsquo;s possible to encrypt your boot partition <a href="https://www.gnu.org/software/grub/">grub</a> has support for <a href="https://en.wikipedia.org/wiki/Linux_Unified_Key_Setup">luks</a> volumes. This cause grub to ask for a password during the system startup you&rsquo;ll need to type in your password a second time during the system startup when you Linux initrd image is booted. It&rsquo;s possible to avoid this by adding a keyfile to your crypttab - which migh be considered as a security risk -.</p>

<p>In this howto we&rsquo;ll setup a single root partition to have full disk encryption. I&rsquo;m not sure I go with an encrypted boot partition during my final installation. I might just create an empty partition of 1G so I can move switch between an encrypted and an non-encrypted boot filesystem.</p>

<p><img class="left" src="/blog/images/arch-on-an-encrypted-btrfs-partition/00_boot.png" width="440" title="&#34;00_boot.png&#34;" alt="&#34;00_boot.png&#34;"></p>

<h2>Download the arch linux iso and boot it</h2>

<p>After arch linux is booted verify that you have internet access if the network card is support and dchp is enabled on you network you should get a network address.</p>

<h2>Network access</h2>

<p>To setup the system remotely we first need to setup network to our system.</p>

<h3>Verify the interface</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@archiso ~ # ip a
</span><span class='line'>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default 
</span><span class='line'>    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
</span><span class='line'>    inet 127.0.0.1/8 scope host lo
</span><span class='line'>       valid_lft forever preferred_lft forever
</span><span class='line'>    inet6 ::1/128 scope host 
</span><span class='line'>       valid_lft forever preferred_lft forever
</span><span class='line'>2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000
</span><span class='line'>    link/ether 52:54:00:69:d4:94 brd ff:ff:ff:ff:ff:ff
</span><span class='line'>    inet 192.168.122.23/24 brd 192.168.122.255 scope global eth0
</span><span class='line'>       valid_lft forever preferred_lft forever
</span><span class='line'>    inet6 fe80::a7b:481f:2f70:e688/64 scope link 
</span><span class='line'>       valid_lft forever preferred_lft forever
</span><span class='line'>root@archiso ~ # </span></code></pre></td></tr></table></div></figure>


<h3>Verify internet access</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@archiso ~ # ping -c 3 8.8.8.8                                                                                      :(
</span><span class='line'>PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data.
</span><span class='line'>64 bytes from 8.8.8.8: icmp_seq=1 ttl=49 time=49.2 ms
</span><span class='line'>64 bytes from 8.8.8.8: icmp_seq=2 ttl=49 time=45.8 ms
</span><span class='line'>64 bytes from 8.8.8.8: icmp_seq=3 ttl=49 time=46.8 ms
</span><span class='line'>
</span><span class='line'>--- 8.8.8.8 ping statistics ---
</span><span class='line'>3 packets transmitted, 3 received, 0% packet loss, time 2003ms
</span><span class='line'>rtt min/avg/max/mdev = 45.896/47.329/49.201/1.406 ms
</span><span class='line'>root@archiso ~ # nslookup www.google.be
</span><span class='line'>Server:         192.168.122.1
</span><span class='line'>Address:        192.168.122.1#53
</span><span class='line'>
</span><span class='line'>Non-authoritative answer:
</span><span class='line'>Name:   www.google.be
</span><span class='line'>Address: 64.233.167.94
</span><span class='line'>
</span><span class='line'>root@archiso ~ # ping www.google.be
</span><span class='line'>PING www.google.be (64.233.167.94) 56(84) bytes of data.
</span><span class='line'>64 bytes from wl-in-f94.1e100.net (64.233.167.94): icmp_seq=1 ttl=46 time=58.7 ms
</span><span class='line'>64 bytes from wl-in-f94.1e100.net (64.233.167.94): icmp_seq=2 ttl=46 time=58.7 ms
</span><span class='line'>64 bytes from wl-in-f94.1e100.net (64.233.167.94): icmp_seq=3 ttl=46 time=58.4 ms
</span><span class='line'>^C
</span><span class='line'>--- www.google.be ping statistics ---
</span><span class='line'>3 packets transmitted, 3 received, 0% packet loss, time 2000ms
</span><span class='line'>rtt min/avg/max/mdev = 58.479/58.645/58.742/0.230 ms
</span><span class='line'>root@archiso ~ #                   
</span></code></pre></td></tr></table></div></figure>


<h2>ssh access</h2>

<p>If you want to install arch linux over ssh you need to assign a root passwd and start the sshd service.</p>

<h3>root password</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@archiso ~ # passwd root       
</span><span class='line'>Enter new UNIX password: 
</span><span class='line'>Retype new UNIX password: 
</span><span class='line'>passwd: password updated successfully
</span><span class='line'>root@archiso ~ # </span></code></pre></td></tr></table></div></figure>


<h3>start sshd</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@archiso ~ # systemctl list-unit-files -t service | grep ssh
</span><span class='line'>sshd.service                               disabled
</span><span class='line'>sshd@.service                              static  
</span><span class='line'>sshdgenkeys.service                        static  
</span><span class='line'>root@archiso ~ # systemctl start sshd                           
</span><span class='line'>root@archiso ~ #
</span></code></pre></td></tr></table></div></figure>


<h3>Logon remotely</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[staf@vicky ~]$ ssh -l root 192.168.122.23
</span><span class='line'>root@192.168.122.23's password: 
</span><span class='line'>Last login: Tue Jun 30 09:06:00 2015 from 192.168.122.1
</span><span class='line'>root@archiso ~ # </span></code></pre></td></tr></table></div></figure>


<h2>Partition</h2>

<h3>Find your harddisk device name</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@archiso ~ # cat /proc/partitions
</span><span class='line'>major minor  #blocks  name
</span><span class='line'>
</span><span class='line'>   8        0  268435456 sda
</span><span class='line'>  11        0     759808 sr0
</span><span class='line'>   7        0     328616 loop0
</span><span class='line'>root@archiso ~ # </span></code></pre></td></tr></table></div></figure>


<h3>Overwrite it with random data</h3>

<p>Because we are creating an ecrypted filesystem it&rsquo;s a good idea to overwrite it with random data.</p>

<p>We&rsquo;ll use badblocks for this another method is to use &ldquo;dd if=/dev/random of=/dev/xxx&rdquo; the &ldquo;dd&rdquo; method is probably the best method but is a lot slower.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@archiso ~ # badblocks -c 10240 -s -w -t random -v /dev/sda
</span><span class='line'>Checking for bad blocks in read-write mode
</span><span class='line'>From block 0 to 268435455
</span><span class='line'>Testing with random pattern: done                                                 
</span><span class='line'>Reading and comparing: done                                                 
</span><span class='line'>Pass completed, 0 bad blocks found. (0/0/0 errors)
</span><span class='line'>badblocks -c 10240 -s -w -t random -v /dev/sda  49.22s user 21.72s system 3% cpu 33:48.40 total
</span><span class='line'>root@archiso ~ # </span></code></pre></td></tr></table></div></figure>


<h3>Partition the harddisk</h3>

<p>Create 3 partitions:</p>

<ul>
<li>1G /boot (we&rsquo;ll not use this during the installation - see above - )</li>
<li>32G swap</li>
<li>root btrfs partition</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@archiso ~ # fdisk /dev/sda                                
</span><span class='line'>
</span><span class='line'>Welcome to fdisk (util-linux 2.28).                                                    
</span><span class='line'>Changes will remain in memory only, until you decide to write them.
</span><span class='line'>Be careful before using the write command.
</span><span class='line'>
</span><span class='line'>Device does not contain a recognized partition table.
</span><span class='line'>Created a new DOS disklabel with disk identifier 0x7ff944e5.
</span><span class='line'>
</span><span class='line'>Command (m for help): p
</span><span class='line'>Disk /dev/sda: 256 GiB, 274877906944 bytes, 536870912 sectors
</span><span class='line'>Units: sectors of 1 * 512 = 512 bytes
</span><span class='line'>Sector size (logical/physical): 512 bytes / 512 bytes
</span><span class='line'>I/O size (minimum/optimal): 512 bytes / 512 bytes
</span><span class='line'>Disklabel type: dos
</span><span class='line'>Disk identifier: 0x7ff944e5
</span><span class='line'>
</span><span class='line'>Command (m for help): n
</span><span class='line'>Partition type
</span><span class='line'>   p   primary (0 primary, 0 extended, 4 free)
</span><span class='line'>   e   extended (container for logical partitions)
</span><span class='line'>Select (default p): p
</span><span class='line'>Partition number (1-4, default 1): 1
</span><span class='line'>First sector (2048-536870911, default 2048): +1G
</span><span class='line'>Value out of range.
</span><span class='line'>First sector (2048-536870911, default 2048): 
</span><span class='line'>Last sector, +sectors or +size{K,M,G,T,P} (2048-536870911, default 536870911): 
</span><span class='line'>Do you really want to quit? y
</span><span class='line'>1 root@archiso ~ # fdisk /dev/sda                                                   :(
</span><span class='line'>
</span><span class='line'>Welcome to fdisk (util-linux 2.28).                                                    
</span><span class='line'>Changes will remain in memory only, until you decide to write them.
</span><span class='line'>Be careful before using the write command.
</span><span class='line'>
</span><span class='line'>Device does not contain a recognized partition table.
</span><span class='line'>Created a new DOS disklabel with disk identifier 0xa806e281.
</span><span class='line'>
</span><span class='line'>Command (m for help): p
</span><span class='line'>Disk /dev/sda: 256 GiB, 274877906944 bytes, 536870912 sectors
</span><span class='line'>Units: sectors of 1 * 512 = 512 bytes
</span><span class='line'>Sector size (logical/physical): 512 bytes / 512 bytes
</span><span class='line'>I/O size (minimum/optimal): 512 bytes / 512 bytes
</span><span class='line'>Disklabel type: dos
</span><span class='line'>Disk identifier: 0xa806e281
</span><span class='line'>
</span><span class='line'>Command (m for help): n
</span><span class='line'>Partition type
</span><span class='line'>   p   primary (0 primary, 0 extended, 4 free)
</span><span class='line'>   e   extended (container for logical partitions)
</span><span class='line'>Select (default p): p
</span><span class='line'>Partition number (1-4, default 1): 1
</span><span class='line'>First sector (2048-536870911, default 2048): 
</span><span class='line'>Last sector, +sectors or +size{K,M,G,T,P} (2048-536870911, default 536870911): +1G
</span><span class='line'>
</span><span class='line'>Created a new partition 1 of type 'Linux' and of size 1 GiB.
</span><span class='line'>
</span><span class='line'>Command (m for help): n
</span><span class='line'>Partition type
</span><span class='line'>   p   primary (1 primary, 0 extended, 3 free)
</span><span class='line'>   e   extended (container for logical partitions)
</span><span class='line'>Select (default p): p
</span><span class='line'>Partition number (2-4, default 2): 
</span><span class='line'>First sector (2099200-536870911, default 2099200): 
</span><span class='line'>Last sector, +sectors or +size{K,M,G,T,P} (2099200-536870911, default 536870911): +32G
</span><span class='line'>
</span><span class='line'>Created a new partition 2 of type 'Linux' and of size 32 GiB.
</span><span class='line'>
</span><span class='line'>Command (m for help): n
</span><span class='line'>Partition type
</span><span class='line'>   p   primary (2 primary, 0 extended, 2 free)
</span><span class='line'>   e   extended (container for logical partitions)
</span><span class='line'>Select (default p): p
</span><span class='line'>Partition number (3,4, default 3): 
</span><span class='line'>First sector (69208064-536870911, default 69208064): 
</span><span class='line'>Last sector, +sectors or +size{K,M,G,T,P} (69208064-536870911, default 536870911): 
</span><span class='line'>
</span><span class='line'>Created a new partition 3 of type 'Linux' and of size 223 GiB.
</span><span class='line'>
</span><span class='line'>Command (m for help): w
</span><span class='line'>The partition table has been altered.
</span><span class='line'>Calling ioctl() to re-read partition table.
</span><span class='line'>Syncing disks.
</span><span class='line'>
</span><span class='line'>root@archiso ~ # </span></code></pre></td></tr></table></div></figure>


<h3>Format the root partition</h3>

<p>We&rsquo;ll continue with the root filesystem - we&rsquo;ll initialize the swapspace after the installation -</p>

<h4>Create the root luks volume;</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@archiso ~ # cryptsetup luksFormat --cipher aes-xts-plain64 --key-size 256 --hash sha256 --use-random /dev/sda3
</span><span class='line'>
</span><span class='line'>WARNING!
</span><span class='line'>========
</span><span class='line'>This will overwrite data on /dev/sda3 irrevocably.
</span><span class='line'>
</span><span class='line'>Are you sure? (Type uppercase yes): YES
</span><span class='line'>Enter passphrase: 
</span><span class='line'>Verify passphrase: 
</span><span class='line'>5.01s user 0.04s system 21% cpu 23.750 total
</span><span class='line'>root@archiso ~ # </span></code></pre></td></tr></table></div></figure>


<h4>Open the root luks volume</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@archiso ~ # cryptsetup luksOpen /dev/sda3 cryptroot
</span><span class='line'>Enter passphrase for /dev/sda3: 
</span><span class='line'>root@archiso ~ # </span></code></pre></td></tr></table></div></figure>


<h4>Format the root volume with btrfs</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@archiso ~ # mkfs.btrfs /dev/mapper/cryptroot
</span><span class='line'>btrfs-progs v4.6.1
</span><span class='line'>See http://btrfs.wiki.kernel.org for more information.
</span><span class='line'>
</span><span class='line'>Label:              (null)
</span><span class='line'>UUID:               cbfcc8d6-0cf9-4656-bcda-2525faeadfe6
</span><span class='line'>Node size:          16384
</span><span class='line'>Sector size:        4096
</span><span class='line'>Filesystem size:    217.00GiB
</span><span class='line'>Block group profiles:
</span><span class='line'>  Data:             single            8.00MiB
</span><span class='line'>  Metadata:         DUP               1.01GiB
</span><span class='line'>  System:           DUP              12.00MiB
</span><span class='line'>SSD detected:       no
</span><span class='line'>Incompat features:  extref, skinny-metadata
</span><span class='line'>Number of devices:  1
</span><span class='line'>Devices:
</span><span class='line'>   ID        SIZE  PATH
</span><span class='line'>    1   217.00GiB  /dev/mapper/cryptroot
</span><span class='line'>
</span><span class='line'>root@archiso ~ # </span></code></pre></td></tr></table></div></figure>


<h4>Mount the root filesystem</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@archiso ~ # mount -o noatime,compress=lzo,discard,ssd,defaults /dev/mapper/cryptroot /mnt
</span><span class='line'>root@archiso ~ # </span></code></pre></td></tr></table></div></figure>


<h4>Create the subvolumes</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@archiso ~ # cd /mnt
</span><span class='line'>root@archiso /mnt # btrfs subvolume create __active
</span><span class='line'>Create subvolume './__active'
</span><span class='line'>root@archiso /mnt # btrfs subvolume create __active/rootvol
</span><span class='line'>Create subvolume '__active/rootvol'
</span><span class='line'>root@archiso /mnt # btrfs subvolume create __active/home
</span><span class='line'>Create subvolume '__active/home'
</span><span class='line'>root@archiso /mnt # btrfs subvolume create __active/var
</span><span class='line'>Create subvolume '__active/var'
</span><span class='line'>root@archiso /mnt # btrfs subvolume create __snapshots
</span><span class='line'>Create subvolume './__snapshots'
</span><span class='line'>root@archiso /mnt #</span></code></pre></td></tr></table></div></figure>


<h4>Mount the subvolumes</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@archiso /mnt # cd 
</span><span class='line'>root@archiso ~ # umount /mnt
</span><span class='line'>root@archiso ~ # mount -o noatime,compress=lzo,discard,ssd,defaults,subvol=__active/rootvol /dev/mapper/cryptroot /mnt
</span><span class='line'>root@archiso ~ # mkdir /mnt/{home,var}
</span><span class='line'>root@archiso ~ # mount -o noatime,compress=lzo,discard,ssd,defaults,subvol=__active/home /dev/mapper/cryptroot /mnt/home
</span><span class='line'>root@archiso ~ # mount -o noatime,compress=lzo,discard,ssd,defaults,subvol=__active/var /dev/mapper/cryptroot /mnt/var
</span><span class='line'>root@archiso ~ # sync
</span><span class='line'>root@archiso ~ # </span></code></pre></td></tr></table></div></figure>


<h2>System installation</h2>

<h3>bootstrap the system</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@archiso ~ # pacstrap /mnt base base-devel btrfs-progs
</span><span class='line'>==&gt; Creating install root at /mnt
</span><span class='line'>==&gt; Installing packages to /mnt
</span><span class='line'>:: Synchronizing package databases...
</span><span class='line'> core                     119.9 KiB   652K/s 00:00 [######################] 100%
</span><span class='line'> extra                   1760.1 KiB   688K/s 00:03 [######################] 100%
</span><span class='line'> community                  3.6 MiB   906K/s 00:04 [######################] 100%
</span><span class='line'>:: There are 50 members in group base:
</span><span class='line'>:: Repository core
</span><span class='line'>   1) bash  2) bzip2  3) coreutils  4) cryptsetup  5) device-mapper  6) dhcpcd
</span><span class='line'>   7) diffutils  8) e2fsprogs  9) file  10) filesystem  11) findutils  12) gawk
</span><span class='line'>   13) gcc-libs  14) gettext  15) glibc  16) grep  17) gzip  18) inetutils
</span><span class='line'>   19) iproute2  20) iputils  21) jfsutils  22) less  23) licenses  24) linux
</span><span class='line'>   25) logrotate  26) lvm2  27) man-db  28) man-pages  29) mdadm  30) nano
</span><span class='line'>   31) netctl  32) pacman  33) pciutils  34) pcmciautils  35) perl
</span><span class='line'>   36) procps-ng  37) psmisc  38) reiserfsprogs  39) s-nail  40) sed
</span><span class='line'>   41) shadow  42) sysfsutils  43) systemd-sysvcompat  44) tar  45) texinfo
</span><span class='line'>   46) usbutils  47) util-linux  48) vi  49) which  50) xfsprogs
</span><span class='line'>
</span><span class='line'>Enter a selection (default=all): 
</span><span class='line'>:: There are 25 members in group base-devel:
</span><span class='line'>:: Repository core
</span><span class='line'>   1) autoconf  2) automake  3) binutils  4) bison  5) fakeroot  6) file
</span><span class='line'>   7) findutils  8) flex  9) gawk  10) gcc  11) gettext  12) grep  13) groff
</span><span class='line'>   14) gzip  15) libtool  16) m4  17) make  18) pacman  19) patch
</span><span class='line'>   20) pkg-config  21) sed  22) sudo  23) texinfo  24) util-linux  25) which
</span><span class='line'>
</span><span class='line'>Enter a selection (default=all): 
</span><span class='line'>warning: skipping target: file
</span><span class='line'>warning: skipping target: findutils
</span><span class='line'>warning: skipping target: gawk
</span><span class='line'>warning: skipping target: gettext
</span><span class='line'>warning: skipping target: grep
</span><span class='line'>warning: skipping target: gzip
</span><span class='line'>warning: skipping target: pacman
</span><span class='line'>warning: skipping target: sed
</span><span class='line'>warning: skipping target: texinfo
</span><span class='line'>warning: skipping target: util-linux
</span><span class='line'>warning: skipping target: which
</span><span class='line'>resolving dependencies...
</span><span class='line'>looking for conflicting packages...
</span><span class='line'>
</span><span class='line'>Packages (144) acl-2.2.52-2  archlinux-keyring-20160812-1  attr-2.4.47-1
</span><span class='line'>               ca-certificates-20160507-1  ca-certificates-cacert-20140824-3
</span><span class='line'>               ca-certificates-mozilla-3.26-1  ca-certificates-utils-20160507-1
</span><span class='line'>               cracklib-2.9.6-1  curl-7.50.1-1  db-5.3.28-3  dbus-1.10.8-1
</span><span class='line'>               expat-2.2.0-2  gc-7.4.2-4  gdbm-1.12-2  glib2-2.48.1-1
</span><span class='line'>&lt;snip&gt;
</span><span class='line'>               procps-ng-3.3.12-1  psmisc-22.21-3  reiserfsprogs-3.6.25-1
</span><span class='line'>               s-nail-14.8.10-1  sed-4.2.2-4  shadow-4.2.1-3  sudo-1.8.17.p1-1
</span><span class='line'>               sysfsutils-2.1.0-9  systemd-sysvcompat-231-1  tar-1.29-1
</span><span class='line'>               texinfo-6.1-4  usbutils-008-1  util-linux-2.28.1-1
</span><span class='line'>               vi-1:070224-2  which-2.21-2  xfsprogs-4.7.0-1
</span><span class='line'>
</span><span class='line'>Total Download Size:   231.85 MiB
</span><span class='line'>Total Installed Size:  801.27 MiB
</span><span class='line'>
</span><span class='line'>:: Proceed with installation? [Y/n] 
</span><span class='line'>:: Retrieving packages...
</span><span class='line'> linux-api-headers-4...   810.7 KiB   891K/s 00:01 [######################] 100%
</span><span class='line'> tzdata-2016f-1-any       215.4 KiB   909K/s 00:00 [######################] 100%
</span><span class='line'> iana-etc-20160513-1-any  352.2 KiB   723K/s 00:00 [######################] 100%
</span><span class='line'> filesystem-2015.09-...     8.8 KiB   875K/s 00:00 [######################] 100%
</span><span class='line'> glibc-2.24-2-x86_64        8.1 MiB   918K/s 00:09 [######################] 100%
</span><span class='line'> gcc-libs-6.1.1-5-x86_64   14.9 MiB   899K/s 00:17 [######################] 100%
</span><span class='line'>&lt;snip&gt;
</span><span class='line'>(144/144) installing btrfs-progs                   [######################] 100%
</span><span class='line'>:: Running post-transaction hooks...
</span><span class='line'>(1/4) Updating manpage index...
</span><span class='line'>mandb: can't set the locale; make sure $LC_* and $LANG are correct
</span><span class='line'>(2/4) Updating the info directory file...
</span><span class='line'>(3/4) Updating udev Hardware Database...
</span><span class='line'>(4/4) Rebuilding certificate stores...
</span><span class='line'>pacstrap /mnt base base-devel btrfs-progs  27.81s user 10.20s system 10% cpu 5:50.56 total
</span><span class='line'>root@archiso ~ # </span></code></pre></td></tr></table></div></figure>


<h3>Generate /etc/fstab</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@archiso ~ # genfstab -p /mnt &gt;&gt; /mnt/etc/fstab
</span><span class='line'>root@archiso ~ # vi /mnt/etc/fstab
</span><span class='line'># 
</span><span class='line'># /etc/fstab: static file system information
</span><span class='line'>#
</span><span class='line'># &lt;file system&gt; &lt;dir&gt;   &lt;type&gt;  &lt;options&gt;       &lt;dump&gt;  &lt;pass&gt;
</span><span class='line'># UUID=c8ca38de-4e58-4c7c-8f5b-c9c3f92f6a24
</span><span class='line'>/dev/mapper/cryptroot   /               btrfs           rw,noatime,compress=lzo,ssd,dis
</span><span class='line'>card,space_cache,subvolid=258,subvol=/__active/rootvol,subvol=__active/rootvol  0 0
</span><span class='line'>
</span><span class='line'># UUID=c8ca38de-4e58-4c7c-8f5b-c9c3f92f6a24
</span><span class='line'>/dev/mapper/cryptroot   /home           btrfs           rw,noatime,compress=lzo,ssd,dis
</span><span class='line'>card,space_cache,subvolid=259,subvol=/__active/home,subvol=__active/home        0 0
</span><span class='line'>
</span><span class='line'># UUID=c8ca38de-4e58-4c7c-8f5b-c9c3f92f6a24
</span><span class='line'>/dev/mapper/cryptroot   /var            btrfs           rw,noatime,compress=lzo,ssd,dis
</span><span class='line'>card,space_cache,subvolid=260,subvol=/__active/var,subvol=__active/var  0 0</span></code></pre></td></tr></table></div></figure>


<h3>chroot</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@archiso ~ # arch-chroot /mnt
</span><span class='line'>[root@archiso /]# </span></code></pre></td></tr></table></div></figure>


<h3>Set the timezone</h3>

<p>Link for timezone to /etc/localtime</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@archiso /]# ln -s /usr/share/zoneinfo/Europe/Brussels /etc/localtime
</span><span class='line'>[root@archiso /]# </span></code></pre></td></tr></table></div></figure>


<p>Set the hardwareclock to UTC</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>hwclock --systohc --utc</span></code></pre></td></tr></table></div></figure>


<h3>Generate the required locales</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@archiso /]# vi /etc/locale.gen 
</span><span class='line'>[root@archiso /]# locale-gen
</span><span class='line'>Generating locales...
</span><span class='line'>  en_IE.UTF-8... done
</span><span class='line'>  en_IE.ISO-8859-1... done
</span><span class='line'>  en_IE.ISO-8859-15@euro... done
</span><span class='line'>  en_US.UTF-8... done
</span><span class='line'>  en_US.ISO-8859-1... done
</span><span class='line'>  nl_BE.UTF-8... done
</span><span class='line'>  nl_BE.ISO-8859-1... done
</span><span class='line'>  nl_BE.ISO-8859-15@euro... done
</span><span class='line'>Generation complete.
</span><span class='line'>[root@archiso /]# </span></code></pre></td></tr></table></div></figure>


<h3>Hostname</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@archiso /]# vi /etc/hostname
</span><span class='line'>[root@archiso /]# 
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@archiso /]# vi /etc/hosts</span></code></pre></td></tr></table></div></figure>


<h3>mkinitcpio</h3>

<h4>HOOKS</h4>

<p>Add encrypt to HOOKS before filesystems in /etc/mkinitcpio.conf</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@archiso /]# vi /etc/mkinitcpio.conf </span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>HOOKS="base udev autodetect modconf block encrypt filesystems keyboard fsck"</span></code></pre></td></tr></table></div></figure>


<h4>Create boot image</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@archiso /]# mkinitcpio -p linux
</span><span class='line'>==&gt; Building image from preset: /etc/mkinitcpio.d/linux.preset: 'default'
</span><span class='line'>  -&gt; -k /boot/vmlinuz-linux -c /etc/mkinitcpio.conf -g /boot/initramfs-linux.img
</span><span class='line'>==&gt; Starting build: 4.7.1-1-ARCH
</span><span class='line'>  -&gt; Running build hook: [base]
</span><span class='line'>  -&gt; Running build hook: [udev]
</span><span class='line'>  -&gt; Running build hook: [autodetect]
</span><span class='line'>  -&gt; Running build hook: [modconf]
</span><span class='line'>  -&gt; Running build hook: [block]
</span><span class='line'>  -&gt; Running build hook: [encrypt]
</span><span class='line'>  -&gt; Running build hook: [filesystems]
</span><span class='line'>  -&gt; Running build hook: [keyboard]
</span><span class='line'>  -&gt; Running build hook: [fsck]
</span><span class='line'>==&gt; Generating module dependencies
</span><span class='line'>==&gt; Creating gzip-compressed initcpio image: /boot/initramfs-linux.img
</span><span class='line'>==&gt; Image generation successful
</span><span class='line'>==&gt; Building image from preset: /etc/mkinitcpio.d/linux.preset: 'fallback'
</span><span class='line'>  -&gt; -k /boot/vmlinuz-linux -c /etc/mkinitcpio.conf -g /boot/initramfs-linux-fallback.img -S autodetect
</span><span class='line'>==&gt; Starting build: 4.7.1-1-ARCH
</span><span class='line'>  -&gt; Running build hook: [base]
</span><span class='line'>  -&gt; Running build hook: [udev]
</span><span class='line'>  -&gt; Running build hook: [modconf]
</span><span class='line'>  -&gt; Running build hook: [block]
</span><span class='line'>==&gt; WARNING: Possibly missing firmware for module: wd719x
</span><span class='line'>==&gt; WARNING: Possibly missing firmware for module: aic94xx
</span><span class='line'>  -&gt; Running build hook: [encrypt]
</span><span class='line'>  -&gt; Running build hook: [filesystems]
</span><span class='line'>  -&gt; Running build hook: [keyboard]
</span><span class='line'>  -&gt; Running build hook: [fsck]
</span><span class='line'>==&gt; Generating module dependencies
</span><span class='line'>==&gt; Creating gzip-compressed initcpio image: /boot/initramfs-linux-fallback.img
</span><span class='line'>==&gt; Image generation successful
</span><span class='line'>[root@archiso /]#</span></code></pre></td></tr></table></div></figure>


<h3>set the root password</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@archiso /]# passwd root
</span><span class='line'>New password: 
</span><span class='line'>Retype new password: 
</span><span class='line'>passwd: password updated successfully
</span><span class='line'>[root@archiso /]# </span></code></pre></td></tr></table></div></figure>


<h3>GRUB</h3>

<h4>install Grub</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@archiso /]# pacman -Sy grub
</span><span class='line'>:: Synchronizing package databases...
</span><span class='line'> core is up to date
</span><span class='line'> extra                   1760.1 KiB   917K/s 00:02 [######################] 100%
</span><span class='line'> community                  3.6 MiB   896K/s 00:04 [######################] 100%
</span><span class='line'>resolving dependencies...
</span><span class='line'>looking for conflicting packages...
</span><span class='line'>
</span><span class='line'>Packages (1) grub-1:2.02.beta3-3
</span><span class='line'>
</span><span class='line'>Total Download Size:    5.83 MiB
</span><span class='line'>Total Installed Size:  28.70 MiB
</span><span class='line'>
</span><span class='line'>:: Proceed with installation? [Y/n] y
</span><span class='line'>:: Retrieving packages...
</span><span class='line'> grub-1:2.02.beta3-3...     5.8 MiB   917K/s 00:07 [######################] 100%
</span><span class='line'>(1/1) checking keys in keyring                     [######################] 100%
</span><span class='line'>(1/1) checking package integrity                   [######################] 100%
</span><span class='line'>(1/1) loading package files                        [######################] 100%
</span><span class='line'>(1/1) checking for file conflicts                  [######################] 100%
</span><span class='line'>(1/1) checking available disk space                [######################] 100%
</span><span class='line'>:: Processing package changes...
</span><span class='line'>(1/1) installing grub                              [######################] 100%
</span><span class='line'>Generating grub.cfg.example config file...
</span><span class='line'>This may fail on some machines running a custom kernel.
</span><span class='line'>done.
</span><span class='line'>Optional dependencies for grub
</span><span class='line'>    freetype2: For grub-mkfont usage
</span><span class='line'>    fuse: For grub-mount usage
</span><span class='line'>    dosfstools: For grub-mkrescue FAT FS and EFI support
</span><span class='line'>    efibootmgr: For grub-install EFI support
</span><span class='line'>    libisoburn: Provides xorriso for generating grub rescue iso using
</span><span class='line'>    grub-mkrescue
</span><span class='line'>    os-prober: To detect other OSes when generating grub.cfg in BIOS systems
</span><span class='line'>    mtools: For grub-mkrescue FAT FS support
</span><span class='line'>:: Running post-transaction hooks...
</span><span class='line'>(1/2) Updating manpage index...
</span><span class='line'>(2/2) Updating the info directory file...
</span><span class='line'>[root@archiso /]# </span></code></pre></td></tr></table></div></figure>


<h4>Install grub to your boot disk</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@archiso /]# grub-install --target=i386-pc /dev/sda
</span><span class='line'>Installing for i386-pc platform.
</span><span class='line'>grub-install: error: attempt to install to encrypted disk without cryptodisk enabled. Set `GRUB_ENABLE_CRYPTODISK=y' in file `/etc/default/grub'.
</span><span class='line'>[root@archiso /]# 
</span></code></pre></td></tr></table></div></figure>


<h4>Enable cryptodisk</h4>

<p>Because we use an encrypted boot disk we need to enable cryptdisk support.</p>

<p>Add  GRUB_ENABLE_CRYPTODISK=y to /etc/default/grub</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@archiso /]# vi /etc/default/grub
</span><span class='line'>[root@archiso /]# 
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>GRUB_DEFAULT=0
</span><span class='line'>GRUB_TIMEOUT=5
</span><span class='line'>GRUB_DISTRIBUTOR="Arch"
</span><span class='line'>GRUB_CMDLINE_LINUX_DEFAULT="quiet"
</span><span class='line'>GRUB_CMDLINE_LINUX=""
</span><span class='line'>GRUB_ENABLE_CRYPTODISK=y</span></code></pre></td></tr></table></div></figure>


<p>And run grub-install again</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@archiso /]# grub-install --target=i386-pc /dev/sda
</span><span class='line'>Installing for i386-pc platform.
</span><span class='line'>Installation finished. No error reported.
</span><span class='line'>[root@archiso /]# </span></code></pre></td></tr></table></div></figure>


<h4>Create grub.cfg</h4>

<p>Add your encrypted root partition to GRUB_CMDLINE_LINUX= in /etc/default/grub</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>GRUB_DEFAULT=0
</span><span class='line'>GRUB_TIMEOUT=5
</span><span class='line'>GRUB_DISTRIBUTOR="Arch"
</span><span class='line'>GRUB_CMDLINE_LINUX_DEFAULT="quiet"
</span><span class='line'>GRUB_CMDLINE_LINUX=""cryptdevice=/dev/sda3:cryptroot""
</span><span class='line'>ENABLE_CRYPTODISK=y 
</span></code></pre></td></tr></table></div></figure>


<p>And generate grub.cfg</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@archiso /]# grub-mkconfig -o /boot/grub/grub.cfg
</span><span class='line'>Generating grub configuration file ...
</span><span class='line'>Found linux image: /boot/vmlinuz-linux
</span><span class='line'>Found initrd image(s) in /boot: initramfs-linux.img
</span><span class='line'>Found fallback initrd image(s) in /boot: initramfs-linux-fallback.img
</span><span class='line'>done
</span><span class='line'>[root@archiso /]# 
</span></code></pre></td></tr></table></div></figure>


<h2>Reboot</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@archiso /]# vi /boot/grub/grub.cfg
</span><span class='line'>[root@archiso /]# sync
</span><span class='line'>[root@archiso /]# reboot
</span><span class='line'>Running in chroot, ignoring request.
</span><span class='line'>[root@archiso /]# exit
</span><span class='line'>arch-chroot /mnt  9.76s user 1.37s system 0% cpu 23:13.29 total
</span><span class='line'>root@archiso ~ # reboot</span></code></pre></td></tr></table></div></figure>


<h2>Finish the installation</h2>

<h3>1st boot</h3>

<p>As mentioned before the GRUB will as for a passphrase to decrypt the boot partition.</p>

<p><img class="center" src="/blog/images/arch-on-an-encrypted-btrfs-partition/01_1st_boot.png" width="700" height="274" title="&#34;01_1st_boot.png&#34;" alt="&#34;01_1st_boot.png&#34;">
<img class="center" src="/blog/images/arch-on-an-encrypted-btrfs-partition/02_1st_grub_menu.png" width="700" height="484" title="&#34;01_1st_boot.png&#34;" alt="&#34;01_1st_boot.png&#34;"></p>

<p>You&rsquo;ll need to type it the password a secod time during the loading of initrd.</p>

<p><img class="center" src="/blog/images/arch-on-an-encrypted-btrfs-partition/02_1st_decrypt_root.png" width="700" height="165" title="&#34;01_1st_boot.png&#34;" alt="&#34;01_1st_boot.png&#34;"></p>

<h3>Setup swap space</h3>

<p>Update /etc/crypttab</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>swap         /dev/sda2                                    /dev/urandom            swap,
</span><span class='line'>cipher=aes-cbc-essiv:sha256,size=256</span></code></pre></td></tr></table></div></figure>


<p>reboot the system to verify that the encrypted swap partition is mapper correctly during the system startup</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@vicky ~]# ls -l /dev/mapper/
</span><span class='line'>total 0
</span><span class='line'>crw------- 1 root root 10, 236 Aug 29 15:43 control
</span><span class='line'>lrwxrwxrwx 1 root root       7 Aug 29 15:43 cryptroot -&gt; ../dm-0
</span><span class='line'>lrwxrwxrwx 1 root root       7 Aug 29 15:43 swap -&gt; ../dm-1
</span><span class='line'>[root@vicky ~]# </span></code></pre></td></tr></table></div></figure>


<p>Create swap</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@vicky ~]# mkswap /dev/mapper/swap 
</span><span class='line'>Setting up swapspace version 1, size = 32 GiB (34359734272 bytes)
</span><span class='line'>no label, UUID=66ea5a08-0833-4e84-8b95-f1a9c2d772b2
</span><span class='line'>[root@vicky ~]# </span></code></pre></td></tr></table></div></figure>


<p>Activate swap</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@vicky ~]# swapon /dev/mapper/swap
</span><span class='line'>[root@vicky ~]# free
</span><span class='line'>              total        used        free      shared  buff/cache   available
</span><span class='line'>Mem:        4051236       85932     3890708         440       74596     3807084
</span><span class='line'>Swap:      33554428           0    33554428
</span><span class='line'>[root@vicky ~]# </span></code></pre></td></tr></table></div></figure>


<p>Update /etc/fstab</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/dev/mapper/swap swap                    swap    defaults,discard,pri=3        0 0 </span></code></pre></td></tr></table></div></figure>




<p style="font-style: italic;">
Have fun
</p>


<h2>Links</h2>

<ul>
<li><a href="https://wiki.archlinux.org/index.php/Installation_guide"><a href="https://wiki.archlinux.org/index.php/Installation_guide">https://wiki.archlinux.org/index.php/Installation_guide</a></a></li>
<li><a href="http://www.brunoparmentier.be/blog/how-to-install-arch-linux-on-an-encrypted-btrfs-partition.html"><a href="http://www.brunoparmentier.be/blog/how-to-install-arch-linux-on-an-encrypted-btrfs-partition.html">http://www.brunoparmentier.be/blog/how-to-install-arch-linux-on-an-encrypted-btrfs-partition.html</a></a></li>
<li><a href="http://blog.fabio.mancinelli.me/2012/12/28/Arch_Linux_on_BTRFS.html"><a href="http://blog.fabio.mancinelli.me/2012/12/28/Arch_Linux_on_BTRFS.html">http://blog.fabio.mancinelli.me/2012/12/28/Arch_Linux_on_BTRFS.html</a></a></li>
</ul>

</div>
  
  

<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- blog_actrikel -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-4659298941528586"
     data-ad-slot="7394058542"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2016/04/13/cgipaf-1-dot-3-5-released/">CGIpaf 1.3.5 Released</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-04-13T11:00:13+02:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>13</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>11:00 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>CGIpaf 1.3.5 has been released</p>

<h3>ChangeLog</h3>

<h5>version 1.3.5         ( 13 Apr 2016 )</h5>

<blockquote><ul>
<li>pwd_mkdb errors were not handled correctly on BSD</li>
<li>kyua test scripts added</li>
</ul>
</blockquote>

<p>CGIpaf 1.3.5 is  available at: <a href="http://www.wagemakers.be/english/programs/cgipaf"><a href="http://www.wagemakers.be/english/programs/cgipaf">http://www.wagemakers.be/english/programs/cgipaf</a></a></p>

<p>Download the tarball directly at:  <a href="http://www.wagemakers.be/downloads/cgipaf/"><a href="http://www.wagemakers.be/downloads/cgipaf/">http://www.wagemakers.be/downloads/cgipaf/</a></a></p>

<p>Or at the the Git repository  on github: <a href="https://github.com/stafwag/cgipaf"><a href="https://github.com/stafwag/cgipaf">https://github.com/stafwag/cgipaf</a></a></p>

<p style="font-style: italic;">
Have fun...
</p>



</div>
  
  

<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- blog_actrikel -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-4659298941528586"
     data-ad-slot="7394058542"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2016/01/17/thunderbird-importing-s-slash-mime-certificate-failed/">Thunderbird: Importing S/mime Certificate Failed</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-01-17T09:03:53+01:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>17</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>9:03 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img class="left" src="/blog/images/thunderbird_import_smime_failed.png" width="1000" height="835" title="&#34;thunderbird smime failed&#34;" alt="&#34;thunderbird smime failed&#34;"></p>

<p>On <a href="http://kb.mozillazine.org/Getting_an_SMIME_certificate"><a href="http://kb.mozillazine.org/Getting_an_SMIME_certificate">http://kb.mozillazine.org/Getting_an_SMIME_certificate</a></a>
you get a list of free <a href="https://en.wikipedia.org/wiki/S/MIME">s/mime</a> certificate.</p>

<p>I ordered a free 30 days certificate at <a href="globalsign">globalsign</a>: <a href="https://www.globalsign.com/en/personalsign/trial/"><a href="https://www.globalsign.com/en/personalsign/trial/">https://www.globalsign.com/en/personalsign/trial/</a></a></p>

<p>The import of the <a href="https://en.wikipedia.org/wiki/PKCS_12">pkcs12</a> failed in Thunderbird with the message: &ldquo;The PKCS #12 operation failed for unknown reasons.&rdquo;</p>

<p>Searching the internet didn&rsquo;t provide a solution. To debug this issue I started to extract the private / certificate from the pkcs12 file provided by globalsign and creating a new one.</p>

<p>To execute this command I use an encrypted <a href="https://gitlab.com/cryptsetup/cryptsetup/blob/master/README.md">luks</a> volume.</p>

<h1>Create a new pkcs12 file</h1>

<h2>verifying the pkx file</h2>

<h3>password too long?</h3>

<p>The first issue was that the password of my pkx was too long by default the openssl pkcs12 command seems to have a limit of 32 characters.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[staf@vicky staf@wagemakers.be]$ openssl pkcs12 -in staf.pkx 
</span><span class='line'>Enter Import Password:
</span><span class='line'>Can't read Password
</span><span class='line'>[staf@vicky staf@wagemakers.be]$ </span></code></pre></td></tr></table></div></figure>


<p>Use the &ldquo;-passin pass&rdquo;, &ldquo;-passin stdin&rdquo; or &ldquo;-passin file&rdquo; argument resolves this issue. The &ldquo;-passin pass&rdquo; argument will show the password on the screen and in shell history, the &ldquo;-passin stdin&rdquo; will show your password on the screen, the &ldquo;-passin file&rdquo; will leave your password on the (hopefully encrypted) filesystem  so I went with the &ldquo;-pass file&rdquo; option.</p>

<h3>Created password file</h3>

<p>Create the file that holds your password with the corrected file permissions, you must be the only one that is able to read this file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[staf@vicky staf@wagemakers.be]$ touch pass
</span><span class='line'>[staf@vicky staf@wagemakers.be]$ chmod 600 pass
</span><span class='line'>[staf@vicky staf@wagemakers.be]$ vi pass</span></code></pre></td></tr></table></div></figure>


<h3>Try again</h3>

<p>With the &ldquo;-passin file&rdquo; argument we are able to the pkcs12 file.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[staf@vicky staf@wagemakers.be]$ openssl pkcs12 -in staf.pkx -passin file:pass
</span><span class='line'>MAC verified OK
</span><span class='line'>Bag Attributes
</span><span class='line'>    localKeyID: 9B B7 F3 7A 96 46 1F 08 28 A2 BC 2B 87 0E 53 92 29 B4 7D 7D 
</span><span class='line'>Key Attributes: &lt;No Attributes&gt;
</span><span class='line'>Enter PEM pass phrase:
</span><span class='line'>Bag Attributes
</span><span class='line'>    localKeyID: 9B B7 F3 7A 96 46 1F 08 28 A2 BC 2B 87 0E 53 92 29 B4 7D 7D 
</span><span class='line'>subject=/CN=staf@wagemakers.be/emailAddress=staf@wagemakers.be
</span><span class='line'>issuer=/C=BE/O=GlobalSign nv-sa/CN=GlobalSign PersonalSign 1 CA - SHA256 - G2
</span><span class='line'>-----BEGIN CERTIFICATE-----
</span><span class='line'>&lt;snip&gt;</span></code></pre></td></tr></table></div></figure>


<h2>Extract</h2>

<p>We&rsquo;ll extract the private key and the certificates and build a new pkcs12 file and import this pkcs12 file into thunderbird.</p>

<h3>Extract the private key</h3>

<p>The private key is encrypted with the &ldquo;bag&rdquo; so need to type it or copy/pass it&hellip;</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[staf@vicky staf@wagemakers.be]$ openssl pkcs12 -in staf.pkx -nocerts -out key.pem -passin file:pass 
</span><span class='line'>MAC verified OK
</span><span class='line'>Enter PEM pass phrase:
</span><span class='line'>Verifying - Enter PEM pass phrase:</span></code></pre></td></tr></table></div></figure>


<h3>Extract the client certificate</h3>

<p>The client certificate isn&rsquo;t encrypted so you can leave the pem password empty.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[staf@vicky staf@wagemakers.be]$ openssl pkcs12 -in staf.pkx -clcerts -out staf.pem -passin file:pass 
</span><span class='line'>MAC verified OK
</span><span class='line'>
</span><span class='line'>Enter PEM pass phrase:
</span><span class='line'>[staf@vicky staf@wagemakers.be]$ </span></code></pre></td></tr></table></div></figure>


<h3>Verify the key and certificate</h3>

<p>To verify that the certificate and the private belongs together we need to verify the modulus of the key and the certificate the sha1sum should match.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>staf@vicky staf@wagemakers.be]$ openssl rsa -in key.pem -modulus -noout | sha1sum
</span><span class='line'>Enter pass phrase for key.pem:
</span><span class='line'>1234567890123456789012345678901234567890  -
</span><span class='line'>[staf@vicky staf@wagemakers.be]$ </span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[staf@vicky staf@wagemakers.be]$ openssl x509 -in staf.pem -modulus -noout | sha1sum
</span><span class='line'>1234567890123456789012345678901234567890  -
</span><span class='line'>[staf@vicky staf@wagemakers.be]$ </span></code></pre></td></tr></table></div></figure>


<h3>Extract the signing certificate(s)</h3>

<p>The following command extracts the ca certificates.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[staf@vicky staf@wagemakers.be]$ openssl pkcs12 -in staf.pkx -cacerts -out cacerts.pem -passin file:pass
</span><span class='line'>MAC verified OK
</span><span class='line'>Enter PEM pass phrase:</span></code></pre></td></tr></table></div></figure>


<h2>Create a new pkcs12 file</h2>

<p>This time we use a 32 characters password.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[staf@vicky staf@wagemakers.be]$ openssl pkcs12 -export -in staf.pem -inkey key.pem -certfile cacerts.pem -out staf_new.p12
</span><span class='line'>Enter pass phrase for key.pem:
</span><span class='line'>Enter Export Password:
</span><span class='line'>Verifying - Enter Export Password:</span></code></pre></td></tr></table></div></figure>


<h1>Import the the new pkcs12 file</h1>

<p><img class="right" src="/blog/images/thunderbird_import_smime_ok.png" width="598" height="152" title="&#34;thunderbird smime import ok&#34;" alt="&#34;thunderbird smime import ok&#34;">
Not sure what the issue was with original pkcs12 but the import works now&hellip;.
 - it might have been the 32 characters password -.   After I was able to use the signing and encryption part in thunderbird.</p>

<p><strong><em> Have fun </em></strong></p>
</div>
  
  

<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- blog_actrikel -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-4659298941528586"
     data-ad-slot="7394058542"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2016/01/01/happy-new-year-2016/">Happy New Year 2016</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-01-01T10:24:48+01:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>1</span><span class='date-suffix'>st</span>, <span class='date-year'>2016</span></span> <span class='time'>10:24 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><strong><em> Happy new year! </em></strong></p>

<p><img class="center" src="/blog/images/2016.jpg" width="1000" height="625" title="&#34;2016.jpg&#34;" alt="&#34;2016.jpg&#34;"></p>
</div>
  
  

<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- blog_actrikel -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-4659298941528586"
     data-ad-slot="7394058542"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2015/12/28/lookat-1-dot-4-4-released/">Lookat 1.4.4 Released</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-12-28T15:48:50+01:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>28</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>3:48 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p> Lookat 1.4.4 is the latest stable release of Lookat/Bekijk the userfriendly file browser/viewer.</p>

<h3>ChangeLog</h3>

<ul>
<li>NetBSD support</li>
<li>OpenBSD support</li>
<li>English translation issues corrected</li>
<li>autoconf updated to 2.69</li>
<li>Corrected minor compile warnings</li>
</ul>


<h3>Lookat 1.4.4 is available at:</h3>

<p><a href="http://www.wagemakers.be/english/programs/lookat"><a href="http://www.wagemakers.be/english/programs/lookat">http://www.wagemakers.be/english/programs/lookat</a></a>
, download it directly <a href="http://www.wagemakers.be/downloads/lookat/lookat_bekijk-1.4.4.tar.gz">Download latest stable release (1.4.4)</a>.</p>

<p>Or at the Git repository at GNU savannah <a href="http://git.savannah.gnu.org/cgit/lookat.git/"><a href="http://git.savannah.gnu.org/cgit/lookat.git/">http://git.savannah.gnu.org/cgit/lookat.git/</a></a></p>

<p><strong><em> Have fun </em></strong></p>
</div>
  
  

<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- blog_actrikel -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-4659298941528586"
     data-ad-slot="7394058542"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2015/12/26/running-docker-on-arm/">Running Docker on ARM</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-12-26T14:55:59+01:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>26</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>2:55 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img class="right" src="/blog/images/odroid_2_euro.jpg" width="500" height="256" title="&#34;odroid u3 2 euro&#34;" alt="&#34;odroid u3 2 euro&#34;"></p>

<p>I own an <a href="http://www.hardkernel.com/main/products/prdt_info.php?g_code=g138745696275">odroid u3</a> that I used for my media center with <a href="https://xbmc.org/">xbmc</a> while I like the performance of the <a href="https://en.wikipedia.org/wiki/Exynos">Exynos4412 CPU</a> but the drivers for the <a href="https://en.wikipedia.org/wiki/Mali_%28GPU%29">Mali GPU</a> aren&rsquo;t <a href="https://en.wikipedia.org/wiki/Open_source">opensource</a>.</p>

<p>I like <a href="https://en.wikipedia.org/wiki/ARM_architecture">ARM</a> but unfortunatelly a lot of the ARM <a href="https://en.wikipedia.org/wiki/System_on_a_chip">soc</a>&rsquo;s  have no opensource drivers for the <a href="https://en.wikipedia.org/wiki/Graphics_processing_unit">GPU</a></p>

<p>The manufacturer of the odroid u3 - <a href="http://www.hardkernel.com/">hardkernel</a> - provides <a href="http://com.odroid.com/sigong/nf_file_board/nfile_board.php?tag=ODROID-U3">ubuntu 14.04 images</a> with xbmc and mali support. It isn&rsquo;t possible to get the newer of version of xbmc - now <a href="http://www.kodi.org">kodi</a> - running, or I didn&rsquo;t succeed withit. I&rsquo;ll look for another solution for my media server needs this might be my <a href="https://www.raspberrypi.org/">raspberry pi</a> <a href="https://www.raspberrypi.org/products/model-b-plus/">1 model B+</a> that is laying around doing nothing running <a href="http://openelec.tv/">openelec</a><br /><br />
<img class="left" src="/blog/images/odroid_u3_with_usbdisk.jpg" width="500" height="352" title="&#34;odroid u3 with usb disk&#34;" alt="&#34;odroid u3 with usb disk&#34;"></p>

<p>Like I said I like the performance of the ordoid U3 that why I installed <a href="http://archlinuxarm.org/">archLinuxArm</a> to play with <a href="https://www.docker.com/">Docker</a>. I could have sticked with Ubuntu 14.04 but with Arch Linux I get more up-to-date software.</p>

<p><a href="http://archlinuxarm.org/platforms/armv7/samsung/odroid-u3">The installion</a> was pretty straightforward even the <a href="https://wiki.archlinux.org/index.php/Docker">docker installation</a> was the same as on a <a href="https://en.wikipedia.org/wiki/X86">x86 platform</a>.<br /></p>

<p>Since we are using docker on arm we have to build our own docker base images instead of using the <a href="https://hub.docker.com/_/registry/">docker registery</a>. I have security concerns about installtion and using unsigned non-verified software anyway. If you build your own image it possible to audit/verify the build process.</p>

<h2>Creating your own docker base images</h2>

<h3>Arch</h3>

<p>To build a Arch Base Image download mkimage-arch.sh and mkimage-arch-pacman.conf from the Docker source <a href="https://github.com/docker/docker/blob/master/contrib/"><a href="https://github.com/docker/docker/blob/master/contrib/">https://github.com/docker/docker/blob/master/contrib/</a></a></p>

<h4>Download mkimage-arch.sh</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>staf@fanny arch]$ wget https://raw.githubusercontent.com/docker/docker/master/contrib/mkimage-arch.sh
</span><span class='line'>--2015-12-26 10:21:10--  https://raw.githubusercontent.com/docker/docker/master/contrib/mkimage-arch.sh
</span><span class='line'>Resolving raw.githubusercontent.com (raw.githubusercontent.com)... 23.235.43.133
</span><span class='line'>Connecting to raw.githubusercontent.com (raw.githubusercontent.com)|23.235.43.133|:443... connected.
</span><span class='line'>HTTP request sent, awaiting response... 200 OK
</span><span class='line'>Length: 2351 (2.3K) [text/plain]
</span><span class='line'>Saving to: 'mkimage-arch.sh'
</span><span class='line'>
</span><span class='line'>mkimage-arch.sh                     100%[=====================================================================&gt;]   2.30K  --.-KB/s   in 0s     
</span><span class='line'>
</span><span class='line'>2015-12-26 10:21:10 (144 MB/s) - 'mkimage-arch.sh' saved [2351/2351]
</span><span class='line'>
</span><span class='line'>[staf@fanny arch]$ chmod +x mkimage-arch.sh 
</span><span class='line'>[staf@fanny arch]$ </span></code></pre></td></tr></table></div></figure>


<h4>Increase the timeout</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[staf@fanny arch]$ sed -i 's/timeout 60/timeout 120/' mkimage-arch.sh
</span><span class='line'>[staf@fanny arch]$ </span></code></pre></td></tr></table></div></figure>


<h4>Copy pacman.conf</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[staf@fanny arch]$ cp /etc/pacman.conf mkimage-arch-pacman.conf
</span><span class='line'>[staf@fanny arch]$ </span></code></pre></td></tr></table></div></figure>


<h4>Install the arch keyring</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[staf@fanny debian]$ sudo pacman -Ss keyring                                                                                                                                                                                                                                                                                                                                                                                             
</span><span class='line'>core/archlinux-keyring 20151206-1                                                                                                                                                                                                                                                                                                                                                                                                        
</span><span class='line'>    Arch Linux PGP keyring                                                                                                                                                                                                                                                                                                                                                                                                               
</span><span class='line'>core/archlinuxarm-keyring 20140119-1                                                                                                                                                                                                                                                                                                                                                                                                     
</span><span class='line'>    Arch Linux ARM PGP keyring                                                                                                                                                                                                                                                                                                                                                                                                           
</span><span class='line'>extra/gnome-keyring 1:3.18.3-1 (gnome)                                                                                                                                                                                                                                                                                                                                                                                                   
</span><span class='line'>    GNOME Password Management daemon                                                                                                                                                                                                                                                                                                                                                                                                     
</span><span class='line'>extra/gnome-keyring-sharp 1.0.2-5                                                                                                                                                                                                                                                                                                                                                                                                        
</span><span class='line'>    A fully managed implementation of libgnome-keyring                                                                                                                                                                                                                                                                                                                                                                                   
</span><span class='line'>extra/libgnome-keyring 3.12.0-2                                                                                                                                                                                                                                                                                                                                                                                                          
</span><span class='line'>    GNOME keyring client library                                                                                                                                                                                                                                                                                                                                                                                                         
</span><span class='line'>extra/python2-gnomekeyring 2.32.0-15                                                                                                                                                                                                                                                                                                                                                                                                     
</span><span class='line'>    Python bindings for libgnome-keyring                                                                                                                                                                                                                                                                                                                                                                                                 
</span><span class='line'>community/python-keyring 5.7.1-1                                                                                                                                                                                                                                                                                                                                                                                                         
</span><span class='line'>    Store and access your passwords safely.                                                                                                                                                                                                                                                                                                                                                                                              
</span><span class='line'>community/python2-keyring 5.7.1-1                                                                                                                                                                                                                                                                                                                                                                                                        
</span><span class='line'>    Store and access your passwords safely.                                                                                                                                                                                                                                                                                                                                                                                              
</span><span class='line'>[staf@fanny debian]$ sudo pacman -S archlinuxarm-keyring                                                                                                                                                                                                                                                                                                                                                                                 
</span><span class='line'>resolving dependencies...                                                                                                                                                                                                                                                                                                                                                                                                                
</span><span class='line'>looking for conflicting packages...                                                                                                                                                                                                                                                                                                                                                                                                      
</span><span class='line'>                                                                                                                                                                                                                                                                                                                                                                                                                                         
</span><span class='line'>Packages (1) archlinuxarm-keyring-20140119-1                                                                                                                                                                                                                                                                                                                                                                                             
</span><span class='line'>                                                                                                                                                                                                                                                                                                                                                                                                                                         
</span><span class='line'>Total Download Size:   0.01 MiB                                                                                                                                                                                                                                                                                                                                                                                                          
</span><span class='line'>Total Installed Size:  0.03 MiB                                                                                                                                                                                                                                                                                                                                                                                                          
</span><span class='line'>                                                                                                                                                                                                                                                                                                                                                                                                                                         
</span><span class='line'>:: Proceed with installation? [Y/n] y                                                                                                                                                                                                                                                                                                                                                                                                    
</span><span class='line'>:: Retrieving packages ...                                                                                                                                                                                                                                                                                                                                                                                                               
</span><span class='line'> archlinuxarm-keyring-20140119-1-any                                                                                                                                                                                                    12.2 KiB  1218K/s 00:00 [##################################################################################################################################################################] 100%
</span><span class='line'>(1/1) checking keys in keyring                                                                                                                                                                                                                                  [##################################################################################################################################################################] 100%
</span><span class='line'>(1/1) checking package integrity                                                                                                                                                                                                                                [##################################################################################################################################################################] 100%
</span><span class='line'>(1/1) loading package files                                                                                                                                                                                                                                     [##################################################################################################################################################################] 100%
</span><span class='line'>(1/1) checking for file conflicts                                                                                                                                                                                                                               [##################################################################################################################################################################] 100%
</span><span class='line'>(1/1) checking available disk space                                                                                                                                                                                                                             [##################################################################################################################################################################] 100%
</span><span class='line'>(1/1) installing archlinuxarm-keyring                                                                                                                                                                                                                           [##################################################################################################################################################################] 100%
</span><span class='line'>[staf@fanny debian]$ sudo pacman -S archlinux-keyring                                                                                                                                                                                                                                                                                                                                                                                    
</span><span class='line'>resolving dependencies...                                                                                                                                                                                                                                                                                                                                                                                                                
</span><span class='line'>looking for conflicting packages...                                                                                                                                                                                                                                                                                                                                                                                                      
</span><span class='line'>                                                                                                                                                                                                                                                                                                                                                                                                                                         
</span><span class='line'>Packages (1) archlinux-keyring-20151206-1                                                                                                                                                                                                                                                                                                                                                                                                
</span><span class='line'>                                                                                                                                                                                                                                                                                                                                                                                                                                         
</span><span class='line'>Total Download Size:   0.49 MiB                                                                                                                                                                                                                                                                                                                                                                                                          
</span><span class='line'>Total Installed Size:  0.70 MiB                                                                                                                                                                                                                                                                                                                                                                                                          
</span><span class='line'>                                                                                                                                                                                                                                                                                                                                                                                                                                         
</span><span class='line'>:: Proceed with installation? [Y/n] y                                                                                                                                                                                                                                                                                                                                                                                                    
</span><span class='line'>:: Retrieving packages ...                                                                                                                                                                                                                                                                                                                                                                                                               
</span><span class='line'> archlinux-keyring-20151206-1-any                                                                                                                                                                                                      505.5 KiB   231K/s 00:02 [##################################################################################################################################################################] 100%
</span><span class='line'>(1/1) checking keys in keyring                                                                                                                                                                                                                                  [##################################################################################################################################################################] 100%
</span><span class='line'>(1/1) checking package integrity                                                                                                                                                                                                                                [##################################################################################################################################################################] 100%
</span><span class='line'>(1/1) loading package files                                                                                                                                                                                                                                     [##################################################################################################################################################################] 100%
</span><span class='line'>(1/1) checking for file conflicts                                                                                                                                                                                                                               [##################################################################################################################################################################] 100%
</span><span class='line'>(1/1) checking available disk space                                                                                                                                                                                                                             [##################################################################################################################################################################] 100%
</span><span class='line'>(1/1) installing archlinux-keyring                                                                                                                                                                                                                              [##################################################################################################################################################################] 100%
</span><span class='line'>[staf@fanny debian]$                                                                                                                                                                                                                                                                                                                                                                                                                     </span></code></pre></td></tr></table></div></figure>


<h4>Create the base Arch Image</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
<span class='line-number'>173</span>
<span class='line-number'>174</span>
<span class='line-number'>175</span>
<span class='line-number'>176</span>
<span class='line-number'>177</span>
<span class='line-number'>178</span>
<span class='line-number'>179</span>
<span class='line-number'>180</span>
<span class='line-number'>181</span>
<span class='line-number'>182</span>
<span class='line-number'>183</span>
<span class='line-number'>184</span>
<span class='line-number'>185</span>
<span class='line-number'>186</span>
<span class='line-number'>187</span>
<span class='line-number'>188</span>
<span class='line-number'>189</span>
<span class='line-number'>190</span>
<span class='line-number'>191</span>
<span class='line-number'>192</span>
<span class='line-number'>193</span>
<span class='line-number'>194</span>
<span class='line-number'>195</span>
<span class='line-number'>196</span>
<span class='line-number'>197</span>
<span class='line-number'>198</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[staf@fanny arch]$ sudo LC_ALL=C TMPDIR=`pwd`/tmp ./mkimage-arch.sh
</span><span class='line'>spawn pacstrap -C ./mkimage-arch-pacman.conf -c -d -G -i /home/staf/docker/docker/base-images/arch/tmp/rootfs-archlinux-eYGavMPZLd base haveged --ignore cryptsetup,device-mapper,dhcpcd,iproute2,jfsutils,linux,lvm2,man-db,man-pages,mdadm,nano,netctl,openresolv,pciutils,pcmciautils,reiserfsprogs,s-nail,systemd-sysvcompat,usbutils,vi,xfsprogs
</span><span class='line'>==&gt; Creating install root at /home/staf/docker/docker/base-images/arch/tmp/rootfs-archlinux-eYGavMPZLd
</span><span class='line'>==&gt; Installing packages to /home/staf/docker/docker/base-images/arch/tmp/rootfs-archlinux-eYGavMPZLd
</span><span class='line'>:: Synchronizing package databases...
</span><span class='line'> core                                                         210.4 KiB   288K/s 00:01 [##################################################] 100%
</span><span class='line'> extra                                                          2.3 MiB   409K/s 00:06 [##################################################] 100%
</span><span class='line'> community                                                      3.2 MiB   314K/s 00:10 [##################################################] 100%
</span><span class='line'> alarm                                                        105.4 KiB  77.8K/s 00:01 [##################################################] 100%
</span><span class='line'> aur                                                           31.2 KiB   164K/s 00:00 [##################################################] 100%
</span><span class='line'>:: cryptsetup is in IgnorePkg/IgnoreGroup. Install anyway? [Y/n] n
</span><span class='line'>:: device-mapper is in IgnorePkg/IgnoreGroup. Install anyway? [Y/n] n
</span><span class='line'>:: dhcpcd is in IgnorePkg/IgnoreGroup. Install anyway? [Y/n] n
</span><span class='line'>:: iproute2 is in IgnorePkg/IgnoreGroup. Install anyway? [Y/n] n
</span><span class='line'>:: jfsutils is in IgnorePkg/IgnoreGroup. Install anyway? [Y/n] n
</span><span class='line'>:: lvm2 is in IgnorePkg/IgnoreGroup. Install anyway? [Y/n] n
</span><span class='line'>:: man-db is in IgnorePkg/IgnoreGroup. Install anyway? [Y/n] n
</span><span class='line'>:: man-pages is in IgnorePkg/IgnoreGroup. Install anyway? [Y/n] n
</span><span class='line'>:: mdadm is in IgnorePkg/IgnoreGroup. Install anyway? [Y/n] n
</span><span class='line'>:: nano is in IgnorePkg/IgnoreGroup. Install anyway? [Y/n] n
</span><span class='line'>:: netctl is in IgnorePkg/IgnoreGroup. Install anyway? [Y/n] n
</span><span class='line'>:: pciutils is in IgnorePkg/IgnoreGroup. Install anyway? [Y/n] n
</span><span class='line'>:: reiserfsprogs is in IgnorePkg/IgnoreGroup. Install anyway? [Y/n] n
</span><span class='line'>:: s-nail is in IgnorePkg/IgnoreGroup. Install anyway? [Y/n] n
</span><span class='line'>:: systemd-sysvcompat is in IgnorePkg/IgnoreGroup. Install anyway? [Y/n] n
</span><span class='line'>:: usbutils is in IgnorePkg/IgnoreGroup. Install anyway? [Y/n] n
</span><span class='line'>:: vi is in IgnorePkg/IgnoreGroup. Install anyway? [Y/n] n
</span><span class='line'>:: xfsprogs is in IgnorePkg/IgnoreGroup. Install anyway? [Y/n] n
</span><span class='line'>:: There are 31 members in group base:
</span><span class='line'>:: Repository core
</span><span class='line'>   1) bash  2) bzip2  3) coreutils  4) diffutils  5) e2fsprogs  6) file  7) filesystem  8) findutils  9) gawk  10) gcc-libs  11) gettext
</span><span class='line'>   12) glibc  13) grep  14) gzip  15) inetutils  16) iputils  17) less  18) licenses  19) logrotate  20) pacman  21) pacman-mirrorlist
</span><span class='line'>   22) perl  23) procps-ng  24) psmisc  25) sed  26) shadow  27) sysfsutils  28) tar  29) texinfo  30) util-linux  31) which
</span><span class='line'>
</span><span class='line'>Enter a selection (default=all): 
</span><span class='line'>resolving dependencies...
</span><span class='line'>looking for conflicting packages...
</span><span class='line'>
</span><span class='line'>Packages (86) acl-2.2.52-2  attr-2.4.47-1  ca-certificates-20150402-1  ca-certificates-cacert-20140824-2  ca-certificates-mozilla-3.20.1-1
</span><span class='line'>              ca-certificates-utils-20150402-1  cracklib-2.9.4-1  curl-7.46.0-1  db-5.3.28-3  expat-2.1.0-4  gdbm-1.11-1  glib2-2.46.2-2
</span><span class='line'>              gmp-6.1.0-2  gnupg-2.1.10-3  gnutls-3.4.7-2  gpgme-1.6.0-2  iana-etc-20151016-1  keyutils-1.5.9-1  krb5-1.13.2-1
</span><span class='line'>              libarchive-3.1.2-8  libassuan-2.4.2-1  libcap-2.24-2  libffi-3.2.1-1  libgcrypt-1.6.4-1  libgpg-error-1.21-1  libidn-1.32-1
</span><span class='line'>              libksba-1.3.3-1  libldap-2.4.42-2  libsasl-2.1.26-7  libssh2-1.6.0-1  libsystemd-228-3  libtasn1-4.7-1  libtirpc-1.0.1-2
</span><span class='line'>              libunistring-0.9.6-1  libutil-linux-2.27.1-1  linux-api-headers-4.1.4-1  lz4-131-1  lzo-2.09-1  mpfr-3.1.3.p4-1  ncurses-6.0-4
</span><span class='line'>              nettle-3.1.1-1  npth-1.2-1  openssl-1.0.2.e-1  p11-kit-0.23.1-3  pam-1.2.1-3  pambase-20130928-1  pcre-8.38-2  pinentry-0.9.7-1
</span><span class='line'>              popt-1.16-7  readline-6.3.008-3  sqlite-3.9.2-1  tzdata-2015g-1  xz-5.2.2-1  zlib-1.2.8-4  bash-4.3.042-4  bzip2-1.0.6-5
</span><span class='line'>              coreutils-8.24-1  diffutils-3.3-2  e2fsprogs-1.42.13-1  file-5.25-1  filesystem-2015.09-1  findutils-4.4.2-6  gawk-4.1.3-1
</span><span class='line'>              gcc-libs-5.3.0-3  gettext-0.19.6-2  glibc-2.22-3  grep-2.22-1  gzip-1.6-1  haveged-1.9.1-2  inetutils-1.9.4-2.1
</span><span class='line'>              iputils-20140519.fad11dc-1  less-481-2  licenses-20140629-1  logrotate-3.9.1-1  pacman-4.2.1-4  pacman-mirrorlist-20151217-1
</span><span class='line'>              perl-5.22.1-1  procps-ng-3.3.11-2  psmisc-22.21-3  sed-4.2.2-3  shadow-4.2.1-3  sysfsutils-2.1.0-9  tar-1.28-1  texinfo-6.0-1
</span><span class='line'>              util-linux-2.27.1-1  which-2.21-1
</span><span class='line'>
</span><span class='line'>Total Installed Size:  272.82 MiB
</span><span class='line'>
</span><span class='line'>:: Proceed with installation? [Y/n] y
</span><span class='line'>(86/86) checking keys in keyring                                                       [##################################################] 100%
</span><span class='line'>(86/86) checking package integrity                                                     [##################################################] 100%
</span><span class='line'>(86/86) loading package files                                                          [##################################################] 100%
</span><span class='line'>(86/86) checking for file conflicts                                                    [##################################################] 100%
</span><span class='line'>(86/86) checking available disk space                                                  [##################################################] 100%
</span><span class='line'>( 1/86) installing linux-api-headers                                                   [##################################################] 100%
</span><span class='line'>( 2/86) installing tzdata                                                              [##################################################] 100%
</span><span class='line'>( 3/86) installing iana-etc                                                            [##################################################] 100%
</span><span class='line'>( 4/86) installing filesystem                                                          [##################################################] 100%
</span><span class='line'>( 5/86) installing glibc                                                               [##################################################] 100%
</span><span class='line'>( 6/86) installing gcc-libs                                                            [##################################################] 100%
</span><span class='line'>( 7/86) installing ncurses                                                             [##################################################] 100%
</span><span class='line'>( 8/86) installing readline                                                            [##################################################] 100%
</span><span class='line'>( 9/86) installing bash                                                                [##################################################] 100%
</span><span class='line'>Optional dependencies for bash
</span><span class='line'>    bash-completion: for tab completion
</span><span class='line'>(10/86) installing bzip2                                                               [##################################################] 100%
</span><span class='line'>(11/86) installing attr                                                                [##################################################] 100%
</span><span class='line'>(12/86) installing acl                                                                 [##################################################] 100%
</span><span class='line'>(13/86) installing gmp                                                                 [##################################################] 100%
</span><span class='line'>(14/86) installing libcap                                                              [##################################################] 100%
</span><span class='line'>(15/86) installing zlib                                                                [##################################################] 100%
</span><span class='line'>(16/86) installing gdbm                                                                [##################################################] 100%
</span><span class='line'>(17/86) installing db                                                                  [##################################################] 100%
</span><span class='line'>(18/86) installing perl                                                                [##################################################] 100%
</span><span class='line'>(19/86) installing openssl                                                             [##################################################] 100%
</span><span class='line'>Optional dependencies for openssl
</span><span class='line'>    ca-certificates [pending]
</span><span class='line'>(20/86) installing coreutils                                                           [##################################################] 100%
</span><span class='line'>(21/86) installing diffutils                                                           [##################################################] 100%
</span><span class='line'>(22/86) installing libutil-linux                                                       [##################################################] 100%
</span><span class='line'>(23/86) installing e2fsprogs                                                           [##################################################] 100%
</span><span class='line'>(24/86) installing file                                                                [##################################################] 100%
</span><span class='line'>(25/86) installing findutils                                                           [##################################################] 100%
</span><span class='line'>(26/86) installing mpfr                                                                [##################################################] 100%
</span><span class='line'>(27/86) installing gawk                                                                [##################################################] 100%
</span><span class='line'>(28/86) installing pcre                                                                [##################################################] 100%
</span><span class='line'>(29/86) installing libffi                                                              [##################################################] 100%
</span><span class='line'>(30/86) installing glib2                                                               [##################################################] 100%
</span><span class='line'>Optional dependencies for glib2
</span><span class='line'>    python2: for gdbus-codegen and gtester-report
</span><span class='line'>    libelf: gresource inspection tool
</span><span class='line'>(31/86) installing libunistring                                                        [##################################################] 100%
</span><span class='line'>(32/86) installing gettext                                                             [##################################################] 100%
</span><span class='line'>Optional dependencies for gettext
</span><span class='line'>    git: for autopoint infrastructure updates
</span><span class='line'>(33/86) installing grep                                                                [##################################################] 100%
</span><span class='line'>(34/86) installing less                                                                [##################################################] 100%
</span><span class='line'>(35/86) installing gzip                                                                [##################################################] 100%
</span><span class='line'>(36/86) installing cracklib                                                            [##################################################] 100%
</span><span class='line'>(37/86) installing libsasl                                                             [##################################################] 100%
</span><span class='line'>(38/86) installing libldap                                                             [##################################################] 100%
</span><span class='line'>(39/86) installing keyutils                                                            [##################################################] 100%
</span><span class='line'>(40/86) installing krb5                                                                [##################################################] 100%
</span><span class='line'>(41/86) installing libtirpc                                                            [##################################################] 100%
</span><span class='line'>(42/86) installing pambase                                                             [##################################################] 100%
</span><span class='line'>(43/86) installing pam                                                                 [##################################################] 100%
</span><span class='line'>(44/86) installing inetutils                                                           [##################################################] 100%
</span><span class='line'>(45/86) installing sysfsutils                                                          [##################################################] 100%
</span><span class='line'>(46/86) installing iputils                                                             [##################################################] 100%
</span><span class='line'>Optional dependencies for iputils
</span><span class='line'>    xinetd: for tftpd
</span><span class='line'>(47/86) installing licenses                                                            [##################################################] 100%
</span><span class='line'>(48/86) installing popt                                                                [##################################################] 100%
</span><span class='line'>(49/86) installing logrotate                                                           [##################################################] 100%
</span><span class='line'>(50/86) installing expat                                                               [##################################################] 100%
</span><span class='line'>(51/86) installing lzo                                                                 [##################################################] 100%
</span><span class='line'>(52/86) installing xz                                                                  [##################################################] 100%
</span><span class='line'>(53/86) installing libarchive                                                          [##################################################] 100%
</span><span class='line'>(54/86) installing texinfo                                                             [##################################################] 100%
</span><span class='line'>(55/86) installing libtasn1                                                            [##################################################] 100%
</span><span class='line'>(56/86) installing p11-kit                                                             [##################################################] 100%
</span><span class='line'>(57/86) installing ca-certificates-utils                                               [##################################################] 100%
</span><span class='line'>(58/86) installing ca-certificates-mozilla                                             [##################################################] 100%
</span><span class='line'>(59/86) installing ca-certificates-cacert                                              [##################################################] 100%
</span><span class='line'>(60/86) installing ca-certificates                                                     [##################################################] 100%
</span><span class='line'>(61/86) installing libidn                                                              [##################################################] 100%
</span><span class='line'>(62/86) installing libssh2                                                             [##################################################] 100%
</span><span class='line'>(63/86) installing curl                                                                [##################################################] 100%
</span><span class='line'>(64/86) installing libgpg-error                                                        [##################################################] 100%
</span><span class='line'>(65/86) installing npth                                                                [##################################################] 100%
</span><span class='line'>(66/86) installing libgcrypt                                                           [##################################################] 100%
</span><span class='line'>(67/86) installing libksba                                                             [##################################################] 100%
</span><span class='line'>(68/86) installing libassuan                                                           [##################################################] 100%
</span><span class='line'>(69/86) installing pinentry                                                            [##################################################] 100%
</span><span class='line'>Optional dependencies for pinentry
</span><span class='line'>    gtk2: gtk2 backend
</span><span class='line'>    qt5-base: qt backend
</span><span class='line'>    gcr: gnome3 backend
</span><span class='line'>(70/86) installing nettle                                                              [##################################################] 100%
</span><span class='line'>(71/86) installing gnutls                                                              [##################################################] 100%
</span><span class='line'>Optional dependencies for gnutls
</span><span class='line'>    guile: for use with Guile bindings
</span><span class='line'>(72/86) installing sqlite                                                              [##################################################] 100%
</span><span class='line'>(73/86) installing gnupg                                                               [##################################################] 100%
</span><span class='line'>Optional dependencies for gnupg
</span><span class='line'>    libldap: gpg2keys_ldap [installed]
</span><span class='line'>    libusb-compat: scdaemon
</span><span class='line'>(74/86) installing gpgme                                                               [##################################################] 100%
</span><span class='line'>(75/86) installing pacman-mirrorlist                                                   [##################################################] 100%
</span><span class='line'>(76/86) installing pacman                                                              [##################################################] 100%
</span><span class='line'>Optional dependencies for pacman
</span><span class='line'>    fakeroot: for makepkg usage as normal user
</span><span class='line'>(77/86) installing lz4                                                                 [##################################################] 100%
</span><span class='line'>(78/86) installing libsystemd                                                          [##################################################] 100%
</span><span class='line'>(79/86) installing procps-ng                                                           [##################################################] 100%
</span><span class='line'>(80/86) installing psmisc                                                              [##################################################] 100%
</span><span class='line'>(81/86) installing sed                                                                 [##################################################] 100%
</span><span class='line'>(82/86) installing shadow                                                              [##################################################] 100%
</span><span class='line'>(83/86) installing tar                                                                 [##################################################] 100%
</span><span class='line'>(84/86) installing util-linux                                                          [##################################################] 100%
</span><span class='line'>Optional dependencies for util-linux
</span><span class='line'>    python: python bindings to libmount
</span><span class='line'>(85/86) installing which                                                               [##################################################] 100%
</span><span class='line'>(86/86) installing haveged                                                             [##################################################] 100%
</span><span class='line'>gpg: /etc/pacman.d/gnupg/trustdb.gpg: trustdb created
</span><span class='line'>gpg: no ultimately trusted keys found
</span><span class='line'>gpg: starting migration from earlier GnuPG versions
</span><span class='line'>gpg: porting secret keys from '/etc/pacman.d/gnupg/secring.gpg' to gpg-agent
</span><span class='line'>gpg: migration succeeded
</span><span class='line'>gpg: Generating pacman keyring master key...
</span><span class='line'>gpg: key 4C4DCB68 marked as ultimately trusted
</span><span class='line'>gpg: directory '/etc/pacman.d/gnupg/openpgp-revocs.d' created
</span><span class='line'>gpg: Done
</span><span class='line'>==&gt; Updating trust database...
</span><span class='line'>gpg: 3 marginal(s) needed, 1 complete(s) needed, PGP trust model
</span><span class='line'>gpg: depth: 0  valid:   1  signed:   0  trust: 0-, 0q, 0n, 0m, 0f, 1u
</span><span class='line'>checking dependencies...
</span><span class='line'>
</span><span class='line'>Packages (1) haveged-1.9.1-2
</span><span class='line'>
</span><span class='line'>Total Removed Size:  0.18 MiB
</span><span class='line'>
</span><span class='line'>:: Do you want to remove these packages? [Y/n] 
</span><span class='line'>(1/1) removing haveged                                                                 [##################################################] 100%
</span><span class='line'>==&gt; ERROR: The keyring file /usr/share/pacman/keyrings/archlinux.gpg does not exist.
</span><span class='line'>Generating locales...
</span><span class='line'>  en_US.UTF-8... done
</span><span class='line'>Generation complete.
</span><span class='line'>tar: ./etc/pacman.d/gnupg/S.gpg-agent: socket ignored
</span><span class='line'>5de54cc959c36d2064ee4389c0cc50acdb2246b3eac4edeb5e83cac7f4d9b350
</span><span class='line'>Success.
</span><span class='line'>[staf@fanny arch]$</span></code></pre></td></tr></table></div></figure>


<h4>Try it</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[staf@fanny arch]$ docker run -t -i --rm archlinux /bin/bash
</span><span class='line'>[root@6c24a79778f9 /]# </span></code></pre></td></tr></table></div></figure>


<h3>Debian</h3>

<p>To create a debian base images you need <a href="https://wiki.debian.org/Debootstrap">debootstrap</a>. There is a <a href="https://aur.archlinux.org/">aur</a> available.</p>

<h4>Install yaort</h4>

<p><a href="https://wiki.archlinux.org/index.php/Yaourt">Yaourt</a> is a nice tool to install aur ports.</p>

<h5>Install the base development tools</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[staf@fanny ~]$ sudo pacman -Sy base-devel
</span><span class='line'>:: Synchronizing package databases...
</span><span class='line'> core                                                                      210.4 KiB   198K/s 00:01 [##########################################################] 100%
</span><span class='line'> extra                                                                       2.3 MiB   385K/s 00:06 [##########################################################] 100%
</span><span class='line'> community                                                                   3.2 MiB   208K/s 00:16 [##########################################################] 100%
</span><span class='line'> alarm                                                                     105.4 KiB   335K/s 00:00 [##########################################################] 100%
</span><span class='line'> aur                                                                        31.2 KiB  49.1K/s 00:01 [##########################################################] 100%
</span><span class='line'>:: There are 25 members in group base-devel:
</span><span class='line'>:: Repository core
</span><span class='line'>   1) autoconf  2) automake  3) binutils  4) bison  5) fakeroot  6) file  7) findutils  8) flex  9) gawk  10) gcc  11) gettext  12) grep  13) groff  14) gzip
</span><span class='line'>   15) libtool  16) m4  17) make  18) pacman  19) patch  20) pkg-config  21) sed  22) sudo  23) texinfo  24) util-linux  25) which
</span><span class='line'>
</span><span class='line'>Enter a selection (default=all): 
</span><span class='line'>warning: autoconf-2.69-2 is up to date -- reinstalling
</span><span class='line'>warning: automake-1.15-1 is up to date -- reinstalling
</span><span class='line'>warning: binutils-2.25.1-3 is up to date -- reinstalling
</span><span class='line'>warning: bison-3.0.4-1 is up to date -- reinstalling
</span><span class='line'>warning: fakeroot-1.20.2-1 is up to date -- reinstalling
</span><span class='line'>warning: file-5.25-1 is up to date -- reinstalling
</span><span class='line'>warning: findutils-4.4.2-6 is up to date -- reinstalling
</span><span class='line'>warning: flex-2.6.0-1 is up to date -- reinstalling
</span><span class='line'>warning: gawk-4.1.3-1 is up to date -- reinstalling
</span><span class='line'>warning: gcc-5.3.0-3 is up to date -- reinstalling
</span><span class='line'>warning: gettext-0.19.6-2 is up to date -- reinstalling
</span><span class='line'>warning: grep-2.22-1 is up to date -- reinstalling
</span><span class='line'>warning: groff-1.22.3-5 is up to date -- reinstalling
</span><span class='line'>warning: gzip-1.6-1 is up to date -- reinstalling
</span><span class='line'>warning: libtool-2.4.6-4 is up to date -- reinstalling
</span><span class='line'>warning: m4-1.4.17-1 is up to date -- reinstalling
</span><span class='line'>warning: make-4.1-1 is up to date -- reinstalling
</span><span class='line'>warning: pacman-4.2.1-4 is up to date -- reinstalling
</span><span class='line'>warning: patch-2.7.5-1 is up to date -- reinstalling
</span><span class='line'>warning: pkg-config-0.29-1 is up to date -- reinstalling
</span><span class='line'>warning: sed-4.2.2-3 is up to date -- reinstalling
</span><span class='line'>warning: sudo-1.8.15-1 is up to date -- reinstalling
</span><span class='line'>warning: texinfo-6.0-1 is up to date -- reinstalling
</span><span class='line'>warning: util-linux-2.27.1-1 is up to date -- reinstalling
</span><span class='line'>warning: which-2.21-1 is up to date -- reinstalling
</span><span class='line'>resolving dependencies...
</span><span class='line'>looking for conflicting packages...
</span><span class='line'>
</span><span class='line'>Packages (25) autoconf-2.69-2  automake-1.15-1  binutils-2.25.1-3  bison-3.0.4-1  fakeroot-1.20.2-1  file-5.25-1  findutils-4.4.2-6  flex-2.6.0-1  gawk-4.1.3-1
</span><span class='line'>              gcc-5.3.0-3  gettext-0.19.6-2  grep-2.22-1  groff-1.22.3-5  gzip-1.6-1  libtool-2.4.6-4  m4-1.4.17-1  make-4.1-1  pacman-4.2.1-4  patch-2.7.5-1
</span><span class='line'>              pkg-config-0.29-1  sed-4.2.2-3  sudo-1.8.15-1  texinfo-6.0-1  util-linux-2.27.1-1  which-2.21-1
</span><span class='line'>
</span><span class='line'>Total Installed Size:  166.11 MiB
</span><span class='line'>Net Upgrade Size:        0.00 MiB
</span><span class='line'>
</span><span class='line'>:: Proceed with installation? [Y/n] y
</span><span class='line'>(25/25) checking keys in keyring                                                                    [##########################################################] 100%
</span><span class='line'>(25/25) checking package integrity                                                                  [##########################################################] 100%
</span><span class='line'>(25/25) loading package files                                                                       [##########################################################] 100%
</span><span class='line'>(25/25) checking for file conflicts                                                                 [##########################################################] 100%
</span><span class='line'>(25/25) checking available disk space                                                               [##########################################################] 100%
</span><span class='line'>( 1/25) reinstalling gawk                                                                           [##########################################################] 100%
</span><span class='line'>( 2/25) reinstalling m4                                                                             [##########################################################] 100%
</span><span class='line'>( 3/25) reinstalling autoconf                                                                       [##########################################################] 100%
</span><span class='line'>( 4/25) reinstalling automake                                                                       [##########################################################] 100%
</span><span class='line'>( 5/25) reinstalling binutils                                                                       [##########################################################] 100%
</span><span class='line'>( 6/25) reinstalling bison                                                                          [##########################################################] 100%
</span><span class='line'>( 7/25) reinstalling sed                                                                            [##########################################################] 100%
</span><span class='line'>( 8/25) reinstalling util-linux                                                                     [##########################################################] 100%
</span><span class='line'>( 9/25) reinstalling fakeroot                                                                       [##########################################################] 100%
</span><span class='line'>(10/25) reinstalling file                                                                           [##########################################################] 100%
</span><span class='line'>(11/25) reinstalling findutils                                                                      [##########################################################] 100%
</span><span class='line'>(12/25) reinstalling flex                                                                           [##########################################################] 100%
</span><span class='line'>(13/25) reinstalling gcc                                                                            [##########################################################] 100%
</span><span class='line'>(14/25) reinstalling gettext                                                                        [##########################################################] 100%
</span><span class='line'>(15/25) reinstalling grep                                                                           [##########################################################] 100%
</span><span class='line'>(16/25) reinstalling groff                                                                          [##########################################################] 100%
</span><span class='line'>(17/25) reinstalling gzip                                                                           [##########################################################] 100%
</span><span class='line'>(18/25) reinstalling libtool                                                                        [##########################################################] 100%
</span><span class='line'>(19/25) reinstalling texinfo                                                                        [##########################################################] 100%
</span><span class='line'>(20/25) reinstalling make                                                                           [##########################################################] 100%
</span><span class='line'>(21/25) reinstalling pacman                                                                         [##########################################################] 100%
</span><span class='line'>(22/25) reinstalling patch                                                                          [##########################################################] 100%
</span><span class='line'>(23/25) reinstalling pkg-config                                                                     [##########################################################] 100%
</span><span class='line'>(24/25) reinstalling sudo                                                                           [##########################################################] 100%
</span><span class='line'>(25/25) reinstalling which                                                                          [##########################################################] 100%
</span><span class='line'>[staf@fanny ~]$ </span></code></pre></td></tr></table></div></figure>


<h5>Install git</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>staf@fanny ~]$ sudo pacman -S git        
</span><span class='line'>warning: git-2.6.4-1 is up to date -- reinstalling
</span><span class='line'>resolving dependencies...
</span><span class='line'>looking for conflicting packages...
</span><span class='line'>
</span><span class='line'>Packages (1) git-2.6.4-1
</span><span class='line'>
</span><span class='line'>Total Installed Size:  22.92 MiB
</span><span class='line'>Net Upgrade Size:       0.00 MiB
</span><span class='line'>
</span><span class='line'>:: Proceed with installation? [Y/n] y
</span><span class='line'>(1/1) checking keys in keyring                                                                      [##########################################################] 100%
</span><span class='line'>(1/1) checking package integrity                                                                    [##########################################################] 100%
</span><span class='line'>(1/1) loading package files                                                                         [##########################################################] 100%
</span><span class='line'>(1/1) checking for file conflicts                                                                   [##########################################################] 100%
</span><span class='line'>(1/1) checking available disk space                                                                 [##########################################################] 100%
</span><span class='line'>(1/1) reinstalling git                                                                              [##########################################################] 100%
</span><span class='line'>[staf@fanny ~]$ </span></code></pre></td></tr></table></div></figure>


<h5>Install package-query</h5>

<h6>git clone</h6>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[staf@fanny aur]$ git clone https://aur.archlinux.org/package-query.git 
</span><span class='line'>Cloning into 'package-query'...
</span><span class='line'>remote: Counting objects: 16, done.
</span><span class='line'>remote: Compressing objects: 100% (16/16), done.
</span><span class='line'>remote: Total 16 (delta 0), reused 16 (delta 0)
</span><span class='line'>Unpacking objects: 100% (16/16), done.
</span><span class='line'>Checking connectivity... done.
</span><span class='line'>[staf@fanny aur]$ </span></code></pre></td></tr></table></div></figure>


<h5>makepkg</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[staf@fanny aur]$ cd package-query/
</span><span class='line'>[staf@fanny package-query]$ makepkg -sri
</span><span class='line'>==&gt; Making package: package-query 1.7-1 (Fri Dec 25 14:33:39 UTC 2015)
</span><span class='line'>==&gt; Checking runtime dependencies...
</span><span class='line'>==&gt; Checking buildtime dependencies...
</span><span class='line'>==&gt; Retrieving sources...
</span><span class='line'>  -&gt; Downloading package-query-1.7.tar.gz...
</span><span class='line'>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
</span><span class='line'>                                 Dload  Upload   Total   Spent    Left  Speed
</span><span class='line'>100  380k  100  380k    0     0   413k      0 --:--:-- --:--:-- --:--:--  413k
</span><span class='line'>==&gt; Validating source files with md5sums...
</span><span class='line'>    package-query-1.7.tar.gz ... Passed
</span><span class='line'>==&gt; Extracting sources...
</span><span class='line'>  -&gt; Extracting package-query-1.7.tar.gz with bsdtar
</span><span class='line'>==&gt; Starting build()...
</span><span class='line'>checking for a BSD-compatible install... /usr/bin/install -c
</span><span class='line'>checking whether build environment is sane... yes
</span><span class='line'>checking for a thread-safe mkdir -p... /usr/bin/mkdir -p
</span><span class='line'>checking for gawk... gawk
</span><span class='line'>&lt;snip&gt;
</span><span class='line'>config.status: executing depfiles commands
</span><span class='line'>config.status: executing libtool commands
</span><span class='line'>config.status: executing po-directories commands
</span><span class='line'>
</span><span class='line'>package-query:
</span><span class='line'>
</span><span class='line'>  Build information:
</span><span class='line'>    source code location   : .
</span><span class='line'>    prefix                 : /usr
</span><span class='line'>    sysconfdir             : /etc
</span><span class='line'>       conf file           : /etc/pacman.conf
</span><span class='line'>    localstatedir          : /var
</span><span class='line'>       database dir        : /var/lib/pacman/
</span><span class='line'>    compiler               : gcc
</span><span class='line'>    compiler flags         : -march=armv7-a -mfloat-abi=hard -mfpu=vfpv3-d16 -O2 -pipe -fstack-protector --param=ssp-buffer-size=4
</span><span class='line'>
</span><span class='line'>    package-query version  : 1.7
</span><span class='line'>    using git version      : no
</span><span class='line'>       git ver             : 
</span><span class='line'>
</span><span class='line'>  Variable information:
</span><span class='line'>    root working directory : /
</span><span class='line'>    aur base url           : https://aur.archlinux.org
</span><span class='line'>
</span><span class='line'>make  all-recursive
</span><span class='line'>make[1]: Entering directory '/home/staf/git/aur/package-query/src/package-query-1.7'
</span><span class='line'>Making all in src
</span><span class='line'>make[2]: Entering directory '/home/staf/git/aur/package-query/src/package-query-1.7/src'
</span><span class='line'>gcc -DLOCALEDIR=\"/usr/share/locale\" -DCONFFILE=\"/etc/pacman.conf\" -DROOTDIR=\"/\" -DDBPATH=\"/var/lib/pacman/\" -DAUR_BASE_URL=\"https://aur.archlinux.org\" -DHAVE_CONFIG_H  -I. -I..   -D_FORTIFY_SOURCE=2 -D_GNU_SOURCE -march=armv7-a -mfloat-abi=hard -mfpu=vfpv3-d16 -O2 -pipe -fstack-protector --param=ssp-buffer-size=4 -MT aur.o -MD -MP -MF .deps/aur.Tpo -c -o aur.o aur.c
</span><span class='line'>mv -f .deps/aur.Tpo .deps/aur.Po
</span><span class='line'>gcc -DLOCALEDIR=\"/usr/share/locale\" -DCONFFILE=\"/etc/pacman.conf\" -DROOTDIR=\"/\" -DDBPATH=\"/var/lib/pacman/\" -DAUR_BASE_URL=\"https://aur.archlinux.org\" -DHAVE_CONFIG_H  -I. -I..   -D_FORTIFY_SOURCE=2 -D_GNU_SOURCE -march=armv7-a -mfloat-abi=hard -mfpu=vfpv3-d16 -O2 -pipe -fstack-protector --param=ssp-buffer-size=4 -MT alpm-query.o -MD -MP -MF .deps/alpm-query.Tpo -c -o alpm-query.o alpm-query.c
</span><span class='line'>alpm-query.c: In function 'alpm_pkg_get_realsize':
</span><span class='line'> /usr/bin/mkdir -p '/home/staf/git/aur/package-query/pkg/package-query/usr/share/man/man8'
</span><span class='line'>&lt;snip&gt;
</span><span class='line'> /usr/bin/install -c -m 644 package-query.8 '/home/staf/git/aur/package-query/pkg/package-query/usr/share/man/man8'
</span><span class='line'>make[2]: Leaving directory '/home/staf/git/aur/package-query/src/package-query-1.7/doc'
</span><span class='line'>make[1]: Leaving directory '/home/staf/git/aur/package-query/src/package-query-1.7/doc'
</span><span class='line'>make[1]: Entering directory '/home/staf/git/aur/package-query/src/package-query-1.7'
</span><span class='line'>make[2]: Entering directory '/home/staf/git/aur/package-query/src/package-query-1.7'
</span><span class='line'>make[2]: Nothing to be done for 'install-exec-am'.
</span><span class='line'>make[2]: Nothing to be done for 'install-data-am'.
</span><span class='line'>make[2]: Leaving directory '/home/staf/git/aur/package-query/src/package-query-1.7'
</span><span class='line'>make[1]: Leaving directory '/home/staf/git/aur/package-query/src/package-query-1.7'
</span><span class='line'>==&gt; Tidying install...
</span><span class='line'>  -&gt; Purging unwanted files...
</span><span class='line'>  -&gt; Removing libtool files...
</span><span class='line'>  -&gt; Removing static library files...
</span><span class='line'>  -&gt; Compressing man and info pages...
</span><span class='line'>  -&gt; Stripping unneeded symbols from binaries and libraries...
</span><span class='line'>==&gt; Creating package "package-query"...
</span><span class='line'>  -&gt; Generating .PKGINFO file...
</span><span class='line'>  -&gt; Generating .MTREE file...
</span><span class='line'>  -&gt; Compressing package...
</span><span class='line'>==&gt; Leaving fakeroot environment.
</span><span class='line'>==&gt; Finished making: package-query 1.7-1 (Fri Dec 25 14:34:02 UTC 2015)
</span><span class='line'>==&gt; Installing package package-query with pacman -U...
</span><span class='line'>[sudo] password for staf: 
</span><span class='line'>loading packages...
</span><span class='line'>warning: package-query-1.7-1 is up to date -- reinstalling
</span><span class='line'>resolving dependencies...
</span><span class='line'>looking for conflicting packages...
</span><span class='line'>
</span><span class='line'>Packages (1) package-query-1.7-1
</span><span class='line'>
</span><span class='line'>Total Installed Size:  0.07 MiB
</span><span class='line'>Net Upgrade Size:      0.00 MiB
</span><span class='line'>
</span><span class='line'>:: Proceed with installation? [Y/n] y
</span><span class='line'>(1/1) checking keys in keyring                                                                      [##########################################################] 100%
</span><span class='line'>(1/1) checking package integrity                                                                    [##########################################################] 100%
</span><span class='line'>(1/1) loading package files                                                                         [##########################################################] 100%
</span><span class='line'>(1/1) checking for file conflicts                                                                   [##########################################################] 100%
</span><span class='line'>(1/1) checking available disk space                                                                 [##########################################################] 100%
</span><span class='line'>(1/1) reinstalling package-query                                                                    [##########################################################] 100%
</span><span class='line'>[staf@fanny package-query]$ </span></code></pre></td></tr></table></div></figure>


<h5>Install yaourt</h5>

<h6>git clone</h6>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[staf@fanny package-query]$ cd ~/git/aur   
</span><span class='line'>staf@fanny aur]$ git clone https://aur.archlinux.org/yaourt.git  
</span><span class='line'>Cloning into 'yaourt'...
</span><span class='line'>remote: Counting objects: 14, done.
</span><span class='line'>remote: Compressing objects: 100% (11/11), done.
</span><span class='line'>remote: Total 14 (delta 3), reused 14 (delta 3)
</span><span class='line'>Unpacking objects: 100% (14/14), done.
</span><span class='line'>Checking connectivity... done.
</span><span class='line'>[staf@fanny aur]$ </span></code></pre></td></tr></table></div></figure>


<p></p>

<h6>makepkg</h6>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[staf@fanny yaourt]$ makepkg -sri
</span><span class='line'>==&gt; Making package: yaourt 1.7-1 (Fri Dec 25 14:44:12 UTC 2015)
</span><span class='line'>==&gt; Checking runtime dependencies...
</span><span class='line'>==&gt; Checking buildtime dependencies...
</span><span class='line'>==&gt; Retrieving sources...
</span><span class='line'>  -&gt; Downloading yaourt-1.7.tar.gz...
</span><span class='line'>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
</span><span class='line'>                                 Dload  Upload   Total   Spent    Left  Speed
</span><span class='line'>100  123k  100  123k    0     0   222k      0 --:--:-- --:--:-- --:--:--  222k
</span><span class='line'>==&gt; Validating source files with md5sums...
</span><span class='line'>    yaourt-1.7.tar.gz ... Passed
</span><span class='line'>==&gt; Extracting sources...
</span><span class='line'>  -&gt; Extracting yaourt-1.7.tar.gz with bsdtar
</span><span class='line'>==&gt; Starting build()...
</span><span class='line'>        GEN yaourt.sh
</span><span class='line'>        GEN pacdiffviewer.sh
</span><span class='line'>        GEN yaourtrc
</span><span class='line'>        GEN lib/util.sh
</span><span class='line'>        GEN lib/pkgbuild.sh
</span><span class='line'>        GEN lib/pacman.sh
</span><span class='line'>        GEN lib/abs.sh
</span><span class='line'>==&gt; Entering fakeroot environment...
</span><span class='line'>==&gt; Starting package()...
</span><span class='line'>/usr/bin/env install -d /home/staf/git/aur/yaourt/pkg/yaourt/usr/bin
</span><span class='line'>/usr/bin/env install -d /home/staf/git/aur/yaourt/pkg/yaourt/usr/lib/yaourt
</span><span class='line'>/usr/bin/env install -d /home/staf/git/aur/yaourt/pkg/yaourt/etc
</span><span class='line'>/usr/bin/env install -d /home/staf/git/aur/yaourt/pkg/yaourt/usr/share/bash-completion/completions
</span><span class='line'>/usr/bin/env install -d /home/staf/git/aur/yaourt/pkg/yaourt/usr/share/man/man{5,8}
</span><span class='line'># Scripts
</span><span class='line'>/usr/bin/env install -m755 yaourt.sh /home/staf/git/aur/yaourt/pkg/yaourt/usr/bin/yaourt
</span><span class='line'>/usr/bin/env install -m755 pacdiffviewer.sh /home/staf/git/aur/yaourt/pkg/yaourt/usr/bin/pacdiffviewer
</span><span class='line'># Configuration
</span><span class='line'>/usr/bin/env install -m644 yaourtrc /home/staf/git/aur/yaourt/pkg/yaourt/etc/yaourtrc
</span><span class='line'>/usr/bin/env install -m644 bashcompletion /home/staf/git/aur/yaourt/pkg/yaourt/usr/share/bash-completion/completions/yaourt
</span><span class='line'># Libs
</span><span class='line'>/usr/bin/env install -m644 lib/alpm_backup.sh /home/staf/git/aur/yaourt/pkg/yaourt/usr/lib/yaourt
</span><span class='line'>/usr/bin/env install -m644 lib/alpm_query.sh /home/staf/git/aur/yaourt/pkg/yaourt/usr/lib/yaourt
</span><span class='line'>/usr/bin/env install -m644 lib/alpm_stats.sh /home/staf/git/aur/yaourt/pkg/yaourt/usr/lib/yaourt
</span><span class='line'>/usr/bin/env install -m644 lib/abs.sh /home/staf/git/aur/yaourt/pkg/yaourt/usr/lib/yaourt
</span><span class='line'>/usr/bin/env install -m644 lib/aur.sh /home/staf/git/aur/yaourt/pkg/yaourt/usr/lib/yaourt
</span><span class='line'>/usr/bin/env install -m644 lib/util.sh /home/staf/git/aur/yaourt/pkg/yaourt/usr/lib/yaourt
</span><span class='line'>/usr/bin/env install -m644 lib/io.sh /home/staf/git/aur/yaourt/pkg/yaourt/usr/lib/yaourt
</span><span class='line'>/usr/bin/env install -m644 lib/pacman.sh /home/staf/git/aur/yaourt/pkg/yaourt/usr/lib/yaourt
</span><span class='line'>/usr/bin/env install -m644 lib/pkgbuild.sh /home/staf/git/aur/yaourt/pkg/yaourt/usr/lib/yaourt
</span><span class='line'>/usr/bin/env install -m644 lib/misc.sh /home/staf/git/aur/yaourt/pkg/yaourt/usr/lib/yaourt
</span><span class='line'># Man
</span><span class='line'>/usr/bin/env install -m644 man/*.5 /home/staf/git/aur/yaourt/pkg/yaourt/usr/share/man/man5
</span><span class='line'>/usr/bin/env install -m644 man/*.8 /home/staf/git/aur/yaourt/pkg/yaourt/usr/share/man/man8
</span><span class='line'># Locales
</span><span class='line'>test -x /usr/bin/msgfmt && for file in po/*/*.po; \
</span><span class='line'>do \
</span><span class='line'>  package=$(echo $file | /bin/sed -e 's#po/\([^/]\+\).*#\1#'); \
</span><span class='line'>  lang=$(echo $file | /bin/sed -e 's#.*/\([^/]\+\).po#\1#'); \
</span><span class='line'>  /usr/bin/env install -d /home/staf/git/aur/yaourt/pkg/yaourt/usr/share/locale/$lang/LC_MESSAGES; \
</span><span class='line'>  /usr/bin/msgfmt -o /home/staf/git/aur/yaourt/pkg/yaourt/usr/share/locale/$lang/LC_MESSAGES/$package.mo $file; \
</span><span class='line'>done
</span><span class='line'>==&gt; Tidying install...
</span><span class='line'>  -&gt; Purging unwanted files...
</span><span class='line'>  -&gt; Removing libtool files...
</span><span class='line'>  -&gt; Removing static library files...
</span><span class='line'>  -&gt; Compressing man and info pages...
</span><span class='line'>  -&gt; Stripping unneeded symbols from binaries and libraries...
</span><span class='line'>==&gt; Creating package "yaourt"...
</span><span class='line'>  -&gt; Generating .PKGINFO file...
</span><span class='line'>  -&gt; Generating .MTREE file...
</span><span class='line'>  -&gt; Compressing package...
</span><span class='line'>==&gt; Leaving fakeroot environment.
</span><span class='line'>==&gt; Finished making: yaourt 1.7-1 (Fri Dec 25 14:44:16 UTC 2015)
</span><span class='line'>==&gt; Installing package yaourt with pacman -U...
</span><span class='line'>[sudo] password for staf: 
</span><span class='line'>loading packages...
</span><span class='line'>warning: yaourt-1.7-1 is up to date -- reinstalling
</span><span class='line'>resolving dependencies...
</span><span class='line'>looking for conflicting packages...
</span><span class='line'>
</span><span class='line'>Packages (1) yaourt-1.7-1
</span><span class='line'>
</span><span class='line'>Total Installed Size:  0.72 MiB
</span><span class='line'>Net Upgrade Size:      0.00 MiB
</span><span class='line'>
</span><span class='line'>:: Proceed with installation? [Y/n] y
</span><span class='line'>(1/1) checking keys in keyring                                                                      [##########################################################] 100%
</span><span class='line'>(1/1) checking package integrity                                                                    [##########################################################] 100%
</span><span class='line'>(1/1) loading package files                                                                         [##########################################################] 100%
</span><span class='line'>(1/1) checking for file conflicts                                                                   [##########################################################] 100%
</span><span class='line'>(1/1) checking available disk space                                                                 [##########################################################] 100%
</span><span class='line'>(1/1) reinstalling yaourt                                                                           [##########################################################] 100%
</span><span class='line'>[staf@fanny yaourt]$ </span></code></pre></td></tr></table></div></figure>


<h4>Install debootstrap</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[staf@fanny ~]$ yaourt debootstrap
</span><span class='line'>1 aur/cdebootstrap-static 0.6.5-1 (10)
</span><span class='line'>    Bootstrap a Debian system
</span><span class='line'>2 aur/debootstrap 1.0.75-1 [installed] (224)
</span><span class='line'>    A tool used to create a Debian base system from scratch, without requiring the availability of dpkg or apt
</span><span class='line'>3 aur/rinse 3.0.2-2 (0)
</span><span class='line'>    Bootstrap a rpm based distribution like debootstrap
</span><span class='line'>==&gt; Enter n° of packages to be installed (ex: 1 2 3 or 1-3)
</span><span class='line'>==&gt; --------------------------------------------------------
</span><span class='line'>==&gt; 2
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>==&gt; Downloading debootstrap PKGBUILD from AUR...
</span><span class='line'>x .SRCINFO
</span><span class='line'>x .gitignore
</span><span class='line'>x PKGBUILD
</span><span class='line'>zeilenleser commented on 2015-07-29 10:49 
</span><span class='line'>Thanks for maintaining this package.
</span><span class='line'>
</span><span class='line'>just for your information, version 1.0.72 is out since 2015-07-28
</span><span class='line'>
</span><span class='line'>Regards
</span><span class='line'>
</span><span class='line'>zeilenleser commented on 2015-07-29 12:13 
</span><span class='line'>I followed @Tigrouzens suggestion with this modification
</span><span class='line'>
</span><span class='line'>DEF_MIRROR="http://mirrors.kernel.org/ubuntu"
</span><span class='line'>
</span><span class='line'>Since only DEF_HTTPS_MIRROR is used in my case I don't know if this works. Testing with the browser was successful.
</span><span class='line'>
</span><span class='line'>bricewge commented on 2015-12-07 16:58 (last edited on 2015-12-07 16:58 by bricewge) 
</span><span class='line'>@Tigrouzens why don't you want to install ubuntu-keyring?
</span><span class='line'>
</span><span class='line'>Your advice didn't work for me, I still had the error about GPG. But after installing gnupg1 and ubuntu-keyring, enrering the following command worked fine.
</span><span class='line'># debootstrap wily ubuntu https://mirrors.kernel.org/ubuntu
</span><span class='line'>
</span><span class='line'>abeutot commented on 2015-12-08 11:57 
</span><span class='line'>Seems like there is a missing dependency to binutils since ar is needed to extract deb packages.
</span><span class='line'>
</span><span class='line'>JonnyJD commented on 2015-12-08 12:12 
</span><span class='line'>binutils is in the "base-devel" group which is an implicit requirement before using the AUR altogether:
</span><span class='line'>https://wiki.archlinux.org/index.php/Arch_User_Repository#Prerequisites
</span><span class='line'>
</span><span class='line'>debootstrap 1.0.75-1  (2015-11-12 16:15)
</span><span class='line'>( Unsupported package: Potentially dangerous ! )
</span><span class='line'>==&gt; Edit PKGBUILD ? [Y/n] ("A" to abort)
</span><span class='line'>==&gt; ------------------------------------
</span><span class='line'>==&gt; n
</span><span class='line'>
</span><span class='line'>==&gt; debootstrap dependencies:
</span><span class='line'> - wget (already installed)
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>==&gt; Continue building debootstrap ? [Y/n]
</span><span class='line'>==&gt; -------------------------------------
</span><span class='line'>==&gt; 
</span><span class='line'>==&gt; Building and installing package
</span><span class='line'>==&gt; Making package: debootstrap 1.0.75-1 (Fri Dec 25 14:48:55 UTC 2015)
</span><span class='line'>==&gt; Checking runtime dependencies...
</span><span class='line'>==&gt; Checking buildtime dependencies...
</span><span class='line'>==&gt; Retrieving sources...
</span><span class='line'>  -&gt; Downloading debootstrap_1.0.75_all.deb...
</span><span class='line'>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
</span><span class='line'>                                 Dload  Upload   Total   Spent    Left  Speed
</span><span class='line'>100 65978  100 65978    0     0   155k      0 --:--:-- --:--:-- --:--:--  155k
</span><span class='line'>==&gt; Validating source files with md5sums...
</span><span class='line'>    debootstrap_1.0.75_all.deb ... Passed
</span><span class='line'>==&gt; Extracting sources...
</span><span class='line'>  -&gt; Extracting debootstrap_1.0.75_all.deb with bsdtar
</span><span class='line'>==&gt; Entering fakeroot environment...
</span><span class='line'>==&gt; Starting package()...
</span><span class='line'>==&gt; Tidying install...
</span><span class='line'>  -&gt; Purging unwanted files...
</span><span class='line'>  -&gt; Removing libtool files...
</span><span class='line'>  -&gt; Removing static library files...
</span><span class='line'>  -&gt; Compressing man and info pages...
</span><span class='line'>  -&gt; Stripping unneeded symbols from binaries and libraries...
</span><span class='line'>==&gt; Creating package "debootstrap"...
</span><span class='line'>  -&gt; Generating .PKGINFO file...
</span><span class='line'>  -&gt; Generating .MTREE file...
</span><span class='line'>  -&gt; Compressing package...
</span><span class='line'>==&gt; Leaving fakeroot environment.
</span><span class='line'>==&gt; Finished making: debootstrap 1.0.75-1 (Fri Dec 25 14:48:57 UTC 2015)
</span><span class='line'>
</span><span class='line'>==&gt; Continue installing debootstrap ? [Y/n]
</span><span class='line'>==&gt; [v]iew package contents [c]heck package with namcap
</span><span class='line'>==&gt; ---------------------------------------------------
</span><span class='line'>==&gt; y
</span><span class='line'>
</span><span class='line'>loading packages...
</span><span class='line'>warning: debootstrap-1.0.75-1 is up to date -- reinstalling
</span><span class='line'>resolving dependencies...
</span><span class='line'>looking for conflicting packages...
</span><span class='line'>
</span><span class='line'>Packages (1) debootstrap-1.0.75-1
</span><span class='line'>
</span><span class='line'>Total Installed Size:  0.19 MiB
</span><span class='line'>Net Upgrade Size:      0.00 MiB
</span><span class='line'>
</span><span class='line'>:: Proceed with installation? [Y/n] y
</span><span class='line'>(1/1) checking keys in keyring                                                                      [##########################################################] 100%
</span><span class='line'>(1/1) checking package integrity                                                                    [##########################################################] 100%
</span><span class='line'>(1/1) loading package files                                                                         [##########################################################] 100%
</span><span class='line'>(1/1) checking for file conflicts                                                                   [##########################################################] 100%
</span><span class='line'>(1/1) checking available disk space                                                                 [##########################################################] 100%
</span><span class='line'>(1/1) reinstalling debootstrap                                                                      [##########################################################] 100%
</span><span class='line'>[staf@fanny ~]$ </span></code></pre></td></tr></table></div></figure>


<h4>gpg keyring</h4>

<p>debootrap needs gnupg1 there is an aur available <a href="https://aur.archlinux.org/packages/gnupg1/"><a href="https://aur.archlinux.org/packages/gnupg1/">https://aur.archlinux.org/packages/gnupg1/</a></a> but armv7h isn&rsquo;t include in the supported architectures so we&rsquo;ll need to add it.</p>

<h5>Install gnupg1</h5>

<h6>Git clone</h6>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[staf@fanny ~]$ cd ~/git/aur
</span><span class='line'>staf@fanny aur]$ git clone https://aur.archlinux.org/gnupg1.git
</span><span class='line'>Cloning into 'gnupg1'...
</span><span class='line'>remote: Counting objects: 8, done.
</span><span class='line'>remote: Compressing objects: 100% (8/8), done.
</span><span class='line'>remote: Total 8 (delta 0), reused 8 (delta 0)
</span><span class='line'>Unpacking objects: 100% (8/8), done.
</span><span class='line'>Checking connectivity... done.
</span><span class='line'>[staf@fanny aur]$ </span></code></pre></td></tr></table></div></figure>


<h6>Update PKGBUILD</h6>

<p>Edit PKGBUILD</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[staf@fanny gnupg1]$ vi PKGBUILD </span></code></pre></td></tr></table></div></figure>


<p>and add armv7h to the arch</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>pkgdesc="GNU Privacy Guard - a PGP replacement tool"
</span><span class='line'>arch=('i686' 'x86_64' 'armv6h' 'armv7h')
</span><span class='line'>license=('GPL3')
</span><span class='line'>depends=('zlib' 'bzip2' 'libldap&gt;=2.4.18' 'libusb-compat' 'curl&gt;=7.16.2' 'readline&gt;=6.0.00')</span></code></pre></td></tr></table></div></figure>


<h6>Update the keyring</h6>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[staf@fanny gnupg1]$ gpg --keyserver pgpkeys.mit.edu --recv-keys 2071B08A33BD3F06 
</span><span class='line'>gpg: key 33BD3F06: "NIIBE Yutaka (GnuPG Release Key) &lt;gniibe@fsij.org&gt;" not changed
</span><span class='line'>gpg: Total number processed: 1
</span><span class='line'>gpg:              unchanged: 1
</span><span class='line'>[staf@fanny gnupg1]$ </span></code></pre></td></tr></table></div></figure>


<h6>makepkg</h6>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[staf@fanny gnupg1]$ makepkg -sri
</span><span class='line'>&lt;snip&gt;
</span><span class='line'>  -&gt; Adding install file...
</span><span class='line'>  -&gt; Generating .MTREE file...
</span><span class='line'>  -&gt; Compressing package...
</span><span class='line'>==&gt; Leaving fakeroot environment.
</span><span class='line'>==&gt; Finished making: gnupg1 1.4.19-4 (Sat Dec 26 13:49:19 UTC 2015)
</span><span class='line'>==&gt; Installing package gnupg1 with pacman -U...
</span><span class='line'>[sudo] password for staf: 
</span><span class='line'>loading packages...
</span><span class='line'>resolving dependencies...
</span><span class='line'>looking for conflicting packages...
</span><span class='line'>
</span><span class='line'>Packages (1) gnupg1-1.4.19-4
</span><span class='line'>
</span><span class='line'>Total Installed Size:  4.97 MiB
</span><span class='line'>
</span><span class='line'>:: Proceed with installation? [Y/n] y
</span><span class='line'>(1/1) checking keys in keyring                                                         [##################################################] 100%
</span><span class='line'>(1/1) checking package integrity                                                       [##################################################] 100%
</span><span class='line'>(1/1) loading package files                                                            [##################################################] 100%
</span><span class='line'>(1/1) checking for file conflicts                                                      [##################################################] 100%
</span><span class='line'>(1/1) checking available disk space                                                    [##################################################] 100%
</span><span class='line'>(1/1) installing gnupg1                                                                [##################################################] 100%
</span><span class='line'>[staf@fanny gnupg1]$ </span></code></pre></td></tr></table></div></figure>


<h5>Install the  debian-archive-keyring aur</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[staf@fanny debian]$ yaourt debian-archive-keyring 
</span><span class='line'>1 aur/debian-archive-keyring 2014.3-2 (59)
</span><span class='line'>    GnuPG archive keys of the Debian archive
</span><span class='line'>==&gt; Enter n° of packages to be installed (ex: 1 2 3 or 1-3)
</span><span class='line'>==&gt; --------------------------------------------------------
</span><span class='line'>==&gt; 1
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>==&gt; Downloading debian-archive-keyring PKGBUILD from AUR...
</span><span class='line'>x .SRCINFO
</span><span class='line'>x PKGBUILD
</span><span class='line'>eworm commented on 2013-05-13 12:20 
</span><span class='line'>Please use package() function, recent makepkg warns about that.
</span><span class='line'>
</span><span class='line'>hcartiaux commented on 2013-05-15 08:00 
</span><span class='line'>Fixed
</span><span class='line'>
</span><span class='line'>ansys commented on 2014-10-24 11:31 
</span><span class='line'>New url http://ftp.fr.debian.org/debian/pool/main/d/debian-archive-keyring/debian-archive-keyring_2014.1_all.deb
</span><span class='line'>
</span><span class='line'>kozaki commented on 2014-12-11 14:58 
</span><span class='line'>Update
</span><span class='line'>url: http://ftp.fr.debian.org/debian/pool/main/d/debian-archive-keyring/debian-archive-keyring_2014.3_all.deb
</span><span class='line'>md5: 02b6818bd7cada9ef9d24534290b559c
</span><span class='line'>
</span><span class='line'>Thank you.
</span><span class='line'>
</span><span class='line'>debian-archive-keyring 2014.3-2  (2015-06-08 20:20)
</span><span class='line'>( Unsupported package: Potentially dangerous ! )
</span><span class='line'>==&gt; Edit PKGBUILD ? [Y/n] ("A" to abort)
</span><span class='line'>==&gt; ------------------------------------
</span><span class='line'>==&gt; n
</span><span class='line'>
</span><span class='line'>==&gt; debian-archive-keyring dependencies:
</span><span class='line'> - gnupg (already installed)
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>==&gt; Continue building debian-archive-keyring ? [Y/n]
</span><span class='line'>==&gt; ------------------------------------------------
</span><span class='line'>==&gt; 
</span><span class='line'>==&gt; Building and installing package
</span><span class='line'>==&gt; Making package: debian-archive-keyring 2014.3-2 (Sat Dec 26 13:02:52 UTC 2015)
</span><span class='line'>==&gt; Checking runtime dependencies...
</span><span class='line'>==&gt; Checking buildtime dependencies...
</span><span class='line'>==&gt; Retrieving sources...
</span><span class='line'>  -&gt; Downloading debian-archive-keyring_2014.3_all.deb...
</span><span class='line'>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
</span><span class='line'>                                 Dload  Upload   Total   Spent    Left  Speed
</span><span class='line'>100 40060  100 40060    0     0   103k      0 --:--:-- --:--:-- --:--:--  103k
</span><span class='line'>==&gt; Validating source files with md5sums...
</span><span class='line'>    debian-archive-keyring_2014.3_all.deb ... Passed
</span><span class='line'>==&gt; Extracting sources...
</span><span class='line'>  -&gt; Extracting debian-archive-keyring_2014.3_all.deb with bsdtar
</span><span class='line'>==&gt; Entering fakeroot environment...
</span><span class='line'>==&gt; Starting package()...
</span><span class='line'>./
</span><span class='line'>./usr/
</span><span class='line'>./usr/share/
</span><span class='line'>&lt;snip&gt;
</span><span class='line'>
</span><span class='line'>==&gt; Continue installing debian-archive-keyring ? [Y/n]
</span><span class='line'>==&gt; [v]iew package contents [c]heck package with namcap
</span><span class='line'>==&gt; ---------------------------------------------------
</span><span class='line'>==&gt; y
</span><span class='line'>
</span><span class='line'>loading packages...
</span><span class='line'>resolving dependencies...
</span><span class='line'>looking for conflicting packages...
</span><span class='line'>
</span><span class='line'>Packages (1) debian-archive-keyring-2014.3-2
</span><span class='line'>
</span><span class='line'>Total Installed Size:  0.07 MiB
</span><span class='line'>
</span><span class='line'>:: Proceed with installation? [Y/n] y
</span><span class='line'>(1/1) checking keys in keyring                                                                                                                                                                                                                                  [##################################################################################################################################################################] 100%
</span><span class='line'>(1/1) checking package integrity                                                                                                                                                                                                                                [##################################################################################################################################################################] 100%
</span><span class='line'>(1/1) loading package files                                                                                                                                                                                                                                     [##################################################################################################################################################################] 100%
</span><span class='line'>(1/1) checking for file conflicts                                                                                                                                                                                                                               [##################################################################################################################################################################] 100%
</span><span class='line'>(1/1) checking available disk space                                                                                                                                                                                                                             [##################################################################################################################################################################] 100%
</span><span class='line'>(1/1) installing debian-archive-keyring                                                                                                                                                                                                                         [##################################################################################################################################################################] 100%
</span><span class='line'>[staf@fanny debian]$ </span></code></pre></td></tr></table></div></figure>


<h4>debootstrap</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[staf@fanny debian]$ sudo debootstrap --verbose --include=iproute,iputils-ping --arch armhf jessie ./jessie-chroot http://http.debian.net/debian/
</span><span class='line'>[staf@fanny debian]$ sudo debootstrap --verbose --include=iproute,iputils-ping --arch armhf jessie ./jessie-chroot http://http.debian.net/debian/
</span><span class='line'>[sudo] password for staf: 
</span><span class='line'>I: Retrieving Release 
</span><span class='line'>I: Retrieving Release.gpg 
</span><span class='line'>I: Checking Release signature
</span><span class='line'>I: Valid Release signature (key id 75DDC3C4A499F1A18CB5F3C8CBF8D6FD518E17E1)
</span><span class='line'>&lt;snip&gt;
</span><span class='line'>I: Configuring libgnutls-openssl27:armhf...
</span><span class='line'>I: Configuring iputils-ping...
</span><span class='line'>I: Configuring isc-dhcp-common...
</span><span class='line'>I: Configuring isc-dhcp-client...
</span><span class='line'>I: Configuring tasksel...
</span><span class='line'>I: Configuring tasksel-data...
</span><span class='line'>I: Configuring libc-bin...
</span><span class='line'>I: Configuring systemd...
</span><span class='line'>I: Base system installed successfully.
</span></code></pre></td></tr></table></div></figure>


<h4>Import</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>staf@fanny jessie-chroot]$ sudo tar cpf - . | docker import - debian
</span><span class='line'>[sudo] password for staf: 
</span><span class='line'>1ec165fa2ccb264ab8196b8cd0c339b5d95e1b90879019cde0c633cca738277a
</span><span class='line'>[staf@fanny jessie-chroot]$ </span></code></pre></td></tr></table></div></figure>


<h4>Try it</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>staf@fanny jessie-chroot]$ docker run -t -i --rm debian /bin/bash
</span><span class='line'>root@81afce29909f:/# cat /etc/debian_version 
</span><span class='line'>8.2
</span><span class='line'>root@81afce29909f:/# </span></code></pre></td></tr></table></div></figure>


<p><strong><em> Have fun &hellip; </em></strong></p>

<h4>Links</h4>

<ul>
<li><a href="http://archlinuxarm.org/"><a href="http://archlinuxarm.org/">http://archlinuxarm.org/</a></a></li>
<li><a href="http://archlinuxarm.org/platforms/armv7/samsung/odroid-u3"><a href="http://archlinuxarm.org/platforms/armv7/samsung/odroid-u3">http://archlinuxarm.org/platforms/armv7/samsung/odroid-u3</a></a></li>
<li><a href="https://wiki.archlinux.org/index.php/Docker"><a href="https://wiki.archlinux.org/index.php/Docker">https://wiki.archlinux.org/index.php/Docker</a></a></li>
<li><a href="http://forum.odroid.com/viewtopic.php?f=98&t=6638"><a href="http://forum.odroid.com/viewtopic.php?f=98&amp;t=6638">http://forum.odroid.com/viewtopic.php?f=98&amp;t=6638</a>">[Docker] lightweight virtualisation for your odroid host</a></li>
</ul>

</div>
  
  

<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- blog_actrikel -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-4659298941528586"
     data-ad-slot="7394058542"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2015/12/05/protecting-your-ssh-keys-with-smartcard-hsm/">Protecting Your SSH Keys With SmartCard-HSM</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-12-05T09:37:41+01:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>5</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>9:37 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I <a href="http://stafwag.github.io/blog/blog/2015/06/16/using-yubikey-neo-as-gpg-smartcard-for-ssh-authentication/">use</a> a  <a href="https://www.yubico.com/products/yubikey-hardware/yubikey-neo/">yubi key</a> for my ssh authentication. But I&rsquo;ve other ssh keys for my remote services so wanted something that allows me to take a backup of my keys see <a href="http://stafwag.github.io/blog/blog/2015/11/21/starting-to-protect-my-private-keys-with-smartcard-hsm/">this post</a> for more information on to backup/restore a <a href="http://www.smartcard-hsm.com">SmartCard-HSM</a></p>

<h2>Create your first ssh keypair</h2>

<h3>Verify your smartcard connection</h3>

<p>Insert you smartcard and verify the connection, see <a href="http://stafwag.github.io/blog/blog/2015/11/21/starting-to-protect-my-private-keys-with-smartcard-hsm/">my previous post</a> if  you need more information about the smartcard initialization</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[staf@vicky ~]$ pkcs11-tool -L
</span><span class='line'>Available slots:
</span><span class='line'>Slot 0 (0xffffffffffffffff): Virtual hotplug slot
</span><span class='line'>  (empty)
</span><span class='line'>Slot 1 (0x1): Generic Smart Card Reader Interface [Smart Card Reader Interface
</span><span class='line'>  token label        : SmartCard-HSM (UserPIN)
</span><span class='line'>  token manufacturer : www.CardContact.de
</span><span class='line'>  token model        : PKCS#15 emulated
</span><span class='line'>  token flags        : rng, login required, PIN initialized, token initialized
</span><span class='line'>  hardware version   : 24.13
</span><span class='line'>  firmware version   : 1.2
</span><span class='line'>  serial num         : DECM0102331
</span><span class='line'>[staf@vicky ~]$ </span></code></pre></td></tr></table></div></figure>


<h3>Create your keypair</h3>

<p>Create your ssh key pair and give the a meaningful label</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[staf@vicky ~]$ pkcs11-tool --slot 1 --keypairgen --key-type rsa:2048 --label my_ssh_key --login
</span><span class='line'>Logging in to "SmartCard-HSM (UserPIN)".
</span><span class='line'>Please enter User PIN: 
</span><span class='line'>Key pair generated:
</span><span class='line'>Private Key Object; RSA 
</span><span class='line'>  label:      my_ssh_key
</span><span class='line'>  ID:         fca6240eeef8d3156f0c4dfc591b2d938d6104cb
</span><span class='line'>  Usage:      decrypt, sign, unwrap
</span><span class='line'>Public Key Object; RSA 2048 bits
</span><span class='line'>  label:      my_ssh_key
</span><span class='line'>  ID:         fca6240eeef8d3156f0c4dfc591b2d938d6104cb
</span><span class='line'>  Usage:      encrypt, verify, wrap
</span><span class='line'>[staf@vicky ~]$ </span></code></pre></td></tr></table></div></figure>


<h3>Extract your public key</h3>

<p>We used <a href="https://en.wikipedia.org/wiki/PKCS_11">PKCS11</a> to generate the keypair, <a href="https://en.wikipedia.org/wiki/PKCS">PKCS15</a> is designed identify users to applications.</p>

<h4>Dump the token content</h4>

<p>Dump the token content to get the id of your ssh keypair.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[staf@vicky ~]$ pkcs15-tool -D
</span><span class='line'>Using reader with a card: Generic Smart Card Reader Interface [Smart Card Reader Interface] (20070818000000000) 00 00
</span><span class='line'>PKCS#15 Card [SmartCard-HSM]:
</span><span class='line'>        Version        : 0
</span><span class='line'>        Serial number  : DECM0102331
</span><span class='line'>        Manufacturer ID: www.CardContact.de
</span><span class='line'>        Flags          : 
</span><span class='line'>
</span><span class='line'>PIN [UserPIN]
</span><span class='line'>        Object Flags   : [0x3], private, modifiable
</span><span class='line'>        ID             : 01
</span><span class='line'>        Flags          : [0x81A], local, unblock-disabled, initialized, exchangeRefData
</span><span class='line'>        Length         : min_len:6, max_len:15, stored_len:0
</span><span class='line'>        Pad char       : 0x00
</span><span class='line'>        Reference      : 129 (0x81)
</span><span class='line'>        Type           : ascii-numeric
</span><span class='line'>        Tries left     : 3
</span><span class='line'>
</span><span class='line'>PIN [SOPIN]
</span><span class='line'>        Object Flags   : [0x1], private
</span><span class='line'>        ID             : 02
</span><span class='line'>        Flags          : [0x9E], local, change-disabled, unblock-disabled, initialized, soPin
</span><span class='line'>        Length         : min_len:16, max_len:16, stored_len:0
</span><span class='line'>        Pad char       : 0x00
</span><span class='line'>        Reference      : 136 (0x88)
</span><span class='line'>        Type           : bcd
</span><span class='line'>        Tries left     : 3
</span><span class='line'>
</span><span class='line'>Private EC Key [myfirst_keypair]
</span><span class='line'>        Object Flags   : [0x3], private, modifiable
</span><span class='line'>        Usage          : [0x10C], sign, signRecover, derive
</span><span class='line'>        Access Flags   : [0x1D], sensitive, alwaysSensitive, neverExtract, local
</span><span class='line'>        FieldLength    : 256
</span><span class='line'>        Key ref        : 1 (0x1)
</span><span class='line'>        Native         : yes
</span><span class='line'>        Path           : e82b0601040181c31f0201::
</span><span class='line'>        Auth ID        : 01
</span><span class='line'>        ID             : ae79417e809ed19b9a69d4c14f444462ad0bd66c
</span><span class='line'>        MD:guid        : {efac9b29-2289-658c-98d1-af5af965d484}
</span><span class='line'>          :cmap flags  : 0x0
</span><span class='line'>          :sign        : 0
</span><span class='line'>          :key-exchange: 0
</span><span class='line'>
</span><span class='line'>Private RSA Key [my_ssh_key]
</span><span class='line'>        Object Flags   : [0x3], private, modifiable
</span><span class='line'>        Usage          : [0x2E], decrypt, sign, signRecover, unwrap
</span><span class='line'>        Access Flags   : [0x1D], sensitive, alwaysSensitive, neverExtract, local
</span><span class='line'>        ModLength      : 2048
</span><span class='line'>        Key ref        : 2 (0x2)
</span><span class='line'>        Native         : yes
</span><span class='line'>        Path           : e82b0601040181c31f0201::
</span><span class='line'>        Auth ID        : 01
</span><span class='line'>        ID             : fca6240eeef8d3156f0c4dfc591b2d938d6104cb
</span><span class='line'>        MD:guid        : {a272b2ad-ff6f-606c-801a-4153be498018}
</span><span class='line'>          :cmap flags  : 0x0
</span><span class='line'>          :sign        : 0
</span><span class='line'>          :key-exchange: 0
</span><span class='line'>
</span><span class='line'>Public EC Key [myfirst_keypair]
</span><span class='line'>        Object Flags   : [0x0]
</span><span class='line'>        Usage          : [0x0]
</span><span class='line'>        Access Flags   : [0x2], extract
</span><span class='line'>        FieldLength    : 256
</span><span class='line'>        Key ref        : 0 (0x0)
</span><span class='line'>        Native         : no
</span><span class='line'>        ID             : ae79417e809ed19b9a69d4c14f444462ad0bd66c
</span><span class='line'>        DirectValue    : &lt;present&gt;
</span><span class='line'>
</span><span class='line'>Public RSA Key [my_ssh_key]
</span><span class='line'>        Object Flags   : [0x0]
</span><span class='line'>        Usage          : [0x0]
</span><span class='line'>        Access Flags   : [0x2], extract
</span><span class='line'>        ModLength      : 2048
</span><span class='line'>        Key ref        : 0 (0x0)
</span><span class='line'>        Native         : no
</span><span class='line'>        ID             : fca6240eeef8d3156f0c4dfc591b2d938d6104cb
</span><span class='line'>        DirectValue    : &lt;present&gt;
</span><span class='line'>
</span><span class='line'>[staf@vicky ~]$ </span></code></pre></td></tr></table></div></figure>


<h4>Get the public key</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[staf@vicky ~]$ pkcs15-tool --read-ssh-key fca6240eeef8d3156f0c4dfc591b2d938d6104cb
</span><span class='line'>Using reader with a card: Generic Smart Card Reader Interface [Smart Card Reader Interface] (20070818000000000) 00 00
</span><span class='line'>ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCWShfPjqh+pU8lCoIhXIXh+cGpSem1iNFH6TuluQQLPiqPIeObCTfqC8q9TjR/2FYzG+3ECdiRr0fiywE9OnzUgJI5oOjXfMwY3xE1PbYBrSvYERofhkEv2ejlyRifN3sbLGSU0V7pX+BNOuiJCquCehPMV9+ehkjbk9hPRFUzL1GywsOkmWUoIzrdjH0dlhPX3TUCdoizWAIdUqg+RX4DCEc52RvaGdX4Tn2THxeffXqFJ/gKkParZSLmOND1iRhtJeJ8CmgAqfD8ReshbcSs231h/QvUl3JaThcrLbPrSQFzVUH+rN+pGlSl722NWyPNPWlwwE+SreTLbQRoWayN my_ssh_key
</span><span class='line'>[staf@vicky ~]$ </span></code></pre></td></tr></table></div></figure>


<h3>Configure the remote host</h3>

<p>Add the key to the remote host</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>staf@vicky .ssh]$ vi authorized_keys 
</span><span class='line'>[staf@vicky .ssh]$ 
</span></code></pre></td></tr></table></div></figure>


<h3>Test the connection</h3>

<p>Test you ssh connection with the PKCS11 interface:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[staf@vicky ~]$ ssh localhost
</span><span class='line'>Permission denied (publickey,gssapi-keyex,gssapi-with-mic).</span></code></pre></td></tr></table></div></figure>


<p>With the PKCS11 interface enabled:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[staf@vicky ~]$ ssh -o "PKCS11Provider opensc-pkcs11.so" localhost
</span><span class='line'>C_GetAttributeValue failed: 18
</span><span class='line'>Enter PIN for 'SmartCard-HSM (UserPIN)': 
</span><span class='line'>Last login: Thu Dec  3 09:55:23 2015 from ::1
</span><span class='line'>gpg-agent[17327]: enabled debug flags: command cache ipc
</span><span class='line'>gpg-agent: a gpg-agent is already running - not starting a new one
</span><span class='line'>gpg-agent: secmem usage: 0/32768 bytes in 0 blocks
</span><span class='line'>[staf@vicky ~]$ </span></code></pre></td></tr></table></div></figure>


<h3>Update your ssh_config</h3>

<p>Add PKCS11Provider opensc-pkcs11.so to your ~/.ssh/config or your global ssh_config</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>staf@vicky ~]$ cd .ssh/
</span><span class='line'>[staf@vicky .ssh]$ vim config
</span><span class='line'>PKCS11Provider opensc-pkcs11.so
</span><span class='line'>[staf@vicky .ssh]$ </span></code></pre></td></tr></table></div></figure>


<p></p>

<p><strong><em> Have fun &hellip; </em></strong></p>
</div>
  
  

<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- blog_actrikel -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-4659298941528586"
     data-ad-slot="7394058542"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2015/11/21/starting-to-protect-my-private-keys-with-smartcard-hsm/">Starting to Protect My Private Keys With SmartCard-Hsm</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-11-21T10:32:06+01:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>21</span><span class='date-suffix'>st</span>, <span class='date-year'>2015</span></span> <span class='time'>10:32 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I still have too many private keys on a local filesystem, I started to use the <a href="https://www.yubico.com/products/yubikey-hardware/yubikey-neo/">yubikey neo</a> for <a href="http://stafwag.github.io/blog/blog/2015/06/16/using-yubikey-neo-as-gpg-smartcard-for-ssh-authentication/">my ssh authentication</a>. Mainly because the nice formfactor of the yubikey.</p>

<p>For my other private keys/data I was looking for something cheeper since I need to have a backup of my secured data so I bought a few <a href="http://www.smartcard-hsm.com">Smartcard-HSM smartcards</a> they cost 16 &euro; each while a yubi-key neo cost 54 &euro; at amazon.de</p>

<h2>Preparing Backup and Restore</h2>

<p>The Smartcard-HSM has a backup/restore functionality this needs to be enabled before any keys are generated on the HSM.</p>

<p>To store our Device Key Encryption Key (DKEK) securely we need a safe place, we&rsquo;ll use an ecrypted usb stick.</p>

<p>It'is possible to configure multiple DKEK shares e.g. you will need multiple keys to perform a backup restore you might want to store these DKEK shares over multiple (encrypted) USB sticks/people.</p>

<p>If you want to create a backup of your DKEK shares we need to store at least two encrypted USB sticks.</p>

<p>For the convenience we&rsquo;ll store all DKEK shares on 1 encrypted USB stick in the example below you should executed it on an secured computer.</p>

<h3>Install opensc</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>staf@vicky ~]$ sudo dnf install opensc
</span><span class='line'>Last metadata expiration check performed 0:23:14 ago on Wed Nov 11 14:47:21 2015.
</span><span class='line'>Package opensc-0.15.0-2.fc23.x86_64 is already installed, skipping.
</span><span class='line'>Dependencies resolved.
</span><span class='line'>Nothing to do.
</span><span class='line'>Complete!
</span><span class='line'>[staf@vicky ~]$ </span></code></pre></td></tr></table></div></figure>


<h3>Create an encrypted USB key stick</h3>

<h4>Write random data to the USB stick</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[staf@vicky ~]$ sudo dd if=/dev/urandom of=/dev/sdn bs=1024
</span><span class='line'>[sudo] password for staf:                                                                                      
</span><span class='line'>dd: error writing ‘/dev/sdn’: No space left on device                                                          
</span><span class='line'>4029441+0 records in                                                                                           
</span><span class='line'>4029440+0 records out                                                                                          
</span><span class='line'>4126146560 bytes (4.1 GB) copied, 1280.14 s, 3.2 MB/s                                                          
</span><span class='line'>[staf@vicky ~]$ </span></code></pre></td></tr></table></div></figure>


<h4>luksFormat</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[staf@vicky ~]$ sudo cryptsetup luksFormat --cipher serpent-cbc-essiv:sha256 --key-size 256 /dev/sdn
</span><span class='line'>
</span><span class='line'>WARNING!
</span><span class='line'>========
</span><span class='line'>This will overwrite data on /dev/sdn irrevocably.
</span><span class='line'>
</span><span class='line'>Are you sure? (Type uppercase yes): YES
</span><span class='line'>Enter passphrase: 
</span><span class='line'>Verify passphrase: 
</span><span class='line'>[staf@vicky ~]$ sudo cry
</span><span class='line'>cryptoflex-tool  cryptsetup       crywrap          
</span><span class='line'>[staf@vicky ~]$ sudo cryptsetup luksOpen /dev/sdn myprivatedata
</span><span class='line'>Enter passphrase for /dev/sdn: 
</span><span class='line'>[staf@vicky ~]$ </span></code></pre></td></tr></table></div></figure>


<h4>luksOpen</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[staf@vicky ~]$ sudo cryptsetup luksOpen /dev/sdn myprivatedata
</span><span class='line'>Enter passphrase for /dev/sdn: 
</span><span class='line'>[staf@vicky ~]$ </span></code></pre></td></tr></table></div></figure>


<h4>mkfs</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[staf@vicky ~]$ sudo mkfs.ext4 /dev/mapper/myprivatedata
</span><span class='line'>mke2fs 1.42.13 (17-May-2015)
</span><span class='line'>Creating filesystem with 1007360 4k blocks and 251968 inodes
</span><span class='line'>Filesystem UUID: 49390936-49e3-4606-abf2-567c3f5b50e1
</span><span class='line'>Superblock backups stored on blocks: 
</span><span class='line'>        32768, 98304, 163840, 229376, 294912, 819200, 884736
</span><span class='line'>
</span><span class='line'>Allocating group tables: done                            
</span><span class='line'>Writing inode tables: done                            
</span><span class='line'>Creating journal (16384 blocks): done
</span><span class='line'>Writing superblocks and filesystem accounting information: done 
</span><span class='line'>
</span><span class='line'>[staf@vicky ~]$ </span></code></pre></td></tr></table></div></figure>


<h3>Verify the encrypted USB stick</h3>

<p>To verify that the USB stick is encrypted and we can&rsquo;t mount without typing our passphrase we&rsquo;ll close the luks device and mount it.</p>

<h4>luksClose</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[staf@vicky ~]$ sudo cryptsetup luksClose myprivatedata
</span><span class='line'>[sudo] password for staf: 
</span><span class='line'>[staf@vicky ~]$ </span></code></pre></td></tr></table></div></figure>


<h4>Try to mount it without luksOpen</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[staf@vicky ~]$ sudo mount /dev/sdn /mnt
</span><span class='line'>mount: unknown filesystem type 'crypto_LUKS'
</span><span class='line'>[staf@vicky ~]$ </span></code></pre></td></tr></table></div></figure>


<h4>Mount it with luksOpen / mount</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[staf@vicky ~]$ sudo cryptsetup luksOpen /dev/sdn myhsm_dkek
</span><span class='line'>Enter passphrase for /dev/sdn: 
</span><span class='line'>[staf@vicky ~]$ sudo mount /dev/mapper/myhsm_dkek /mnt
</span><span class='line'>[staf@vicky ~]$ </span></code></pre></td></tr></table></div></figure>


<h4>update the ownership</h4>

<p>Update the usb stick ownership</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[staf@vicky mnt]$ sudo chown staf:staf .
</span><span class='line'>[sudo] password for staf: 
</span><span class='line'>[staf@vicky mnt]$ </span></code></pre></td></tr></table></div></figure>


<h2>SmartCard initialization</h2>

<h3>pcsc_scan</h3>

<h4>start the pcscd service</h4>

<p>Start/enable the pcscd service if didn&rsquo;t enable it before</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@vicky ~]# systemctl list-unit-files -t service | grep pcscd
</span><span class='line'>pcscd.service                               static  
</span><span class='line'>[root@vicky ~]# systemctl start pcscd
</span><span class='line'>[root@vicky ~]# systemctl enable pcscd
</span><span class='line'>[root@vicky ~]# </span></code></pre></td></tr></table></div></figure>


<h4>run pcsc_scan</h4>

<p>Insert the smartcard into the read, run pcsc_scan to verify that you see the smartcard</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[staf@vicky mnt]$ pcsc_scan                    
</span><span class='line'>PC/SC device scanner
</span><span class='line'>V 1.4.23 (c) 2001-2011, Ludovic Rousseau &lt;ludovic.rousseau@free.fr&gt;
</span><span class='line'>Compiled with PC/SC lite version: 1.8.13
</span><span class='line'>Using reader plug'n play mechanism
</span><span class='line'>Scanning present readers...
</span><span class='line'>0: Generic Smart Card Reader Interface [Smart Card Reader Interface] (20070818000000000) 00 00
</span><span class='line'>
</span><span class='line'>Wed Nov 11 10:58:59 2015
</span><span class='line'>Reader 0: Generic Smart Card Reader Interface [Smart Card Reader Interface] (20070818000000000) 00 00
</span><span class='line'>  Card state: Card inserted, 
</span><span class='line'>  ATR: 3B FE 18 00 00 81 31 FE 45 80 31 81 54 48 53 4D 31 73 80 21 40 81 07 FA
</span><span class='line'>
</span><span class='line'>ATR: 3B FE 18 00 00 81 31 FE 45 80 31 81 54 48 53 4D 31 73 80 21 40 81 07 FA
</span><span class='line'>+ TS = 3B --&gt; Direct Convention
</span><span class='line'>+ T0 = FE, Y(1): 1111, K: 14 (historical bytes)
</span><span class='line'>  TA(1) = 18 --&gt; Fi=372, Di=12, 31 cycles/ETU
</span><span class='line'>    129032 bits/s at 4 MHz, fMax for Fi = 5 MHz =&gt; 161290 bits/s                                                     
</span><span class='line'>  TB(1) = 00 --&gt; VPP is not electrically connected
</span><span class='line'>  TC(1) = 00 --&gt; Extra guard time: 0
</span><span class='line'>  TD(1) = 81 --&gt; Y(i+1) = 1000, Protocol T = 1 
</span><span class='line'>-----
</span><span class='line'>  TD(2) = 31 --&gt; Y(i+1) = 0011, Protocol T = 1 
</span><span class='line'>-----
</span><span class='line'>  TA(3) = FE --&gt; IFSC: 254
</span><span class='line'>  TB(3) = 45 --&gt; Block Waiting Integer: 4 - Character Waiting Integer: 5
</span><span class='line'>+ Historical bytes: 80 31 81 54 48 53 4D 31 73 80 21 40 81 07
</span><span class='line'>  Category indicator byte: 80 (compact TLV data object)
</span><span class='line'>    Tag: 3, len: 1 (card service data byte)
</span><span class='line'>      Card service data byte: 81
</span><span class='line'>        - Application selection: by full DF name
</span><span class='line'>        - EF.DIR and EF.ATR access services: by GET RECORD(s) command
</span><span class='line'>        - Card without MF
</span><span class='line'>    Tag: 5, len: 4 (card issuer's data)
</span><span class='line'>      Card issuer data: 48 53 4D 31
</span><span class='line'>    Tag: 7, len: 3 (card capabilities)
</span><span class='line'>      Selection methods: 80
</span><span class='line'>        - DF selection by full DF name
</span><span class='line'>      Data coding byte: 21
</span><span class='line'>        - Behaviour of write functions: proprietary
</span><span class='line'>        - Value 'FF' for the first byte of BER-TLV tag fields: invalid
</span><span class='line'>        - Data unit in quartets: 2
</span><span class='line'>      Command chaining, length fields and logical channels: 40
</span><span class='line'>        - Extended Lc and Le fields
</span><span class='line'>        - Logical channel number assignment: No logical channel
</span><span class='line'>        - Maximum number of logical channels: 1
</span><span class='line'>    Tag: 8, len: 1 (status indicator)
</span><span class='line'>      LCS (life card cycle): 07
</span><span class='line'>+ TCK = FA (correct checksum)
</span><span class='line'>
</span><span class='line'>Possibly identified card (using /usr/share/pcsc/smartcard_list.txt):
</span><span class='line'>3B FE 18 00 00 81 31 FE 45 80 31 81 54 48 53 4D 31 73 80 21 40 81 07 FA
</span><span class='line'>        Smartcard-HSM
</span><span class='line'>        http://www.cardcontact.de/products/sc-hsm.html
</span></code></pre></td></tr></table></div></figure>


<h3>Initialize the first smartcard</h3>

<h4>Create two DKEK shares</h4>

<ul>
<li>1st share;</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[staf@vicky mnt]$ sc-hsm-tool --create-dkek-share dkek-share-1.pbe
</span><span class='line'>Using reader with a card: Generic Smart Card Reader Interface [Smart Card Reader Interface] (20070818000000000) 00 00
</span><span class='line'>
</span><span class='line'>The DKEK share will be enciphered using a key derived from a user supplied password.
</span><span class='line'>The security of the DKEK share relies on a well chosen and sufficiently long password.
</span><span class='line'>The recommended length is more than 10 characters, which are mixed letters, numbers and
</span><span class='line'>symbols.
</span><span class='line'>
</span><span class='line'>Please keep the generated DKEK share file in a safe location. We also recommend to keep a
</span><span class='line'>paper printout, in case the electronic version becomes unavailable. A printable version
</span><span class='line'>of the file can be generated using "openssl base64 -in &lt;filename&gt;".
</span><span class='line'>Enter password to encrypt DKEK share : 
</span><span class='line'>
</span><span class='line'>Please retype password to confirm : 
</span><span class='line'>
</span><span class='line'>Passwords do not match. Please retry.
</span><span class='line'>Enter password to encrypt DKEK share : 
</span><span class='line'>[staf@vicky mnt]$ sc-hsm-tool --create-dkek-share dkek-share-1.pbe
</span><span class='line'>Using reader with a card: Generic Smart Card Reader Interface [Smart Card Reader Interface] (20070818000000000) 00 00
</span><span class='line'>
</span><span class='line'>The DKEK share will be enciphered using a key derived from a user supplied password.
</span><span class='line'>The security of the DKEK share relies on a well chosen and sufficiently long password.
</span><span class='line'>The recommended length is more than 10 characters, which are mixed letters, numbers and
</span><span class='line'>symbols.
</span><span class='line'>
</span><span class='line'>Please keep the generated DKEK share file in a safe location. We also recommend to keep a
</span><span class='line'>paper printout, in case the electronic version becomes unavailable. A printable version
</span><span class='line'>of the file can be generated using "openssl base64 -in &lt;filename&gt;".
</span><span class='line'>Enter password to encrypt DKEK share : 
</span><span class='line'>
</span><span class='line'>Please retype password to confirm : 
</span><span class='line'>
</span><span class='line'>Enciphering DKEK share, please wait...
</span><span class='line'>DKEK share created and saved to dkek-share-1.pbe
</span><span class='line'>[staf@vicky mnt]$ </span></code></pre></td></tr></table></div></figure>


<ul>
<li>2nd share;</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[staf@vicky mnt]$ sc-hsm-tool --create-dkek-share dkek-share-2.pbe
</span><span class='line'>Using reader with a card: Generic Smart Card Reader Interface [Smart Card Reader Interface] (20070818000000000) 00 00
</span><span class='line'>
</span><span class='line'>The DKEK share will be enciphered using a key derived from a user supplied password.
</span><span class='line'>The security of the DKEK share relies on a well chosen and sufficiently long password.
</span><span class='line'>The recommended length is more than 10 characters, which are mixed letters, numbers and
</span><span class='line'>symbols.
</span><span class='line'>
</span><span class='line'>Please keep the generated DKEK share file in a safe location. We also recommend to keep a
</span><span class='line'>paper printout, in case the electronic version becomes unavailable. A printable version
</span><span class='line'>of the file can be generated using "openssl base64 -in &lt;filename&gt;".
</span><span class='line'>Enter password to encrypt DKEK share : 
</span><span class='line'>
</span><span class='line'>Please retype password to confirm : 
</span><span class='line'>[staf@vicky mnt]$ sc-hsm-tool --create-dkek-share dkek-share-2.pbe
</span><span class='line'>Using reader with a card: Generic Smart Card Reader Interface [Smart Card Reader Interface] (20070818000000000) 00 00
</span><span class='line'>
</span><span class='line'>The DKEK share will be enciphered using a key derived from a user supplied password.
</span><span class='line'>The security of the DKEK share relies on a well chosen and sufficiently long password.
</span><span class='line'>The recommended length is more than 10 characters, which are mixed letters, numbers and
</span><span class='line'>symbols.
</span><span class='line'>
</span><span class='line'>Please keep the generated DKEK share file in a safe location. We also recommend to keep a
</span><span class='line'>paper printout, in case the electronic version becomes unavailable. A printable version
</span><span class='line'>of the file can be generated using "openssl base64 -in &lt;filename&gt;".
</span><span class='line'>Enter password to encrypt DKEK share : 
</span><span class='line'>
</span><span class='line'>Please retype password to confirm : 
</span><span class='line'>
</span><span class='line'>Enciphering DKEK share, please wait...
</span><span class='line'>DKEK share created and saved to dkek-share-2.pbe
</span><span class='line'>[staf@vicky mnt]$ </span></code></pre></td></tr></table></div></figure>


<p>If you want a backup of DKEK shares copy them to another (encrypted) USB stick(s).</p>

<h4>Initialize the SmartCard</h4>

<ul>
<li>Initialize</li>
</ul>


<p>Use sc-hsm-tool to Intialize the smartcard and specify the number DKEK shares that you&rsquo;ll use. You&rsquo;ll need to pick a PIN code for the &ldquo;security officer&rdquo; and the &ldquo;user&rdquo;.</p>

<p>If you forget the so-pin you can not reinitialize the smartcard again so be sure that you pick so-pin that you can remember or write it down and store it on secure location. The so-pin has to be 16 digits long.</p>

<p><strong>
The sc-hsm-tool only asks for the PIN code ones so be sure that you know what you have typed. If you don&rsquo;t know it you smartcard becomes trash&hellip;
</strong></p>

<p>It possible to specify the pin code with &ldquo;&ndash;so-pin&rdquo; and &ldquo;&ndash;pin&rdquo; argument but this leaves the pin code in your shell history or in the process list&hellip;</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[staf@vicky mnt]$ sc-hsm-tool --initialize --dkek-shares 2
</span><span class='line'>Using reader with a card: Generic Smart Card Reader Interface [Smart Card Reader Interface] (20070818000000000) 00 00
</span><span class='line'>Enter SO-PIN (16 hexadecimal characters) : 
</span><span class='line'>
</span><span class='line'>Enter initial User-PIN (6 - 16 characters) : 
</span><span class='line'>
</span><span class='line'>[staf@vicky mnt]$ 
</span></code></pre></td></tr></table></div></figure>


<p>If you execute the sc-hsm-tool command you&rsquo;ll see that the DKEK shares are still missing;</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[staf@vicky mnt]$ sc-hsm-tool 
</span><span class='line'>Using reader with a card: Generic Smart Card Reader Interface [Smart Card Reader Interface] (20070818000000000) 00 00
</span><span class='line'>Version              : 1.2
</span><span class='line'>User PIN tries left  : 3
</span><span class='line'>DKEK shares          : 2
</span><span class='line'>DKEK import pending, 2 share(s) still missing
</span><span class='line'>[staf@vicky mnt]$ </span></code></pre></td></tr></table></div></figure>


<ul>
<li>import the dkek shares</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[staf@vicky mnt]$ sc-hsm-tool --import-dkek-share dkek-share-1.pbe
</span><span class='line'>Using reader with a card: Generic Smart Card Reader Interface [Smart Card Reader Interface] (20070818000000000) 00 00
</span><span class='line'>Enter password to decrypt DKEK share : 
</span><span class='line'>
</span><span class='line'>Deciphering DKEK share, please wait...
</span><span class='line'>DKEK share imported
</span><span class='line'>DKEK shares          : 2
</span><span class='line'>DKEK import pending, 1 share(s) still missing
</span><span class='line'>[staf@vicky mnt]$ sc-hsm-tool --import-dkek-share dkek-share-2.pbe
</span><span class='line'>Using reader with a card: Generic Smart Card Reader Interface [Smart Card Reader Interface] (20070818000000000) 00 00
</span><span class='line'>Enter password to decrypt DKEK share : 
</span><span class='line'>
</span><span class='line'>Deciphering DKEK share, please wait...
</span><span class='line'>DKEK share imported
</span><span class='line'>DKEK shares          : 2
</span><span class='line'>DKEK key check value : 2C63E9E5D6FE0B8C
</span><span class='line'>[staf@vicky mnt]$ </span></code></pre></td></tr></table></div></figure>


<h4>test the user and so pin</h4>

<p>list the pkcs#11 slots</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[staf@vicky mnt]$ pkcs11-tool --module opensc-pkcs11.so -L
</span><span class='line'>Available slots:
</span><span class='line'>Slot 0 (0xffffffffffffffff): Virtual hotplug slot
</span><span class='line'>  (empty)
</span><span class='line'>Slot 1 (0x1): Generic Smart Card Reader Interface [Smart Card Reader Interface
</span><span class='line'>  token label        : SmartCard-HSM (UserPIN)
</span><span class='line'>  token manufacturer : www.CardContact.de
</span><span class='line'>  token model        : PKCS#15 emulated
</span><span class='line'>  token flags        : rng, login required, PIN initialized, token initialized
</span><span class='line'>  hardware version   : 24.13
</span><span class='line'>  firmware version   : 1.2
</span><span class='line'>  serial num         : DECM0102332
</span><span class='line'>[staf@vicky mnt]$ </span></code></pre></td></tr></table></div></figure>


<p>test the user pin;</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>staf@vicky mnt]$ pkcs11-tool --module opensc-pkcs11.so --slot 1 --login --test
</span><span class='line'>Logging in to "SmartCard-HSM (UserPIN)".
</span><span class='line'>Please enter User PIN: 
</span><span class='line'>C_SeedRandom() and C_GenerateRandom():
</span><span class='line'>  seeding (C_SeedRandom) not supported
</span><span class='line'>  seems to be OK
</span><span class='line'>Digests:
</span><span class='line'>  all 4 digest functions seem to work
</span><span class='line'>  MD5: OK
</span><span class='line'>  SHA-1: OK
</span><span class='line'>  RIPEMD160: OK
</span><span class='line'>Signatures (currently only RSA signatures)
</span><span class='line'>Signatures: no private key found in this slot
</span><span class='line'>Verify (currently only for RSA):
</span><span class='line'>  No private key found for testing
</span><span class='line'>Unwrap: not implemented
</span><span class='line'>Decryption (RSA)
</span><span class='line'>No errors
</span><span class='line'>[staf@vicky mnt]$ </span></code></pre></td></tr></table></div></figure>


<p>test the so pin</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[staf@vicky mnt]$ pkcs11-tool --module opensc-pkcs11.so --slot 1 --login --test --login-type so
</span><span class='line'>Logging in to "SmartCard-HSM (UserPIN)".
</span><span class='line'>Please enter SO PIN: 
</span><span class='line'>C_SeedRandom() and C_GenerateRandom():
</span><span class='line'>  seeding (C_SeedRandom) not supported
</span><span class='line'>  seems to be OK
</span><span class='line'>Digests:
</span><span class='line'>  all 4 digest functions seem to work
</span><span class='line'>  MD5: OK
</span><span class='line'>  SHA-1: OK
</span><span class='line'>  RIPEMD160: OK
</span><span class='line'>Signatures: not logged in, skipping signature tests
</span><span class='line'>Verify: not logged in, skipping verify tests
</span><span class='line'>Key unwrap: not a R/W session, skipping key unwrap tests
</span><span class='line'>Decryption: not logged in, skipping decryption tests
</span><span class='line'>No errors
</span><span class='line'>[staf@vicky mnt]$ </span></code></pre></td></tr></table></div></figure>


<h3>Create your first keypair</h3>

<h4>create key pair</h4>

<p>The command below an <a href="https://en.wikipedia.org/wiki/Elliptic_curve_cryptography">Elliptic Curve Cryptography (ECC)</a> key pair.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[staf@vicky mnt]$ pkcs11-tool --module opensc-pkcs11.so --keypairgen --key-type EC:prime256v1 --label myfirst_keypair --login
</span><span class='line'>Using slot 1 with a present token (0x1)
</span><span class='line'>Logging in to "SmartCard-HSM (UserPIN)".
</span><span class='line'>Please enter User PIN: 
</span><span class='line'>Key pair generated:
</span><span class='line'>Private Key Object; EC
</span><span class='line'>  label:      myfirst_keypair
</span><span class='line'>  ID:         ae79417e809ed19b9a69d4c14f444462ad0bd66c
</span><span class='line'>  Usage:      sign, derive
</span><span class='line'>Public Key Object; EC  EC_POINT 256 bits
</span><span class='line'>  EC_POINT:   044104f8ead77d1411e016196141d9d1f747a481aec4be40d1f8822d26d407fee05902082e18843ee58db4f5575b19ff243a735b66b2c91adbec1a59aeacc7c1ae8b52
</span><span class='line'>  EC_PARAMS:  06082a8648ce3d030107
</span><span class='line'>  label:      myfirst_keypair
</span><span class='line'>  ID:         ae79417e809ed19b9a69d4c14f444462ad0bd66c
</span><span class='line'>  Usage:      verify
</span><span class='line'>[staf@vicky mnt]$ </span></code></pre></td></tr></table></div></figure>


<h4>list objects</h4>

<p>list the objects to verif that your keypair in on the smartcard</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>staf@vicky mnt]$ pkcs11-tool --module opensc-pkcs11.so --list-objects
</span><span class='line'>Using slot 1 with a present token (0x1)
</span><span class='line'>Public Key Object; EC  EC_POINT 256 bits
</span><span class='line'>  EC_POINT:   044104f8ead77d1411e016196141d9d1f747a481aec4be40d1f8822d26d407fee05902082e18843ee58db4f5575b19ff243a735b66b2c91adbec1a59aeacc7c1ae8b52
</span><span class='line'>  EC_PARAMS:  06082a8648ce3d030107
</span><span class='line'>  label:      myfirst_keypair
</span><span class='line'>  ID:         ae79417e809ed19b9a69d4c14f444462ad0bd66c
</span><span class='line'>  Usage:      none
</span><span class='line'>[staf@vicky mnt]$ </span></code></pre></td></tr></table></div></figure>


<h2>Copy objects to another smartcard</h2>

<h3>Backup</h3>

<p>To create a backup of our keys or data we need to extract it from the smartcard and copy it to another.
To store the object temporary we can use an encrypted filesystem or even a ram disk on a secured computer.</p>

<p>For security reasons you might want to separate your DKEK share from you key backups,
For the convenience we&rsquo;ll store everything on an encrypted USB stick.</p>

<h4>get the object reference</h4>

<p>First we need to find the object reference</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[staf@vicky mnt]$ pkcs15-tool -D
</span><span class='line'>Using reader with a card: Generic Smart Card Reader Interface [Smart Card Reader Interface] (20070818000000000) 00 00
</span><span class='line'>PKCS#15 Card [SmartCard-HSM]:
</span><span class='line'>        Version        : 0
</span><span class='line'>        Serial number  : DECM0102332
</span><span class='line'>        Manufacturer ID: www.CardContact.de
</span><span class='line'>        Flags          : 
</span><span class='line'>
</span><span class='line'>PIN [UserPIN]
</span><span class='line'>        Object Flags   : [0x3], private, modifiable
</span><span class='line'>        ID             : 01
</span><span class='line'>        Flags          : [0x81A], local, unblock-disabled, initialized, exchangeRefData
</span><span class='line'>        Length         : min_len:6, max_len:15, stored_len:0
</span><span class='line'>        Pad char       : 0x00
</span><span class='line'>        Reference      : 129 (0x81)
</span><span class='line'>        Type           : ascii-numeric
</span><span class='line'>        Tries left     : 3
</span><span class='line'>
</span><span class='line'>PIN [SOPIN]
</span><span class='line'>        Object Flags   : [0x1], private
</span><span class='line'>        ID             : 02
</span><span class='line'>        Flags          : [0x9E], local, change-disabled, unblock-disabled, initialized, soPin
</span><span class='line'>        Length         : min_len:16, max_len:16, stored_len:0
</span><span class='line'>        Pad char       : 0x00
</span><span class='line'>        Reference      : 136 (0x88)
</span><span class='line'>        Type           : bcd
</span><span class='line'>        Tries left     : 3
</span><span class='line'>
</span><span class='line'>Private EC Key [myfirst_keypair]
</span><span class='line'>        Object Flags   : [0x3], private, modifiable
</span><span class='line'>        Usage          : [0x10C], sign, signRecover, derive
</span><span class='line'>        Access Flags   : [0x1D], sensitive, alwaysSensitive, neverExtract, local
</span><span class='line'>        FieldLength    : 256
</span><span class='line'>        Key ref        : 1 (0x1)
</span><span class='line'>        Native         : yes
</span><span class='line'>        Path           : e82b0601040181c31f0201::
</span><span class='line'>        Auth ID        : 01
</span><span class='line'>        ID             : ae79417e809ed19b9a69d4c14f444462ad0bd66c
</span><span class='line'>        MD:guid        : {3a03d245-ea49-1da1-d8cd-f2ced0526400}
</span><span class='line'>          :cmap flags  : 0x0
</span><span class='line'>          :sign        : 0
</span><span class='line'>          :key-exchange: 0
</span><span class='line'>
</span><span class='line'>Public EC Key [myfirst_keypair]
</span><span class='line'>        Object Flags   : [0x0]
</span><span class='line'>        Usage          : [0x0]
</span><span class='line'>        Access Flags   : [0x2], extract
</span><span class='line'>        FieldLength    : 256
</span><span class='line'>        Key ref        : 0 (0x0)
</span><span class='line'>        Native         : no
</span><span class='line'>        ID             : ae79417e809ed19b9a69d4c14f444462ad0bd66c
</span><span class='line'>        DirectValue    : &lt;present&gt;
</span><span class='line'>
</span><span class='line'>[staf@vicky mnt]$ pkcs15-tool -D</span></code></pre></td></tr></table></div></figure>


<p></p>

<h4>extract the object(s)</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[staf@vicky mnt]$ sc-hsm-tool --wrap-key private_myfirst_keypair --key-reference 1 
</span><span class='line'>Using reader with a card: Generic Smart Card Reader Interface [Smart Card Reader Interface] (20070818000000000) 00 00
</span><span class='line'>Enter User PIN : 
</span><span class='line'>
</span><span class='line'>[staf@vicky mnt]$ ls -l
</span><span class='line'>total 28
</span><span class='line'>-rw-r--r-- 1 swagemakers backup    64 Nov 11 13:42 dkek-share-1.pbe
</span><span class='line'>-rw-r--r-- 1 swagemakers backup    64 Nov 11 13:42 dkek-share-2.pbe
</span><span class='line'>drwx------ 2 root        root   16384 Nov 11 13:37 lost+found
</span><span class='line'>-rw-rw-r-- 1 staf        staf     926 Nov 11 14:05 private_myfirst_keypair
</span><span class='line'>[staf@vicky mnt]$ </span></code></pre></td></tr></table></div></figure>


<p>Please not that we only need to copy the private key, the backup object also contains the public keypair.</p>

<h3>Initialize a second smartcard</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[staf@vicky mnt]$ sc-hsm-tool --initialize --dkek-shares 2
</span><span class='line'>Using reader with a card: Generic Smart Card Reader Interface [Smart Card Reader Interface] (20070818000000000) 00 00
</span><span class='line'>Enter SO-PIN (16 hexadecimal characters) : 
</span><span class='line'>
</span><span class='line'>Enter initial User-PIN (6 - 16 characters) : 
</span><span class='line'>
</span><span class='line'>[staf@vicky mnt]$ sc-hsm-tool 
</span><span class='line'>Using reader with a card: Generic Smart Card Reader Interface [Smart Card Reader Interface] (20070818000000000) 00 00
</span><span class='line'>Version              : 1.2
</span><span class='line'>User PIN tries left  : 3
</span><span class='line'>DKEK shares          : 2
</span><span class='line'>DKEK import pending, 2 share(s) still missing
</span><span class='line'>[staf@vicky mnt]$ sc-hsm-tool --import-dkek-share dkek-share-1.pbe
</span><span class='line'>Using reader with a card: Generic Smart Card Reader Interface [Smart Card Reader Interface] (20070818000000000) 00 00
</span><span class='line'>Enter password to decrypt DKEK share : 
</span><span class='line'>
</span><span class='line'>Deciphering DKEK share, please wait...
</span><span class='line'>DKEK share imported
</span><span class='line'>DKEK shares          : 2
</span><span class='line'>DKEK import pending, 1 share(s) still missing
</span><span class='line'>[staf@vicky mnt]$ sc-hsm-tool --import-dkek-share dkek-share-2.pbe
</span><span class='line'>Using reader with a card: Generic Smart Card Reader Interface [Smart Card Reader Interface] (20070818000000000) 00 00
</span><span class='line'>Enter password to decrypt DKEK share : 
</span><span class='line'>
</span><span class='line'>Deciphering DKEK share, please wait...
</span><span class='line'>DKEK share imported
</span><span class='line'>DKEK shares          : 2
</span><span class='line'>DKEK key check value : 2C63E9E5D6FE0B8C
</span><span class='line'>[staf@vicky mnt]$ </span></code></pre></td></tr></table></div></figure>


<h3>Store the key pair</h3>

<p>It&rsquo;s possible to write the private object to another smartcard with the same DKEK shares.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[staf@vicky mnt]$ sc-hsm-tool --unwrap-key private_myfirst_keypair --key-reference 1
</span><span class='line'>Using reader with a card: Generic Smart Card Reader Interface [Smart Card Reader Interface] (20070818000000000) 00 00
</span><span class='line'>Wrapped key contains:
</span><span class='line'>  Key blob
</span><span class='line'>  Private Key Description (PRKD)
</span><span class='line'>  Certificate
</span><span class='line'>Enter User PIN : 
</span><span class='line'>
</span><span class='line'>Key successfully imported
</span><span class='line'>[staf@vicky mnt]$ pkcs11-tool --list-objects 
</span><span class='line'>Using slot 1 with a present token (0x1)
</span><span class='line'>Public Key Object; EC  EC_POINT 256 bits
</span><span class='line'>  EC_POINT:   044104f8ead77d1411e016196141d9d1f747a481aec4be40d1f8822d26d407fee05902082e18843ee58db4f5575b19ff243a735b66b2c91adbec1a59aeacc7c1ae8b52
</span><span class='line'>  EC_PARAMS:  06082a8648ce3d030107
</span><span class='line'>  label:      myfirst_keypair
</span><span class='line'>  ID:         ae79417e809ed19b9a69d4c14f444462ad0bd66c
</span><span class='line'>  Usage:      none
</span><span class='line'>[staf@vicky mnt]$ pkcs15-tool -D
</span><span class='line'>Using reader with a card: Generic Smart Card Reader Interface [Smart Card Reader Interface] (20070818000000000) 00 00
</span><span class='line'>PKCS#15 Card [SmartCard-HSM]:
</span><span class='line'>        Version        : 0
</span><span class='line'>        Serial number  : DECM0102330
</span><span class='line'>        Manufacturer ID: www.CardContact.de
</span><span class='line'>        Flags          : 
</span><span class='line'>
</span><span class='line'>PIN [UserPIN]
</span><span class='line'>        Object Flags   : [0x3], private, modifiable
</span><span class='line'>        ID             : 01
</span><span class='line'>        Flags          : [0x81A], local, unblock-disabled, initialized, exchangeRefData
</span><span class='line'>        Length         : min_len:6, max_len:15, stored_len:0
</span><span class='line'>        Pad char       : 0x00
</span><span class='line'>        Reference      : 129 (0x81)
</span><span class='line'>        Type           : ascii-numeric
</span><span class='line'>        Tries left     : 3
</span><span class='line'>
</span><span class='line'>PIN [SOPIN]
</span><span class='line'>        Object Flags   : [0x1], private
</span><span class='line'>        ID             : 02
</span><span class='line'>        Flags          : [0x9E], local, change-disabled, unblock-disabled, initialized, soPin
</span><span class='line'>        Length         : min_len:16, max_len:16, stored_len:0
</span><span class='line'>        Pad char       : 0x00
</span><span class='line'>        Reference      : 136 (0x88)
</span><span class='line'>        Type           : bcd
</span><span class='line'>        Tries left     : 3
</span><span class='line'>
</span><span class='line'>Private EC Key [myfirst_keypair]
</span><span class='line'>        Object Flags   : [0x3], private, modifiable
</span><span class='line'>        Usage          : [0x10C], sign, signRecover, derive
</span><span class='line'>        Access Flags   : [0x1D], sensitive, alwaysSensitive, neverExtract, local
</span><span class='line'>        FieldLength    : 256
</span><span class='line'>        Key ref        : 1 (0x1)
</span><span class='line'>        Native         : yes
</span><span class='line'>        Path           : e82b0601040181c31f0201::
</span><span class='line'>        Auth ID        : 01
</span><span class='line'>        ID             : ae79417e809ed19b9a69d4c14f444462ad0bd66c
</span><span class='line'>        MD:guid        : {8e96ad75-4f6c-eb5e-6bb3-4a637bbcda50}
</span><span class='line'>          :cmap flags  : 0x0
</span><span class='line'>          :sign        : 0
</span><span class='line'>          :key-exchange: 0
</span><span class='line'>
</span><span class='line'>Public EC Key [myfirst_keypair]
</span><span class='line'>        Object Flags   : [0x0]
</span><span class='line'>        Usage          : [0x0]
</span><span class='line'>        Access Flags   : [0x2], extract
</span><span class='line'>        FieldLength    : 256
</span><span class='line'>        Key ref        : 0 (0x0)
</span><span class='line'>        Native         : no
</span><span class='line'>        ID             : ae79417e809ed19b9a69d4c14f444462ad0bd66c
</span><span class='line'>        DirectValue    : &lt;present&gt;
</span><span class='line'>
</span><span class='line'>[staf@vicky mnt]$ </span></code></pre></td></tr></table></div></figure>


<h3>Done&hellip;</h3>

<p>We have a backup to our second smartcard and an ecrypted backup of the key on the usb, umount the backup and store it to a safe location.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[staf@vicky ~]$ mount | grep mnt
</span><span class='line'>/dev/mapper/my on /mnt type ext4 (rw,relatime,data=ordered)
</span><span class='line'>[staf@vicky ~]$ umount /mnt
</span><span class='line'>umount: /mnt: umount failed: Operation not permitted
</span><span class='line'>[staf@vicky ~]$ sudo umount /mnt
</span><span class='line'>[sudo] password for staf: 
</span><span class='line'>[staf@vicky ~]$ sudo cryptsetup luksClose my
</span><span class='line'>[staf@vicky ~]$ </span></code></pre></td></tr></table></div></figure>


<p><strong><em> I might publish some smartcard-hsm usage examples in the further&hellip;. </em></strong></p>

<h3>Links</h3>

<p><a href="https://github.com/OpenSC/OpenSC/wiki/SmartCardHSM">https://github.com/OpenSC/OpenSC/wiki/SmartCardHSM</a></p>
</div>
  
  

<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- blog_actrikel -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-4659298941528586"
     data-ad-slot="7394058542"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2015/10/17/lookat-1-dot-4-4rc2-released/">Lookat 1.4.4rc2 Released</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-10-17T15:36:05+02:00'><span class='date'><span class='date-month'>Oct</span> <span class='date-day'>17</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>3:36 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Lookat 1.4.4rc2 is the second release candicate of Lookat 1.4.4</p>

<h3>ChangeLog</h3>

<ul>
<li>NetBSD support</li>
</ul>


<h3>Lookat 1.4.4rc2 is available at:</h3>

<p><a href="http://www.wagemakers.be/english/programs/lookat"><a href="http://www.wagemakers.be/english/programs/lookat">http://www.wagemakers.be/english/programs/lookat</a></a>
, download it directly <a href="http://www.wagemakers.be/downloads/lookat/lookat_bekijk-1.4.4rc2.tar.gz">Download latest development release (1.4.4rc2)</a>.</p>

<p>Or at the Git repository at GNU savannah <a href="http://git.savannah.gnu.org/cgit/lookat.git/"><a href="http://git.savannah.gnu.org/cgit/lookat.git/">http://git.savannah.gnu.org/cgit/lookat.git/</a></a></p>

<p><strong><em> Have fun </em></strong></p>
</div>
  
  

<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- blog_actrikel -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-4659298941528586"
     data-ad-slot="7394058542"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2015/09/05/rataplan-becomes-a-watchdog/">Rataplan Becomes a Watchdog</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-09-05T14:47:54+02:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>5</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>2:47 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img class="left" src="/blog/images/watchdog_rataplan.jpg">
<a href="http://stafwag.github.io/blog/blog/2012/12/16/running-freebsd-9.0-on-asus-c60m1-i-motherboard/">My NAS</a> runs on <a href="http://www.freebsd.org">FreeBSD</a> I&rsquo;m quiet happy with it. It&rsquo;s named after the dog <a href="https://nl.wikipedia.org/wiki/Rataplan">rataplan</a> from the <a href="https://en.wikipedia.org/wiki/Lucky_Luke">Lucky Luke comic</a></p>

<p>However transferring large data files to it causes the network to hang. The realtek network interface had issues with freebsd from the <a href="http://stafwag.github.io/blog/blog/2012/12/16/running-freebsd-9.0-on-asus-c60m1-i-motherboard/">beginning</a>. On the screen and in syslog the entry &ldquo;re0: watchdog timeout&rdquo; is printed.</p>

<p>Most FreeBSD people recommends to use Intel nics, I ordered <a href="http://www.dx.com/nl/p/winyao-wy574t-intel-wg82574l-chipset-pci-e-x1-server-gigabit-network-card-adapter-green-280966">a new Intel nic at dx.com</a>. After the installation of the new NIC the network seems to be stable again.</p>
</div>
  
  

<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- blog_actrikel -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-4659298941528586"
     data-ad-slot="7394058542"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/posts/3">&larr; Older</a>
    
    <a href="/blog/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/index.html">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>About Me</h1>
  <p><a href="http://www.wagemakers.be">http://www.wagemakers.be</a></p>
  <p><a href="http://www.linkedin.com/in/stafwagemakers">LinkedIn profile</a></p>
  <p><a href="https://google.com/+StafWagemakers">Google Plus profile</a></p>
<!-- Place this tag where you want the widget to render. -->
<div class="g-person" data-width="180" data-href="http://google.com/+StafWagemakers" data-showtagline="false" data-showcoverphoto="false" data-rel="author"></div>

<!-- Place this tag after the last widget tag. -->
<script type="text/javascript">
  (function() {
    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    po.src = 'https://apis.google.com/js/plusone.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  })();
</script>
</section>

<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/blog/2018/02/10/update-your-cpu-microcodeon-arch-linux/">Update Your CPU Microcode on Arch Linux</a>
      </li>
    
      <li class="post">
        <a href="/blog/blog/2017/12/27/bacula-on-freebsd-part3/">Bacula on FreeBSD (Part 3 Storage Setup)</a>
      </li>
    
      <li class="post">
        <a href="/blog/blog/2017/10/20/model-m-tux-update-dot-dot-dot/">Model-m Tux Update...</a>
      </li>
    
      <li class="post">
        <a href="/blog/blog/2017/09/30/jenkins-build-with-20-cores/">Jenkins Build With 20 Cores</a>
      </li>
    
      <li class="post">
        <a href="/blog/blog/2017/09/16/20-core-dual-processor-jenkins-build-workstation/">20 Core Dual Processor Jenkins Build Workstation</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/stafwag">@stafwag</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'stafwag',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/blog/javascripts/github.js" type="text/javascript"> </script>
</section>





<hr />
<br />
<br />
<br />
<br />
<script type="text/javascript"><!--
google_ad_client = "ca-pub-4659298941528586";
/* blogads_right */
google_ad_slot = "8839948148";
google_ad_width = 160;
google_ad_height = 600;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>

  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2018 - staf wagemakers -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'stafwag';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>

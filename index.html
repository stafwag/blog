
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>stafwag Blog</title>
  <meta name="author" content="staf wagemakers">

  
  <meta name="description" content="How to Start DLM Monitoring on a VDSL Line in Belgium Apr 27th, 2018 12:28 pm In Belgium/Flanders we have two main internet line providers; telenet &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="https://stafwag.github.io/blog/">
  <link href="/blog/favicon.png" rel="icon">
  <link href="/blog/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/blog/atom.xml" rel="alternate" title="stafwag Blog" type="application/atom+xml">
  <script src="/blog/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/blog/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-37258385-2']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/blog/">stafwag Blog</a></h1>
  
    <h2>staf wagemakers blog</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/blog/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="stafwag.github.io/blog">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/blog/">Blog</a></li>
  <li><a href="/blog/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2018/04/27/how-to-start-dlm-monitoring-on-a-vdsl-line-in-belgium/">How to Start DLM Monitoring on a VDSL Line in Belgium</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2018-04-27T12:28:55+02:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>27</span><span class='date-suffix'>th</span>, <span class='date-year'>2018</span></span> <span class='time'>12:28 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>In Belgium/Flanders we have two main internet line providers;</p>

<ul>
<li><a href="https://www.telnet.be">telenet</a> the cablenet network provider.</li>
<li><a href="https://www.proximus.be">proximus</a> is the telephone network provider.</li>
</ul>


<p>On telephone network there are alternative internet providers but they use the network
of proximus.</p>

<p>I switched my internet connection from ADSL to VDSL and switched to a new provider ( <a href="https://www.edpnet.be">edpnet</a>).
The internet speed was below the expectations and my modem reported errors on the line. After fixing the internal phone cabbeling in my appartment I wanted the retrigger the <a href="https://www.edpnet.be/en/support/ordering/internet/what-is-dlm-(dynamic-line-management).html">DLM</a> monitoring.</p>

<p>The process is explained in the this post <a href="https://userbase.be/forum/viewtopic.php?t=48767"><a href="https://userbase.be/forum/viewtopic.php?t=48767">https://userbase.be/forum/viewtopic.php?t=48767</a></a> at <a href="https://userbase.be">usebase.be</a></p>

<p>To start the DLM monitoring in Belgium you need to call 0800 22 424 and type in your line number. If you don&rsquo;t have a proximus phone number the line number is not the same as your phone number. To get your line number you need to connect an analog phone to our line and call 1924 this will read aloud your line number.</p>

<p><strong><em> Have fun </em></strong></p>
</div>
  
  

<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- blog_actrikel -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-4659298941528586"
     data-ad-slot="7394058542"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2018/04/22/high-screen-resolution-on-a-kvm-virtual-machine-with-qxl/">High Screen Resolution on a KVM Virtual Machine With QXL</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2018-04-22T10:04:46+02:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>22</span><span class='date-suffix'>nd</span>, <span class='date-year'>2018</span></span> <span class='time'>10:04 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>When you create an new virtual KVM virtual system the video ram is limited to 16MB by default to use a higer screen resolution you need
to increase the video ram. The available resolution reported by the virtual screen may also not include the resolution that you want to
utilize.</p>

<p>You&rsquo;ll find my journey to enable higher screen resolutions in my KVM (qemu) virtual systems below.</p>

<h2>Ubuntu 16.04</h2>

<p>There is an issue with Ubuntu 16.04 and the latest HWE kernel <a href="https://wiki.ubuntu.com/Kernel/LTSEnablementStack"><a href="https://wiki.ubuntu.com/Kernel/LTSEnablementStack">https://wiki.ubuntu.com/Kernel/LTSEnablementStack</a></a>. Even a full HD resultion (1920 x 1080 ) if you have the latest HWE kernel on your system.</p>

<p>To resolve this issue your can uninstall the latest kernel or install the LTS kernel.</p>

<h4>Install the LTS Kernel</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>staf@ubuntu:~$ sudo apt-get install linux-generic-lts-xenial
</span><span class='line'>Reading package lists... Done
</span><span class='line'>Building dependency tree       
</span><span class='line'>Reading state information... Done
</span><span class='line'>The following additional packages will be installed:
</span><span class='line'>  linux-generic linux-headers-4.4.0-119 linux-headers-4.4.0-119-generic linux-headers-generic
</span><span class='line'>  linux-image-4.4.0-119-generic linux-image-extra-4.4.0-119-generic linux-image-generic
</span><span class='line'>Suggested packages:
</span><span class='line'>  fdutils linux-doc-4.4.0 | linux-source-4.4.0 linux-tools
</span><span class='line'>The following NEW packages will be installed:
</span><span class='line'>  linux-generic linux-generic-lts-xenial linux-headers-4.4.0-119 linux-headers-4.4.0-119-generic
</span><span class='line'>  linux-headers-generic linux-image-4.4.0-119-generic linux-image-extra-4.4.0-119-generic linux-image-generic
</span><span class='line'>0 upgraded, 8 newly installed, 0 to remove and 0 not upgraded.
</span><span class='line'>Need to get 69,3 MB of archives.
</span><span class='line'>After this operation, 301 MB of additional disk space will be used.
</span><span class='line'>Do you want to continue? [Y/n] 
</span><span class='line'>&lt;snip&gt;
</span><span class='line'>Setting up linux-image-generic (4.4.0.119.125) ...
</span><span class='line'>Setting up linux-headers-4.4.0-119 (4.4.0-119.143) ...
</span><span class='line'>Setting up linux-headers-4.4.0-119-generic (4.4.0-119.143) ...
</span><span class='line'>Setting up linux-headers-generic (4.4.0.119.125) ...
</span><span class='line'>Setting up linux-generic (4.4.0.119.125) ...
</span><span class='line'>Setting up linux-generic-lts-xenial (4.4.0.119.125) ...
</span><span class='line'>staf@ubuntu:~$ </span></code></pre></td></tr></table></div></figure>


<h4>Remove the HWE kernel</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>staf@ubuntu:~$ sudo apt-get purge linux-image-4.13*
</span><span class='line'>Reading package lists... Done
</span><span class='line'>Building dependency tree       
</span><span class='line'>Reading state information... Done
</span><span class='line'>&lt;snip&gt;
</span><span class='line'>done
</span><span class='line'>The link /vmlinuz.old is a damaged link
</span><span class='line'>Removing symbolic link vmlinuz.old 
</span><span class='line'> you may need to re-run your boot loader[grub]
</span><span class='line'>The link /initrd.img.old is a damaged link
</span><span class='line'>Removing symbolic link initrd.img.old 
</span><span class='line'> you may need to re-run your boot loader[grub]
</span><span class='line'>Purging configuration files for linux-image-4.13.0-38-generic (4.13.0-38.43~16.04.1) ...
</span><span class='line'>Examining /etc/kernel/postrm.d .
</span><span class='line'>run-parts: executing /etc/kernel/postrm.d/initramfs-tools 4.13.0-38-generic /boot/vmlinuz-4.13.0-38-generic
</span><span class='line'>run-parts: executing /etc/kernel/postrm.d/zz-update-grub 4.13.0-38-generic /boot/vmlinuz-4.13.0-38-generic</span></code></pre></td></tr></table></div></figure>


<h4>Cleanup</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>staf@ubuntu:~$ sudo apt autoremove
</span><span class='line'>Reading package lists... Done
</span><span class='line'>Building dependency tree       
</span><span class='line'>Reading state information... Done
</span><span class='line'>The following packages will be REMOVED:
</span><span class='line'>  linux-headers-4.13.0-36 linux-headers-4.13.0-36-generic linux-headers-generic-hwe-16.04
</span><span class='line'>0 upgraded, 0 newly installed, 3 to remove and 0 not upgraded.
</span><span class='line'>After this operation, 83,1 MB disk space will be freed.
</span><span class='line'>Do you want to continue? [Y/n] 
</span><span class='line'>(Reading database ... 234149 files and directories currently installed.)
</span><span class='line'>Removing linux-headers-4.13.0-36-generic (4.13.0-36.40~16.04.1) ...
</span><span class='line'>Removing linux-headers-4.13.0-36 (4.13.0-36.40~16.04.1) ...
</span><span class='line'>Removing linux-headers-generic-hwe-16.04 (4.13.0.38.57) ...
</span><span class='line'>staf@ubuntu:~$ </span></code></pre></td></tr></table></div></figure>


<h4>Reboot</h4>

<p>After a reboot higher resolutions are possible on ubuntu 16.04</p>

<h1>Increase the video RAM</h1>

<h2>Required video ram</h2>

<p>When you create a new KVM virtual machine it has 16MB of video RAM.
Below you&rsquo;ll the calculation for the required video RAM for a 4k resolution ( 3840 x 2160 ).</p>

<p>3840 x 2160 = 8294400 <br/>
8294400 x 32 = 265420800 <br/ >
265420800 / 8 = 33177600 <br />
33177600 / (1024*1024) = 31.640625 MB</p>

<p>So 32 MB video ram is enough for a 4k resolution, to take some overhead into account we&rsquo;ll increase the video ram to 64 MB.</p>

<h2>list the domains</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[swagemakers@staflaptop ~]$ sudo virsh
</span><span class='line'>Welcome to virsh, the virtualization interactive terminal.
</span><span class='line'>
</span><span class='line'>Type:  'help' for help with commands
</span><span class='line'>       'quit' to quit
</span><span class='line'>
</span><span class='line'>virsh # list --all
</span><span class='line'> Id    Name                           State
</span><span class='line'>----------------------------------------------------
</span><span class='line'> -     centos7.0                      shut off
</span><span class='line'> -     debian                         shut off
</span><span class='line'> -     fedora27                       shut off
</span><span class='line'>
</span><span class='line'>virsh # </span></code></pre></td></tr></table></div></figure>


<h4>edit the domain settings</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>virsh # edit --domain debian</span></code></pre></td></tr></table></div></figure>


<h5>update the memory settings</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;video&gt;
</span><span class='line'>  &lt;model type='qxl' ram='65536' vram='65536' vgamem='16384' heads='1' primary='yes'/&gt;
</span><span class='line'>  &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x02' function='0x0'/&gt;
</span><span class='line'>&lt;/video&gt;
</span><span class='line'>&lt;redirdev bus='usb' type='spicevmc'&gt;
</span></code></pre></td></tr></table></div></figure>


<p>to</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;video&gt;
</span><span class='line'>  &lt;model type='qxl' ram='65536' vram='65536' vgamem='65536' heads='1' primary='yes'/&gt;
</span><span class='line'>  &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x02' function='0x0'/&gt;
</span><span class='line'>&lt;/video&gt;</span></code></pre></td></tr></table></div></figure>


<h4>xrandr</h4>

<p>Even with the additional RAM higer resolution aren&rsquo;t possible (yet), the virtual screen doesn&rsquo;t report the higer screen resolution. It&rsquo;s possible to add the higher screen resolution with xrandr.</p>

<h5>display current settings</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>staf@debian:~$ xrandr 
</span><span class='line'>Screen 0: minimum 320 x 200, current 1920 x 1080, maximum 8192 x 8192
</span><span class='line'>Virtual-0 connected primary 1920x1080+0+0 0mm x 0mm
</span><span class='line'>   1024x768      59.95 +
</span><span class='line'>   1920x1200     59.95  
</span><span class='line'>   1920x1080     60.00* 
</span><span class='line'>   1600x1200     59.95  
</span><span class='line'>   1680x1050     60.00  
</span><span class='line'>   1400x1050     60.00  
</span><span class='line'>   1280x1024     59.95  
</span><span class='line'>   1440x900      59.99  
</span><span class='line'>   1280x960      59.99  
</span><span class='line'>   1280x854      59.95  
</span><span class='line'>   1280x800      59.96  
</span><span class='line'>   1280x720      59.97  
</span><span class='line'>   1152x768      59.95  
</span><span class='line'>   800x600       59.96  
</span><span class='line'>   848x480       59.94  
</span><span class='line'>   720x480       59.94  
</span><span class='line'>   640x480       59.94  
</span><span class='line'>Virtual-1 disconnected
</span><span class='line'>Virtual-2 disconnected
</span><span class='line'>Virtual-3 disconnected
</span><span class='line'>staf@debian:~$ </span></code></pre></td></tr></table></div></figure>


<h6>get the modeline</h6>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>staf@debian:~$ cvt 2560 1440 
</span><span class='line'># 2560x1440 59.96 Hz (CVT 3.69M9) hsync: 89.52 kHz; pclk: 312.25 MHz
</span><span class='line'>Modeline "2560x1440_60.00"  312.25  2560 2752 3024 3488  1440 1443 1448 1493 -hsync +vsync
</span><span class='line'>staf@debian:~$ </span></code></pre></td></tr></table></div></figure>


<h6># create the new mode line</h6>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>staf@debian:~$ xrandr --newmode "2560x1440_60.00"  312.25  2560 2752 3024 3488  1440 1443 1448 1493 -hsync +vsync
</span><span class='line'>staf@debian:~$ </span></code></pre></td></tr></table></div></figure>


<h6># add the mode to your screen</h6>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>staf@debian:~$ xrandr --addmode Virtual-0 2560x1440_60.00
</span><span class='line'>staf@debian:~$ </span></code></pre></td></tr></table></div></figure>


<h6># use the new mode</h6>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>staf@debian:~$ xrandr --output Virtual-0 --mode 2560x1440_60.00
</span><span class='line'>staf@debian:~$ </span></code></pre></td></tr></table></div></figure>


<h6>## 4k</h6>

<p>To use a 4k resolution you can use the commands</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>staf@debian:~$  cvt 3840 2160
</span><span class='line'># 3840x2160 59.98 Hz (CVT 8.29M9) hsync: 134.18 kHz; pclk: 712.75 MHz
</span><span class='line'>Modeline "3840x2160_60.00"  712.75  3840 4160 4576 5312  2160 2163 2168 2237 -hsync +vsync
</span><span class='line'>staf@mydevolo:~$ xrandr --newmode "3840x2160_60.00"  712.75  3840 4160 4576 5312  2160 2163 2168 2237 -hsync +vsync
</span><span class='line'>staf@mydevolo:~$ xrandr --addmode Virtual-0 3840x2160_60.00
</span><span class='line'>staf@mydevolo:~$ xrandr --output Virtual-0 --mode 3840x2160_60.00
</span><span class='line'>staf@mydevolo:~$ </span></code></pre></td></tr></table></div></figure>


<h2>Add the new screen resolution permanently</h2>

<h3>Debian &amp; Co</h3>

<p>Create a monitor configuration file in /usr/share/X11/xorg.conf.d</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@mydevolo:/usr/share/X11/xorg.conf.d# vi 10-monitor.conf</span></code></pre></td></tr></table></div></figure>


<p>And add the modeline fgor your screen resolution.
With the Option &ldquo;PreferredMode&rdquo; you can set the prferred resolution.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>section "Monitor"
</span><span class='line'>    Identifier "Virtual-0 "
</span><span class='line'>    Modeline "2560x1440_60.00"  312.25  2560 2752 3024 3488  1440 1443 1448 1493 -hsync +vsync
</span><span class='line'>    Modeline "3840x2160_60.00"  712.75  3840 4160 4576 5312  2160 2163 2168 2237 -hsync +vsync
</span><span class='line'>    Option "PreferredMode" "2560x1440_60.00"
</span><span class='line'>EndSection</span></code></pre></td></tr></table></div></figure>


<h3>Other GNU/Linux distros</h3>

<p>Most other GNU/Linux distribution use /etc/X11/xorg.conf.d/</p>

<p><strong><em> Have fun </em></strong></p>

<h1>Links</h1>

<ul>
<li><a href="https://wiki.archlinux.org/index.php/xrandr"><a href="https://wiki.archlinux.org/index.php/xrandr">https://wiki.archlinux.org/index.php/xrandr</a></a></li>
<li><a href="https://askubuntu.com/questions/994449/ubuntu-16-04-kvm-qxl-guest-cant-change-resolution"><a href="https://askubuntu.com/questions/994449/ubuntu-16-04-kvm-qxl-guest-cant-change-resolution">https://askubuntu.com/questions/994449/ubuntu-16-04-kvm-qxl-guest-cant-change-resolution</a></a></li>
</ul>

</div>
  
  

<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- blog_actrikel -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-4659298941528586"
     data-ad-slot="7394058542"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2018/03/04/postfix-smarthost-with-authentication/">Postfix Smarthost With Authentication</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2018-03-04T08:05:29+01:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>4</span><span class='date-suffix'>th</span>, <span class='date-year'>2018</span></span> <span class='time'>8:05 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img class="right" src="/blog/images/postfix.png" width="400" height="266" title="&#34;postfix&#34;" alt="&#34;postfix&#34;"></p>

<p>I used the relay host of my internet provider but this was causing issues since my email was getting mark as <a href="https://en.wikipedia.org/wiki/Email_spam">SPAM</a> in <a href="https://en.wikipedia.org/wiki/Gmail">gmail</a>.
<br />&nbsp;<br />
It was already on my to-do list to move my outgoing mail to my mail provider also to make it easier to move to another <a href="https://en.wikipedia.org/wiki/Internet_service_provider">ISP</a> or to implement <a href="https://en.wikipedia.org/wiki/Sender_Policy_Framework">SPF</a> but was not on the top of my to-do list.
<br />&nbsp;<br />
My email provider requires authentication, so I needed to reconfigure postfix in my FreeBSD mail jail to use a relay host with authentication.</p>

<h3>Install postfix-sasl</h3>

<p>To use authentication with postfix the postfix-sasl package is required.
If postfix is already installed it&rsquo;ll be replace by postfix-sasl.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@stafmail:/root # pkg install postfix-sasl</span></code></pre></td></tr></table></div></figure>


<h3>Configuration</h3>

<h4>Update the relay host</h4>

<h4>main.cf</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>relayhost = [smtp.mailprovider.domain]:465
</span><span class='line'>smtp_use_tls=yes
</span><span class='line'>smtp_sasl_auth_enable = yes
</span><span class='line'>smtp_sasl_password_maps = hash:/usr/local/etc/postfix/relay_pass
</span><span class='line'>smtp_sasl_security_options =
</span><span class='line'>smtp_tls_wrappermode = yes
</span><span class='line'>smtp_tls_security_level = encrypt</span></code></pre></td></tr></table></div></figure>


<h4>relay_pass</h4>

<p>The credentials are in the relay_pass file the password is in the file as plain-text so we
it with the correct file permissions.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@stafmail:/usr/local/etc/postfix # touch relay_pass
</span><span class='line'>root@stafmail:/usr/local/etc/postfix # chmod 600 relay_pass
</span><span class='line'>root@stafmail:/usr/local/etc/postfix # vi relay_pass</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[smtp.mailprovider.domain]:465 user:password</span></code></pre></td></tr></table></div></figure>


<h4>Create the hash file.</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@stafmail:/usr/local/etc/postfix # postmap relay_pass</span></code></pre></td></tr></table></div></figure>


<h4>Verify the file permissions.</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@stafmail:/usr/local/etc/postfix # ls -l relay_pass*
</span><span class='line'>-rw-------  1 root  wheel      60 Feb 23 22:43 relay_pass
</span><span class='line'>-rw-------  1 root  wheel  131072 Feb 23 22:43 relay_pass.db
</span><span class='line'>root@stafmail:/usr/local/etc/postfix # </span></code></pre></td></tr></table></div></figure>


<h4>Restart</h4>

<p>We replaced postfix with postfix-sasl a restart is required.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@stafmail:/usr/local/etc/postfix # /usr/local/etc/rc.d/postfix restart</span></code></pre></td></tr></table></div></figure>


<p><strong><em> Have fun </em></strong></p>
</div>
  
  

<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- blog_actrikel -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-4659298941528586"
     data-ad-slot="7394058542"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2018/02/10/update-your-cpu-microcodeon-arch-linux/">Update Your CPU Microcode on Arch Linux</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2018-02-10T08:33:01+01:00'><span class='date'><span class='date-month'>Feb</span> <span class='date-day'>10</span><span class='date-suffix'>th</span>, <span class='date-year'>2018</span></span> <span class='time'>8:33 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h1>Meltdown &amp; spectre</h1>

<p>With Meldown <a href="https://nvd.nist.gov/vuln/detail/CVE-2017-5754"><a href="https://nvd.nist.gov/vuln/detail/CVE-2017-5754">https://nvd.nist.gov/vuln/detail/CVE-2017-5754</a></a>, Spectre Variant 1 <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-5753"><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-5753">https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-5753</a></a> and Spectre Variant 2 <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-5753"><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-5753">https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-5753</a></a> out in the wild there is a lot of confusing going about updating microcode.</p>

<p>There is a &ldquo;Spectre &amp; Meltdown Checker&rdquo; available at <a href="https://github.com/speed47/spectre-meltdown-checker"><a href="https://github.com/speed47/spectre-meltdown-checker">https://github.com/speed47/spectre-meltdown-checker</a></a></p>

<p>Usage is very easy just clone the git repository and run the script.</p>

<h1>Microcode</h1>

<p>Microcode isn&rsquo;t uploaded to the CPU but loaded during the boot strap of the CPU.
Normally the BIOS upload the microcode to the CPU but this can also be done by the by the bootloader, or the operating system kernel.</p>

<h2>Grub</h2>

<p>Normally you get an updated bios for your motherboard or computer vendor to get new microcode for your CPU.</p>

<p>But when your vendor hasn&rsquo;t released a new Bios yet or when you are using old hardware you might not get a new BIOS with updated microcode.</p>

<p>Lucky microcode can also loaded by bootloader this way you can get new microcode without a BIOS update if the new microcode cuase issues you disable it in the bootloader.</p>

<p>The process for Arch Linux is describe at the Arch Wiki <a href="https://wiki.archlinux.org/index.php/Microcode"><a href="https://wiki.archlinux.org/index.php/Microcode">https://wiki.archlinux.org/index.php/Microcode</a></a></p>

<p>You&rsquo;ll find journey how to update the microcode on my Arch GNU/Linux system below.</p>

<h3>Current microcode</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[staf@frija ~]$ dmesg | grep -i microcode
</span><span class='line'>[    2.102649] microcode: sig=0x40661, pf=0x20, revision=0xa
</span><span class='line'>[    2.102981] microcode: Microcode Update Driver: v2.01 &lt;tigran@aivazian.fsnet.co.uk&gt;, Peter Oruba
</span><span class='line'>[staf@frija ~]$ </span></code></pre></td></tr></table></div></figure>


<h3>Install intel-ucode</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@vicky ~]# pacman -Syy intel-ucode
</span><span class='line'>:: Synchronizing package databases...
</span><span class='line'> core                     126.8 KiB  12.4M/s 00:00 [######################] 100%
</span><span class='line'> extra                   1629.4 KiB  11.4M/s 00:00 [######################] 100%
</span><span class='line'> community                  4.1 MiB  11.0M/s 00:00 [######################] 100%
</span><span class='line'> multilib                 167.2 KiB  8.16M/s 00:00 [######################] 100%
</span><span class='line'>resolving dependencies...
</span><span class='line'>looking for conflicting packages...
</span><span class='line'>
</span><span class='line'>Packages (1) intel-ucode-20180108-1
</span><span class='line'>
</span><span class='line'>Total Download Size:   1.12 MiB
</span><span class='line'>Total Installed Size:  1.55 MiB
</span><span class='line'>
</span><span class='line'>:: Proceed with installation? [Y/n] y
</span><span class='line'>:: Retrieving packages...
</span><span class='line'> intel-ucode-2018010...  1145.0 KiB   916K/s 00:01 [######################] 100%
</span><span class='line'>(1/1) checking keys in keyring                     [######################] 100%
</span><span class='line'>(1/1) checking package integrity                   [######################] 100%
</span><span class='line'>(1/1) loading package files                        [######################] 100%
</span><span class='line'>(1/1) checking for file conflicts                  [######################] 100%
</span><span class='line'>(1/1) checking available disk space                [######################] 100%
</span><span class='line'>:: Processing package changes...
</span><span class='line'>(1/1) installing intel-ucode                       [######################] 100%
</span><span class='line'>:: Running post-transaction hooks...
</span><span class='line'>(1/1) Arming ConditionNeedsUpdate...
</span><span class='line'>[root@vicky ~]# </span></code></pre></td></tr></table></div></figure>


<h3>Verify the available microcode for your CPU</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
<span class='line-number'>173</span>
<span class='line-number'>174</span>
<span class='line-number'>175</span>
<span class='line-number'>176</span>
<span class='line-number'>177</span>
<span class='line-number'>178</span>
<span class='line-number'>179</span>
<span class='line-number'>180</span>
<span class='line-number'>181</span>
<span class='line-number'>182</span>
<span class='line-number'>183</span>
<span class='line-number'>184</span>
<span class='line-number'>185</span>
<span class='line-number'>186</span>
<span class='line-number'>187</span>
<span class='line-number'>188</span>
<span class='line-number'>189</span>
<span class='line-number'>190</span>
<span class='line-number'>191</span>
<span class='line-number'>192</span>
<span class='line-number'>193</span>
<span class='line-number'>194</span>
<span class='line-number'>195</span>
<span class='line-number'>196</span>
<span class='line-number'>197</span>
<span class='line-number'>198</span>
<span class='line-number'>199</span>
<span class='line-number'>200</span>
<span class='line-number'>201</span>
<span class='line-number'>202</span>
<span class='line-number'>203</span>
<span class='line-number'>204</span>
<span class='line-number'>205</span>
<span class='line-number'>206</span>
<span class='line-number'>207</span>
<span class='line-number'>208</span>
<span class='line-number'>209</span>
<span class='line-number'>210</span>
<span class='line-number'>211</span>
<span class='line-number'>212</span>
<span class='line-number'>213</span>
<span class='line-number'>214</span>
<span class='line-number'>215</span>
<span class='line-number'>216</span>
<span class='line-number'>217</span>
<span class='line-number'>218</span>
<span class='line-number'>219</span>
<span class='line-number'>220</span>
<span class='line-number'>221</span>
<span class='line-number'>222</span>
<span class='line-number'>223</span>
<span class='line-number'>224</span>
<span class='line-number'>225</span>
<span class='line-number'>226</span>
<span class='line-number'>227</span>
<span class='line-number'>228</span>
<span class='line-number'>229</span>
<span class='line-number'>230</span>
<span class='line-number'>231</span>
<span class='line-number'>232</span>
<span class='line-number'>233</span>
<span class='line-number'>234</span>
<span class='line-number'>235</span>
<span class='line-number'>236</span>
<span class='line-number'>237</span>
<span class='line-number'>238</span>
<span class='line-number'>239</span>
<span class='line-number'>240</span>
<span class='line-number'>241</span>
<span class='line-number'>242</span>
<span class='line-number'>243</span>
<span class='line-number'>244</span>
<span class='line-number'>245</span>
<span class='line-number'>246</span>
<span class='line-number'>247</span>
<span class='line-number'>248</span>
<span class='line-number'>249</span>
<span class='line-number'>250</span>
<span class='line-number'>251</span>
<span class='line-number'>252</span>
<span class='line-number'>253</span>
<span class='line-number'>254</span>
<span class='line-number'>255</span>
<span class='line-number'>256</span>
<span class='line-number'>257</span>
<span class='line-number'>258</span>
<span class='line-number'>259</span>
<span class='line-number'>260</span>
<span class='line-number'>261</span>
<span class='line-number'>262</span>
<span class='line-number'>263</span>
<span class='line-number'>264</span>
<span class='line-number'>265</span>
<span class='line-number'>266</span>
<span class='line-number'>267</span>
<span class='line-number'>268</span>
<span class='line-number'>269</span>
<span class='line-number'>270</span>
<span class='line-number'>271</span>
<span class='line-number'>272</span>
<span class='line-number'>273</span>
<span class='line-number'>274</span>
<span class='line-number'>275</span>
<span class='line-number'>276</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[staf@frija ~]$ yaourt  iucode-tool
</span><span class='line'>1 aur/iucode-tool 2.2-1 (59) (4.87)
</span><span class='line'>    Tool to manipulate Intel® IA-32/X86-64 microcode bundles
</span><span class='line'>==&gt; Enter n° of packages to be installed (e.g., 1 2 3 or 1-3)
</span><span class='line'>==&gt; ----------------------------------------------------------
</span><span class='line'>==&gt; 1
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>==&gt; Downloading iucode-tool PKGBUILD from AUR...
</span><span class='line'>x .SRCINFO
</span><span class='line'>x PKGBUILD
</span><span class='line'>oxe commented on 2017-10-01 17:50          
</span><span class='line'>issue with pgp key and have tried various times and not sure what I might be doing wrong but why do you have so many self-signed sigs?
</span><span class='line'>
</span><span class='line'>gpg --keyserver hkps.pool.sks-keyservers.net  --recv-keys C467A717507BBAFED3C160920BD9E81139CB4807
</span><span class='line'>
</span><span class='line'>uid  Henrique de Moraes Holschuh hmh@debian.org
</span><span class='line'>sig!3        0BD9E81139CB4807 2012-06-26  [self-signature]
</span><span class='line'>uid  Henrique de Moraes Holschuh hmh@hmh.eng.br
</span><span class='line'>sig!3        0BD9E81139CB4807 2012-06-26  [self-signature]
</span><span class='line'>sub  A4B9D9AFC03142CD
</span><span class='line'>sig!         0BD9E81139CB4807 2012-06-26  [self-signature]
</span><span class='line'>sub  981C05C79F47CF26
</span><span class='line'>sig!         0BD9E81139CB4807 2012-06-26  [self-signature]
</span><span class='line'>sub  9137FBD3DE6F0A93
</span><span class='line'>sig!         0BD9E81139CB4807 2014-03-23  [self-signature]
</span><span class='line'>sub  FFDB99C00EABDE2E
</span><span class='line'>sig!         0BD9E81139CB4807 2014-03-23  [self-signature]
</span><span class='line'>sub  FE11BFA68B158E98
</span><span class='line'>sig!         0BD9E81139CB4807 2016-03-26  [self-signature]
</span><span class='line'>sub  A4B1618F7F267286
</span><span class='line'>sig!         0BD9E81139CB4807 2016-03-26  [self-signature]
</span><span class='line'>key 0BD9E81139CB4807:
</span><span class='line'>6 duplicate signatures removed
</span><span class='line'>45 signatures not checked due to missing keys
</span><span class='line'>gpg: key 0BD9E81139CB4807: "Henrique de Moraes Holschuh hmh@hmh.eng.br" not changed
</span><span class='line'>gpg: Total number processed: 1
</span><span class='line'>gpg:              unchanged: 1
</span><span class='line'>
</span><span class='line'>please advise
</span><span class='line'>
</span><span class='line'>progandy commented on 2017-10-01 18:19             
</span><span class='line'>@oxe: I am not Henrique, so I don't know what he did with his key that it looks this strange, but it doesn't affect the package. The build works, and the signature is properly validated.
</span><span class='line'>
</span><span class='line'>Cbhihe commented on 2017-10-10 19:12           
</span><span class='line'>Hi:
</span><span class='line'>During install with '$ makepkg -sric ' I got: a PGP signature error: 
</span><span class='line'>
</span><span class='line'>A simplified output follows because I am typing (not copy/pasting) this on a different box than the one (4.13.4.-1-ARCH) where the install took place:
</span><span class='line'>
</span><span class='line'>== making package: iucode-tool 2.2-1 (Tue Oct 10...2017)
</span><span class='line'>== Checking runtime dependencies...
</span><span class='line'>== Checking buildtime dependencies...
</span><span class='line'>== Retrieving sources...
</span><span class='line'>downloads ok [...]
</span><span class='line'>== Validating source files with sha256sums...
</span><span class='line'>passed [...]
</span><span class='line'>== Verifying source files with gpg...
</span><span class='line'>iucode-tool_2.2.tar.xz ... FAILED (unknown public key FE11BFA68B158E98)
</span><span class='line'>== ERROR: One or more PGP signatures could not be verified !
</span><span class='line'>
</span><span class='line'>Can you explain that unknown PGP public key error ? 
</span><span class='line'>Is it a problem on my side ? 
</span><span class='line'>Please advise. I will be waiting for your response before I actually execute that code. Cheers.
</span><span class='line'>
</span><span class='line'>progandy commented on 2017-10-13 15:28             
</span><span class='line'>@Cbhihe: I did not have time and then forgot, sorry. Still, it should be obvious from the previous comments that you need to import the key in your gpg keyring with gpg, as described in the wiki for makepkg [1],[2]
</span><span class='line'>
</span><span class='line'>gpg --recv-keys FE11BFA68B158E98
</span><span class='line'>or
</span><span class='line'>gpg --recv-keys C467A717507BBAFED3C160920BD9E81139CB4807
</span><span class='line'>or
</span><span class='line'>gpg --keyserver hkps.pool.sks-keyservers.net --recv-keys C467A717507BBAFED3C160920BD9E81139CB4807
</span><span class='line'>
</span><span class='line'>[1]: https://wiki.archlinux.org/index.php/Makepkg#Signature_checking
</span><span class='line'>[2]: https://wiki.archlinux.org/index.php/GnuPG#Use_a_keyserver
</span><span class='line'>
</span><span class='line'>Cbhihe commented on 2017-10-14 17:40           
</span><span class='line'>Thank you. Yes it WAS obvious and I had tried 
</span><span class='line'>gpg --recv-keys FE11BFA68B158E98
</span><span class='line'>already, but for some reason I do not get, either the keyring did not register correctly or I screwed up something, or both. 
</span><span class='line'>
</span><span class='line'>I have reinstalled the Gnome keyring, re-imported my saved signatures and  
</span><span class='line'>gpg --keyserver hkps.pool.sks-keyservers.net --recv-keys C467A717507BBAFED3C160920BD9E81139CB4807
</span><span class='line'>worked this time. :-)
</span><span class='line'>Cheers.
</span><span class='line'>
</span><span class='line'>iucode-tool 2.2-1  (2017-09-13 07:49)
</span><span class='line'>( Unsupported package: Potentially dangerous ! )
</span><span class='line'>==&gt; Edit PKGBUILD ? [Y/n] ("A" to abort)
</span><span class='line'>==&gt; ------------------------------------
</span><span class='line'>==&gt; n
</span><span class='line'>
</span><span class='line'>==&gt; iucode-tool dependencies:
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>==&gt; Continue building iucode-tool ? [Y/n]
</span><span class='line'>==&gt; -------------------------------------
</span><span class='line'>==&gt; 
</span><span class='line'>
</span><span class='line'>==&gt; Building and installing package
</span><span class='line'>==&gt; Making package: iucode-tool 2.2-1 (Sun Jan 21 12:48:37 CET 2018)
</span><span class='line'>==&gt; Checking runtime dependencies...
</span><span class='line'>==&gt; Checking buildtime dependencies...
</span><span class='line'>==&gt; Retrieving sources...
</span><span class='line'>  -&gt; Downloading iucode-tool_2.2.tar.xz...
</span><span class='line'>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
</span><span class='line'>                                 Dload  Upload   Total   Spent    Left  Speed
</span><span class='line'>100  146k  100  146k    0     0  74948      0  0:00:02  0:00:02 --:--:-- 63193
</span><span class='line'>  -&gt; Downloading iucode-tool_2.2.tar.xz.asc...
</span><span class='line'>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
</span><span class='line'>                                 Dload  Upload   Total   Spent    Left  Speed
</span><span class='line'>100   833  100   833    0     0    833      0  0:00:01  0:00:01 --:--:--   478
</span><span class='line'>==&gt; Validating source files with sha256sums...
</span><span class='line'>    iucode-tool_2.2.tar.xz ... Passed
</span><span class='line'>    iucode-tool_2.2.tar.xz.asc ... Skipped
</span><span class='line'>==&gt; Verifying source file signatures with gpg...
</span><span class='line'>    iucode-tool_2.2.tar.xz ... Passed
</span><span class='line'>==&gt; Extracting sources...
</span><span class='line'>  -&gt; Extracting iucode-tool_2.2.tar.xz with bsdtar
</span><span class='line'>==&gt; Starting build()...
</span><span class='line'>checking build system type... x86_64-pc-linux-gnu
</span><span class='line'>checking host system type... x86_64-pc-linux-gnu
</span><span class='line'>checking for a BSD-compatible install... /usr/bin/install -c
</span><span class='line'>checking whether build environment is sane... yes
</span><span class='line'>checking for a thread-safe mkdir -p... /usr/bin/mkdir -p
</span><span class='line'>checking for gawk... gawk
</span><span class='line'>checking whether make sets $(MAKE)... yes
</span><span class='line'>checking whether make supports nested variables... yes
</span><span class='line'>checking whether configure.ac should try to override CFLAGS... no
</span><span class='line'>checking whether configure.ac should try to override LDFLAGS... no
</span><span class='line'>checking for style of include used by make... GNU
</span><span class='line'>checking for gcc... gcc
</span><span class='line'>checking whether the C compiler works... yes
</span><span class='line'>checking for C compiler default output file name... a.out
</span><span class='line'>checking for suffix of executables... 
</span><span class='line'>checking whether we are cross compiling... no
</span><span class='line'>checking for suffix of object files... o
</span><span class='line'>checking whether we are using the GNU C compiler... yes
</span><span class='line'>checking whether gcc accepts -g... yes
</span><span class='line'>checking for gcc option to accept ISO C89... none needed
</span><span class='line'>checking whether gcc understands -c and -o together... yes
</span><span class='line'>checking dependency style of gcc... gcc3
</span><span class='line'>checking how to run the C preprocessor... gcc -E
</span><span class='line'>checking for grep that handles long lines and -e... /usr/bin/grep
</span><span class='line'>checking for egrep... /usr/bin/grep -E
</span><span class='line'>checking for ANSI C header files... yes
</span><span class='line'>checking for sys/types.h... yes
</span><span class='line'>checking for sys/stat.h... yes
</span><span class='line'>checking for stdlib.h... yes
</span><span class='line'>checking for string.h... yes
</span><span class='line'>checking for memory.h... yes
</span><span class='line'>checking for strings.h... yes
</span><span class='line'>checking for inttypes.h... yes
</span><span class='line'>checking for stdint.h... yes
</span><span class='line'>checking for unistd.h... yes
</span><span class='line'>checking minix/config.h usability... no
</span><span class='line'>checking minix/config.h presence... no
</span><span class='line'>checking for minix/config.h... no
</span><span class='line'>checking whether it is safe to define __EXTENSIONS__... yes
</span><span class='line'>checking for gcc... (cached) gcc
</span><span class='line'>checking whether we are using the GNU C compiler... (cached) yes
</span><span class='line'>checking whether gcc accepts -g... (cached) yes
</span><span class='line'>checking for gcc option to accept ISO C89... (cached) none needed
</span><span class='line'>checking whether gcc understands -c and -o together... (cached) yes
</span><span class='line'>checking dependency style of gcc... (cached) gcc3
</span><span class='line'>checking for ANSI C header files... (cached) yes
</span><span class='line'>checking fcntl.h usability... yes
</span><span class='line'>checking fcntl.h presence... yes
</span><span class='line'>checking for fcntl.h... yes
</span><span class='line'>checking for stdint.h... (cached) yes
</span><span class='line'>checking for stdlib.h... (cached) yes
</span><span class='line'>checking for string.h... (cached) yes
</span><span class='line'>checking for unistd.h... (cached) yes
</span><span class='line'>checking time.h usability... yes
</span><span class='line'>checking time.h presence... yes
</span><span class='line'>checking for time.h... yes
</span><span class='line'>checking cpuid.h usability... yes
</span><span class='line'>checking cpuid.h presence... yes
</span><span class='line'>checking for cpuid.h... yes
</span><span class='line'>checking whether byte ordering is bigendian... no
</span><span class='line'>checking for inline... inline
</span><span class='line'>checking for int32_t... yes
</span><span class='line'>checking for size_t... yes
</span><span class='line'>checking for ssize_t... yes
</span><span class='line'>checking for uint16_t... yes
</span><span class='line'>checking for uint32_t... yes
</span><span class='line'>checking for uint8_t... yes
</span><span class='line'>checking for stdlib.h... (cached) yes
</span><span class='line'>checking for GNU libc compatible malloc... yes
</span><span class='line'>checking for stdlib.h... (cached) yes
</span><span class='line'>checking for GNU libc compatible realloc... yes
</span><span class='line'>checking whether lstat correctly handles trailing slash... yes
</span><span class='line'>checking whether stat accepts an empty string... no
</span><span class='line'>checking for memset... yes
</span><span class='line'>checking for strcasecmp... yes
</span><span class='line'>checking for strdup... yes
</span><span class='line'>checking for strerror... yes
</span><span class='line'>checking for strrchr... yes
</span><span class='line'>checking for strtoul... yes
</span><span class='line'>checking for timegm... yes
</span><span class='line'>checking for library containing argp_parse... none required
</span><span class='line'>checking for special C compiler options needed for large files... no
</span><span class='line'>checking for _FILE_OFFSET_BITS value needed for large files... no
</span><span class='line'>checking for flockfile... yes
</span><span class='line'>checking for fgets_unlocked... yes
</span><span class='line'>configure: project-wide base CPPFLAGS: -D_FORTIFY_SOURCE=2
</span><span class='line'>configure: project-wide base CFLAGS:   -march=x86-64 -mtune=generic -O2 -pipe -fstack-protector-strong -fno-plt
</span><span class='line'>configure: project-wide base LDFLAGS:  -Wl,-O1,--sort-common,--as-needed,-z,relro,-z,now
</span><span class='line'>checking that generated files are newer than configure... done
</span><span class='line'>configure: creating ./config.status
</span><span class='line'>config.status: creating Makefile
</span><span class='line'>config.status: creating iucode_tool.8
</span><span class='line'>config.status: creating iucode_tool_config.h
</span><span class='line'>config.status: executing depfiles commands
</span><span class='line'>make  all-am
</span><span class='line'>make[1]: Entering directory '/home/staf/tmp/yaourt-tmp-staf/aur-iucode-tool/src/iucode-tool-2.2'
</span><span class='line'>gcc -DHAVE_CONFIG_H -I.   -D_FORTIFY_SOURCE=2  -march=x86-64 -mtune=generic -O2 -pipe -fstack-protector-strong -fno-plt -MT intel_microcode.o -MD -MP -MF .deps/intel_microcode.Tpo -c -o intel_microcode.o intel_microcode.c
</span><span class='line'>gcc -DHAVE_CONFIG_H -I.   -D_FORTIFY_SOURCE=2  -march=x86-64 -mtune=generic -O2 -pipe -fstack-protector-strong -fno-plt -MT iucode_tool.o -MD -MP -MF .deps/iucode_tool.Tpo -c -o iucode_tool.o iucode_tool.c
</span><span class='line'>mv -f .deps/intel_microcode.Tpo .deps/intel_microcode.Po
</span><span class='line'>mv -f .deps/iucode_tool.Tpo .deps/iucode_tool.Po
</span><span class='line'>gcc  -march=x86-64 -mtune=generic -O2 -pipe -fstack-protector-strong -fno-plt  -Wl,-O1,--sort-common,--as-needed,-z,relro,-z,now -o iucode_tool intel_microcode.o iucode_tool.o  
</span><span class='line'>make[1]: Leaving directory '/home/staf/tmp/yaourt-tmp-staf/aur-iucode-tool/src/iucode-tool-2.2'
</span><span class='line'>==&gt; Entering fakeroot environment...
</span><span class='line'>==&gt; Starting package()...
</span><span class='line'>make[1]: Entering directory '/home/staf/tmp/yaourt-tmp-staf/aur-iucode-tool/src/iucode-tool-2.2'
</span><span class='line'> /usr/bin/mkdir -p '/home/staf/tmp/yaourt-tmp-staf/aur-iucode-tool/pkg/iucode-tool//usr/bin'
</span><span class='line'> /usr/bin/mkdir -p '/home/staf/tmp/yaourt-tmp-staf/aur-iucode-tool/pkg/iucode-tool//usr/share/man/man8'
</span><span class='line'>  /usr/bin/install -c iucode_tool '/home/staf/tmp/yaourt-tmp-staf/aur-iucode-tool/pkg/iucode-tool//usr/bin'
</span><span class='line'> /usr/bin/install -c -m 644 iucode_tool.8 '/home/staf/tmp/yaourt-tmp-staf/aur-iucode-tool/pkg/iucode-tool//usr/share/man/man8'
</span><span class='line'>make[1]: Leaving directory '/home/staf/tmp/yaourt-tmp-staf/aur-iucode-tool/src/iucode-tool-2.2'
</span><span class='line'>==&gt; Tidying install...
</span><span class='line'>  -&gt; Removing libtool files...
</span><span class='line'>  -&gt; Purging unwanted files...
</span><span class='line'>  -&gt; Removing static library files...
</span><span class='line'>  -&gt; Stripping unneeded symbols from binaries and libraries...
</span><span class='line'>  -&gt; Compressing man and info pages...
</span><span class='line'>==&gt; Checking for packaging issue...
</span><span class='line'>==&gt; Creating package "iucode-tool"...
</span><span class='line'>  -&gt; Generating .PKGINFO file...
</span><span class='line'>  -&gt; Generating .BUILDINFO file...
</span><span class='line'>  -&gt; Generating .MTREE file...
</span><span class='line'>  -&gt; Compressing package...
</span><span class='line'>==&gt; Leaving fakeroot environment.
</span><span class='line'>==&gt; Finished making: iucode-tool 2.2-1 (Sun Jan 21 12:48:44 CET 2018)
</span><span class='line'>==&gt; Cleaning up...
</span><span class='line'>
</span><span class='line'>==&gt; Continue installing iucode-tool ? [Y/n]
</span><span class='line'>==&gt; [v]iew package contents [c]heck package with namcap
</span><span class='line'>==&gt; ---------------------------------------------------
</span><span class='line'>==&gt; y
</span><span class='line'>
</span><span class='line'>loading packages...
</span><span class='line'>resolving dependencies...
</span><span class='line'>looking for conflicting packages...
</span><span class='line'>
</span><span class='line'>Packages (1) iucode-tool-2.2-1
</span><span class='line'>
</span><span class='line'>Total Installed Size:  0.06 MiB
</span><span class='line'>
</span><span class='line'>:: Proceed with installation? [Y/n] y
</span><span class='line'>(1/1) checking keys in keyring                                   [####################################] 100%
</span><span class='line'>(1/1) checking package integrity                                 [####################################] 100%
</span><span class='line'>(1/1) loading package files                                      [####################################] 100%
</span><span class='line'>(1/1) checking for file conflicts                                [####################################] 100%
</span><span class='line'>(1/1) checking available disk space                              [####################################] 100%
</span><span class='line'>:: Processing package changes...
</span><span class='line'>(1/1) installing iucode-tool                                     [####################################] 100%
</span><span class='line'>ldconfig: File /usr/lib/libmlt.so.6.4.0 is empty, not checked.
</span><span class='line'>ldconfig: File /usr/lib/libmlt++.so.6.4.0 is empty, not checked.
</span><span class='line'>ldconfig: File /usr/lib32/libmng.so.2 is empty, not checked.
</span><span class='line'>ldconfig: File /usr/lib32/libmng.so is empty, not checked.
</span><span class='line'>ldconfig: File /usr/lib32/libmng.so.2.0.2 is empty, not checked.
</span><span class='line'>:: Running post-transaction hooks...
</span><span class='line'>(1/1) Arming ConditionNeedsUpdate...
</span><span class='line'>[staf@frija ~]$ </span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@frija ~]# bsdtar -Oxf /boot/intel-ucode.img | iucode_tool -tb -lS - 
</span><span class='line'>iucode_tool: system has processor(s) with signature 0x00040661
</span><span class='line'>microcode bundle 1: (stdin)
</span><span class='line'>selected microcodes:
</span><span class='line'>  001/143: sig 0x00040661, pf_mask 0x32, 2017-11-20, rev 0x0018, size 25600
</span><span class='line'>[root@frija ~]# </span></code></pre></td></tr></table></div></figure>


<h3>Recreate grub.cfg</h3>

<p>grub-mkconfig will detect the microcode and add it the grub configuration.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@vicky ~]# grub-mkconfig -o /boot/grub/grub.cfg
</span><span class='line'>Generating grub configuration file ...
</span><span class='line'>Found linux image: /boot/vmlinuz-linux-lts
</span><span class='line'>Found initrd image(s) in /boot: intel-ucode.img initramfs-linux-lts.img
</span><span class='line'>Found fallback initrd image(s) in /boot: intel-ucode.img initramfs-linux-lts-fallback.img
</span><span class='line'>Found linux image: /boot/vmlinuz-linux-hardened
</span><span class='line'>Found initrd image(s) in /boot: intel-ucode.img initramfs-linux-hardened.img
</span><span class='line'>Found fallback initrd image(s) in /boot: intel-ucode.img initramfs-linux-hardened-fallback.img
</span><span class='line'>Found linux image: /boot/vmlinuz-linux-ck
</span><span class='line'>Found initrd image(s) in /boot: intel-ucode.img initramfs-linux-ck.img
</span><span class='line'>Found fallback initrd image(s) in /boot: intel-ucode.img initramfs-linux-ck-fallback.img
</span><span class='line'>Found linux image: /boot/vmlinuz-linux
</span><span class='line'>Found initrd image(s) in /boot: intel-ucode.img initramfs-linux.img
</span><span class='line'>Found fallback initrd image(s) in /boot: intel-ucode.img initramfs-linux-fallback.img
</span><span class='line'>done
</span><span class='line'>[root@vicky ~]# </span></code></pre></td></tr></table></div></figure>


<p>When take a look at the newly created grub.cfg you see that microcode image is added to the initrd image.
If you new micro code cause issue you can just remove the entry in grub configuration</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@vicky ~]# cat /boot/grub/grub.cfg | grep initrd
</span><span class='line'>  initrd  /__active/rootvol/boot/intel-ucode.img /__active/rootvol/boot/initramfs-linux-lts.img
</span><span class='line'>  initrd  /__active/rootvol/boot/intel-ucode.img /__active/rootvol/boot/initramfs-linux-lts-fallback.img
</span><span class='line'>  initrd  /__active/rootvol/boot/intel-ucode.img /__active/rootvol/boot/initramfs-linux-hardened.img
</span><span class='line'>  initrd  /__active/rootvol/boot/intel-ucode.img /__active/rootvol/boot/initramfs-linux-hardened-fallback.img
</span><span class='line'>  initrd  /__active/rootvol/boot/intel-ucode.img /__active/rootvol/boot/initramfs-linux-ck.img
</span><span class='line'>  initrd  /__active/rootvol/boot/intel-ucode.img /__active/rootvol/boot/initramfs-linux-ck-fallback.img
</span><span class='line'>  initrd  /__active/rootvol/boot/intel-ucode.img /__active/rootvol/boot/initramfs-linux.img
</span><span class='line'>  initrd  /__active/rootvol/boot/intel-ucode.img /__active/rootvol/boot/initramfs-linux-fallback.img
</span><span class='line'>[root@vicky ~]# 
</span></code></pre></td></tr></table></div></figure>


<h2>Reboot your system and verify</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[staf@frija ~]$ dmesg | grep -i microcode
</span><span class='line'>[    0.000000] microcode: microcode updated early to revision 0x18, date = 2017-11-20
</span><span class='line'>[    1.852726] microcode: sig=0x40661, pf=0x20, revision=0x18
</span><span class='line'>[    1.853029] microcode: Microcode Update Driver: v2.2.
</span><span class='line'>[staf@frija ~]$ </span></code></pre></td></tr></table></div></figure>


<p><strong><em>Have fun</em></strong></p>
</div>
  
  

<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- blog_actrikel -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-4659298941528586"
     data-ad-slot="7394058542"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2017/12/27/bacula-on-freebsd-part3/">Bacula on FreeBSD (Part 3 Storage Setup)</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2017-12-27T11:25:25+01:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>27</span><span class='date-suffix'>th</span>, <span class='date-year'>2017</span></span> <span class='time'>11:25 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img class="right" src="/blog/images/bacula_setup.jpg" width="500" height="416" title="&#34;bacula setup&#34;" alt="&#34;bacula setup&#34;"></p>

<p>I finally got the time to continue with my <a href="https://blog.bacula.org/">bacula</a> backup setup. See my previous posts about the start of my bacula setup.</p>

<ul>
<li><a href="http://stafwag.github.io/blog/blog/2017/08/06/bacula-on-freebsd:w_part1/">bacula on freebsd_part 1</a></li>
<li><a href="http://stafwag.github.io/blog/blog/2017/09/09/bacula-on-freebsd-part2/">bacula on freebsd part 2</a></li>
</ul>


<h1>Storage setup</h1>

<p>I created a new zfs pool &ldquo;bigpool&rdquo; with some old harddisks I probably need to replace them with bigger harddisk in the further.</p>

<h2>zfs filesystem</h2>

<p>First we create a zfs filesystem for our bacula storage.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@rataplan:~ # zfs create bigpool/bacula
</span><span class='line'>root@rataplan:~ # </span></code></pre></td></tr></table></div></figure>


<h2>delegate to jail</h2>

<h3>jailed</h3>

<p>We want to use the zfs dataset in the bacula jail so we need to delegate the control to the dataset into the bacula jail.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@rataplan:~ # zfs set jailed=on bigpool/bacula
</span><span class='line'>root@rataplan:~ # zfs jail stafbacula bigpool/bacula</span></code></pre></td></tr></table></div></figure>


<h3>verify</h3>

<p>When we logon to the jail we see that the zfs dateset is available.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@rataplan:~ # ezjail-admin console stafbacula
</span><span class='line'>Last login: Wed Dec 27 10:52:27 on pts/2
</span><span class='line'>FreeBSD 11.1-RELEASE-p4 (GENERIC) #0: Tue Nov 14 06:12:40 UTC 2017
</span><span class='line'>
</span><span class='line'>Welcome to FreeBSD!
</span><span class='line'>
</span><span class='line'>Release Notes, Errata: https://www.FreeBSD.org/releases/
</span><span class='line'>Security Advisories:   https://www.FreeBSD.org/security/
</span><span class='line'>FreeBSD Handbook:      https://www.FreeBSD.org/handbook/
</span><span class='line'>FreeBSD FAQ:           https://www.FreeBSD.org/faq/
</span><span class='line'>Questions List: https://lists.FreeBSD.org/mailman/listinfo/freebsd-questions/
</span><span class='line'>FreeBSD Forums:        https://forums.FreeBSD.org/
</span><span class='line'>
</span><span class='line'>Documents installed with the system are in the /usr/local/share/doc/freebsd/
</span><span class='line'>directory, or can be installed later with:  pkg install en-freebsd-doc
</span><span class='line'>For other languages, replace "en" with a language code like de or fr.
</span><span class='line'>
</span><span class='line'>Show the version of FreeBSD installed:  freebsd-version ; uname -a
</span><span class='line'>Please include that output and any error messages when posting questions.
</span><span class='line'>Introduction to manual pages:  man man
</span><span class='line'>FreeBSD directory layout:      man hier
</span><span class='line'>
</span><span class='line'>Edit /etc/motd to change this login announcement.
</span><span class='line'>You have new mail.
</span><span class='line'>root@stafbacula:~ # zfs list
</span><span class='line'>NAME             USED  AVAIL  REFER  MOUNTPOINT
</span><span class='line'>bigpool         1.14M   433G    23K  /bigpool
</span><span class='line'>bigpool/bacula    23K   433G    23K  /bigpool/bacula
</span><span class='line'>root@stafbacula:~ # </span></code></pre></td></tr></table></div></figure>


<p>When we restart the jail we see that the dataset isn&rsquo;t available anymore in the jail</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@stafbacula:~ # logout
</span><span class='line'>root@rataplan:~ # /usr/local/etc/rc.d/ezjail restart stafbacula
</span><span class='line'>Stopping jails: stafbacula.
</span><span class='line'>Starting jails: stafbacula.
</span><span class='line'>/etc/rc.d/jail: WARNING: Per-jail configuration via jail_* variables  is obsolete.  Please consider migrating to /etc/jail.conf.
</span><span class='line'>root@rataplan:~ # ezjail-admin console stafbacula
</span><span class='line'>Last login: Wed Dec 27 10:58:33 on pts/2
</span><span class='line'>FreeBSD 11.1-RELEASE-p4 (GENERIC) #0: Tue Nov 14 06:12:40 UTC 2017
</span><span class='line'>
</span><span class='line'>Welcome to FreeBSD!
</span><span class='line'>
</span><span class='line'>Release Notes, Errata: https://www.FreeBSD.org/releases/
</span><span class='line'>Security Advisories:   https://www.FreeBSD.org/security/
</span><span class='line'>FreeBSD Handbook:      https://www.FreeBSD.org/handbook/
</span><span class='line'>FreeBSD FAQ:           https://www.FreeBSD.org/faq/
</span><span class='line'>Questions List: https://lists.FreeBSD.org/mailman/listinfo/freebsd-questions/
</span><span class='line'>FreeBSD Forums:        https://forums.FreeBSD.org/
</span><span class='line'>
</span><span class='line'>Documents installed with the system are in the /usr/local/share/doc/freebsd/
</span><span class='line'>directory, or can be installed later with:  pkg install en-freebsd-doc
</span><span class='line'>For other languages, replace "en" with a language code like de or fr.
</span><span class='line'>
</span><span class='line'>Show the version of FreeBSD installed:  freebsd-version ; uname -a
</span><span class='line'>Please include that output and any error messages when posting questions.
</span><span class='line'>Introduction to manual pages:  man man
</span><span class='line'>FreeBSD directory layout:      man hier
</span><span class='line'>
</span><span class='line'>Edit /etc/motd to change this login announcement.
</span><span class='line'>You have new mail.
</span><span class='line'>root@stafbacula:~ # zfs list
</span><span class='line'>no datasets available
</span><span class='line'>root@stafbacula:~ # </span></code></pre></td></tr></table></div></figure>


<h3>make persistent</h3>

<h4>enable zfs in the jail</h4>

<p>When the jail is booted it need to bring the zfs filesystem online. We need to add <code>zfs_enable=YES</code> to the jail rc.conf</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@rataplan:~ # vi /usr/jails/stafbacula/etc/rc.conf</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>bacula_dir="start"
</span><span class='line'>bacula_dir_enable="yes"
</span><span class='line'>zfs_enable="YES"</span></code></pre></td></tr></table></div></figure>


<h4>update the ezjail configuration</h4>

<p>ezjail needs to jail the zfs dataset to the jail when it&rsquo;s start the jail.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@rataplan:~ # vi /usr/local/etc/ezjail/stafbacula</span></code></pre></td></tr></table></div></figure>


<p>We need to add the dataset to the jail&rsquo;s zfs_datasets. By default a jail isn&rsquo;t allowed to mount the zfs dataset so need to update jail&rsquo;s parmeters.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>export jail_stafbacula_zfs_datasets="bigpool/bacula"
</span><span class='line'>export jail_stafbacula_parameters="enforce_statfs=0 allow.mount=1 allow.mount.zfs=1 allow.mount.procfs=1 allow.mount.devfs=1"
</span></code></pre></td></tr></table></div></figure>


<p>Restart the jail and verify that the zfs filesystem is available inside the jail</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@rataplan:~ # ezjail-admin restart stafbacula
</span><span class='line'>Stopping jails: stafbacula.
</span><span class='line'>Starting jails: stafbacula.
</span><span class='line'>/etc/rc.d/jail: WARNING: Per-jail configuration via jail_* variables  is obsolete.  Please consider migrating to /etc/jail.conf.
</span><span class='line'>root@rataplan:~ # </span></code></pre></td></tr></table></div></figure>


<p>Verify that dataset is mounted</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@rataplan:~ # ezjail-admin console stafbacula
</span><span class='line'>Last login: Wed Dec 27 11:36:04 on pts/2
</span><span class='line'>FreeBSD 11.1-RELEASE-p4 (GENERIC) #0: Tue Nov 14 06:12:40 UTC 2017
</span><span class='line'>
</span><span class='line'>Welcome to FreeBSD!
</span><span class='line'>
</span><span class='line'>Release Notes, Errata: https://www.FreeBSD.org/releases/
</span><span class='line'>Security Advisories:   https://www.FreeBSD.org/security/
</span><span class='line'>FreeBSD Handbook:      https://www.FreeBSD.org/handbook/
</span><span class='line'>FreeBSD FAQ:           https://www.FreeBSD.org/faq/
</span><span class='line'>Questions List: https://lists.FreeBSD.org/mailman/listinfo/freebsd-questions/
</span><span class='line'>FreeBSD Forums:        https://forums.FreeBSD.org/
</span><span class='line'>
</span><span class='line'>Documents installed with the system are in the /usr/local/share/doc/freebsd/
</span><span class='line'>directory, or can be installed later with:  pkg install en-freebsd-doc
</span><span class='line'>For other languages, replace "en" with a language code like de or fr.
</span><span class='line'>
</span><span class='line'>Show the version of FreeBSD installed:  freebsd-version ; uname -a
</span><span class='line'>Please include that output and any error messages when posting questions.
</span><span class='line'>Introduction to manual pages:  man man
</span><span class='line'>FreeBSD directory layout:      man hier
</span><span class='line'>
</span><span class='line'>Edit /etc/motd to change this login announcement.
</span><span class='line'>You have new mail.
</span><span class='line'>root@stafbacula:~ # zfs list
</span><span class='line'>NAME             USED  AVAIL  REFER  MOUNTPOINT
</span><span class='line'>bigpool         1.14M   433G    23K  /bigpool
</span><span class='line'>bigpool/bacula    23K   433G    23K  /bigpool/bacula
</span><span class='line'>root@stafbacula:~ # df -h /bigpool/bacula
</span><span class='line'>Filesystem                    Size    Used   Avail Capacity  Mounted on
</span><span class='line'>zroot/usr/jails/stafbacula    2.6T    618M    2.6T     0%    /usr/jails/stafbacula
</span><span class='line'>root@stafbacula:~ # </span></code></pre></td></tr></table></div></figure>


<h1>Links</h1>

<ul>
<li><a href="http://www.allanjude.com/blog/2013-10-05_poudriere_jail"><a href="http://www.allanjude.com/blog/2013-10-05_poudriere_jail">http://www.allanjude.com/blog/2013-10-05_poudriere_jail</a></a></li>
</ul>

</div>
  
  

<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- blog_actrikel -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-4659298941528586"
     data-ad-slot="7394058542"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2017/10/20/model-m-tux-update-dot-dot-dot/">Model-m Tux Update...</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2017-10-20T17:27:41+02:00'><span class='date'><span class='date-month'>Oct</span> <span class='date-day'>20</span><span class='date-suffix'>th</span>, <span class='date-year'>2017</span></span> <span class='time'>5:27 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img class="right" src="/blog/images/modelm_tux_only.jpg" width="400" height="266" title="&#34;modelm_tux_only.jpg&#34;" alt="&#34;modelm_tux_only.jpg&#34;"></p>

<p>I own a <a href="https://en.wikipedia.org/wiki/Unicomp">Unicomp</a> <a herf="https://en.wikipedia.org/wiki/Model_M_keyboard">model-m keyboard</a>. The keyboard has a nice key feel but it has windows super key(s).</p>

<p><br /></p>

<p>I don&rsquo;t use super key(s), and would prefer to have a keyboard without it.  But when it has super keys  I&rsquo;d rather have it without the windows logo on it so it was time  to replace them with <a href="http://www.keyboardco.com/product/unicomp-gray-linux-tux-keyset.asp">the tux version</a></p>

<h3>Pictures</h3>

<p><a href="/blog/images/modelm_tux_package.jpg"><img src="/blog/images/modelm_tux_package.jpg" height="250" width="375" alt="modelm_tux_package.jpg" /></a>
<a href="/blog/images/modelm_all_keys.jpg"><img src="/blog/images/modelm_all_keys.jpg" height="250" width="375" alt="modelm_all_keys.jpg" /></a>
<a href="/blog/images/modelm_tux_only.jpg"><img src="/blog/images/modelm_tux_only.jpg" height="250" width="375" alt="modelm_tux_only.jpg" /></a>
<a href="/blog/images/modelm_with_tux_keys.jpg"><img src="/blog/images/modelm_with_tux_keys.jpg" height="250" width="375" alt="modelm_with_tux_keys.jpg" /></a></p>
</div>
  
  

<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- blog_actrikel -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-4659298941528586"
     data-ad-slot="7394058542"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2017/09/30/jenkins-build-with-20-cores/">Jenkins Build With 20 Cores</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2017-09-30T19:18:14+02:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>30</span><span class='date-suffix'>th</span>, <span class='date-year'>2017</span></span> <span class='time'>7:18 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I finally got the time to try out my jenkins build on my new <a href="http://stafwag.github.io/blog/blog/2017/09/16/20-core-dual-processor-jenkins-build-workstation/">20 Core Dual Processor Jenkins Build Workstation</a></p>

<div class="embed-video-container"><iframe src="http://www.youtube.com/embed/BNn9absXkE8 "></iframe></div>


<p>I&rsquo;m able to run all test on multiple operation systems now. I still need to review this setup and perhaps move some tests to <a href="https://www.docker.io">docker</a> instead of the virtual machines to save some memory. &hellip;but this jenkins setup was configured before docker was a thing.</p>

<p><strong><em>Have fun</em></strong></p>
</div>
  
  

<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- blog_actrikel -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-4659298941528586"
     data-ad-slot="7394058542"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2017/09/16/20-core-dual-processor-jenkins-build-workstation/">20 Core Dual Processor Jenkins Build Workstation</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2017-09-16T14:29:51+02:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>16</span><span class='date-suffix'>th</span>, <span class='date-year'>2017</span></span> <span class='time'>2:29 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img class="left" src="/blog/images/201709_xeon_cpu_side.jpg" width="400" height="388" title="&#34;Xeon CPU Side&#34;" alt="&#34;Xeon CPU Side&#34;"></p>

<p><br /></p>

<p>My jenkins builds are taking too long mainly due the lack of memory. I mainly use jenkins to verify that my software work on different operation systems (GNU/Linux distributions / *BSD / Solaris).</p>

<p>Looking for a solution that is still affordable I ended up with building a dual Xeon workstation. CPU and memory comes from <a href="http://www.ebay.be">www.ebay.be</a></p>

<p><br />&nbsp;<br />
<br /></p>

<h3>Part list:</h3>

<ul>
<li><strong>CPU:</strong> 2 * <a href="http://ark.intel.com/products/75272/Intel-Xeon-Processor-E5-2660-v2-25M-Cache-2_20-GHz">Intel Xeon E5-2660v2</a> This CPU has 10 cores and 20 thread, so I get 40 threads.</li>
<li><strong>Motherboard:</strong> <a href="http://www.asrockrack.com/general/productdetail.asp?Model=EP2C602-4L/D16#Specifications">Asrock EP2C602-4L/D16</a> I choose this motherboard because it has a lot of DIMM slots so I can upgrade the memory in the further. Downside is that layout is SSI EEB that limits the case choose.</li>
<li><strong>Memory:</strong> 4 * SAMSUNG M393B2G70BH0-CK0 16GB which gives me 64 GB <a href="https://en.wikipedia.org/wiki/ECC_memory">ECC memory</a></li>
<li><strong>CPU Cooler</strong> 2 * <a href="http://www.thermaltake.com/products-model.aspx?id=C_00002470">Thermaltake Water 3.0 Performer C</a> For the first I used watercooling mainly because I wanted to make sure that the cooling will not block the access to the DIMM slots.</li>
<li><strong>PSU:</strong> <a href="https://seasonic.com/product/focus-plus-750-gold/">Seasonic FOCUS Plus 750 Gold</a> I needed a power supply with 2 * 8 pins CPU connectors.</li>
<li><strong>Case:</strong> <a href="http://www.phanteks.com/Enthoo-Pro.html">Phanteks Enthoo Pro</a> This case supports SSI EEB and is not too expensive.</li>
</ul>


<h3>Pictures</h3>

<p><a href="/blog/images/201709_xeon_cpu_side.jpg"><img src="/blog/images/201709_xeon_cpu_side.jpg" height="291" width="300" alt="Xeon CPU side" /></a>
<a href="/blog/images/201709_xeon_hd_side.jpg"><img src="/blog/images/201709_xeon_hd_side.jpg" height="291" width="317" alt="Xeon CPU side" /></a>
<a href="/blog/images/201709_xeon_front_side.jpg"><img src="/blog/images/201709_xeon_front_side.jpg" height="291" width="151" alt="Xeon CPU side" /></a></p>

<p><strong><em>Still need to verify if jenkins works on this system :-) </em></strong></p>
</div>
  
  

<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- blog_actrikel -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-4659298941528586"
     data-ad-slot="7394058542"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2017/09/09/bacula-on-freebsd-part2/">Bacula on FreeBSD (Part 2 Bacula Catalog Over SSL )</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2017-09-09T10:27:03+02:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>9</span><span class='date-suffix'>th</span>, <span class='date-year'>2017</span></span> <span class='time'>10:27 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img class="right" src="/blog/images/postgressl.png" width="300" height="300" title="&#34;PostgreSSL&#34;" alt="&#34;PostgreSSL&#34;"></p>

<p>In my previous <a href="http://stafwag.github.io/blog/blog/2017/08/06/bacula-on-freebsd:w_part1/">post</a>, I setup on my <a href="https://www.postgresql.org/">PostgresSQL</a> <a href="https://en.wikipedia.org/wiki/FreeBSD_jail">FreeBSD jail</a>, In this post we continue with the bacaula server.</p>

<p>In this post we will continue with the database connection (Catalog) we&rsquo;ll go the extra <del>mile</del> 1,609344 km and encrypt the catalog connection with ssl. Why? <strong><em>We encrypt.. because we can!</em></strong></p>

<h1>Bacula Components</h1>

<ul>
<li><p><strong>Bacula Director</strong> <br />
The Bacula Director is daemon that runs in the backgroud that control all backup operations.</p></li>
<li><p><strong>Bacula Console</strong> <br />
The Bacula console is an administrator program that allows an system administrator to control the Bacula director.</p></li>
<li><p><strong>Bacula File</strong> <br />
The Bacula File is a backup client install on the backup client.</p></li>
<li><p><strong>Bacula Storage</strong> <br />
The backup media.</p></li>
<li><p><strong>Catalog</strong> <br />
The Catalog is the index of the backups. Bacula supports three types of index databases mySQL ( <a href="https://mariadb.org/">mariaDB</a>), <a href="https://www.postgresql.org/">PostgreSQL</a> and <a href="https://sqlite.org/">SQLite</a></p></li>
<li><p><strong>Bacula monitor</strong> <br />
A Bacula monitor service is a program that allows the system administrator to cerify the status of the bacula Directors, Bacula File Daemons and Bacula Storage Daemons.</p></li>
</ul>


<h1>Bacula Server</h1>

<h2>Jail</h2>

<h3>Create the Bacula Server Jail</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@rataplan:~ # ezjail-admin create stafbacula "em0|192.168.1.52"
</span><span class='line'>Warning: Some services already seem to be listening on all IP, (including 192.168.1.52)
</span><span class='line'>  This may cause some confusion, here they are:
</span><span class='line'>root     ntpd       754   20 udp6   *:123                 *:*
</span><span class='line'>root     ntpd       754   21 udp4   *:123                 *:*
</span><span class='line'>root     rpc.statd  717   4  udp6   *:846                 *:*
</span><span class='line'>root     rpc.statd  717   5  tcp6   *:846                 *:*
</span><span class='line'>root     rpc.statd  717   6  udp4   *:846                 *:*
</span><span class='line'>root     rpc.statd  717   7  tcp4   *:846                 *:*
</span><span class='line'>root     nfsd       713   5  tcp4   *:2049                *:*
</span><span class='line'>root     nfsd       713   6  tcp6   *:2049                *:*
</span><span class='line'>root     mountd     707   5  udp6   *:823                 *:*
</span><span class='line'>root     mountd     707   6  tcp6   *:823                 *:*
</span><span class='line'>root     mountd     707   7  udp4   *:823                 *:*
</span><span class='line'>root     mountd     707   8  tcp4   *:823                 *:*
</span><span class='line'>root     rpcbind    676   6  udp6   *:111                 *:*
</span><span class='line'>root     rpcbind    676   7  udp6   *:779                 *:*
</span><span class='line'>root     rpcbind    676   8  tcp6   *:111                 *:*
</span><span class='line'>root     rpcbind    676   9  udp4   *:111                 *:*
</span><span class='line'>root     rpcbind    676   10 udp4   *:768                 *:*
</span><span class='line'>root     rpcbind    676   11 tcp4   *:111                 *:*
</span><span class='line'>root     syslogd    656   6  udp6   *:514                 *:*
</span><span class='line'>root     syslogd    656   7  udp4   *:514                 *:*
</span><span class='line'>root@rataplan:~ # </span></code></pre></td></tr></table></div></figure>


<h3>Start the jail</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@rataplan:~ # ezjail-admin start stafbacula
</span><span class='line'>Starting jails: stafbacula.
</span><span class='line'>/etc/rc.d/jail: WARNING: Per-jail configuration via jail_* variables  is obsolete.  Please consider migrating to /etc/jail.conf.
</span><span class='line'>root@rataplan:~ # </span></code></pre></td></tr></table></div></figure>


<h3>Open the console</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@rataplan:~ # ezjail-admin console stafbacula
</span><span class='line'>FreeBSD 11.1-RELEASE-p1 (GENERIC) #0: Wed Sep  9 11:55:48 UTC 2017
</span><span class='line'>
</span><span class='line'>Welcome to FreeBSD!
</span><span class='line'>
</span><span class='line'>Release Notes, Errata: https://www.FreeBSD.org/releases/
</span><span class='line'>Security Advisories:   https://www.FreeBSD.org/security/
</span><span class='line'>FreeBSD Handbook:      https://www.FreeBSD.org/handbook/
</span><span class='line'>FreeBSD FAQ:           https://www.FreeBSD.org/faq/
</span><span class='line'>Questions List: https://lists.FreeBSD.org/mailman/listinfo/freebsd-questions/
</span><span class='line'>FreeBSD Forums:        https://forums.FreeBSD.org/
</span><span class='line'>
</span><span class='line'>Documents installed with the system are in the /usr/local/share/doc/freebsd/
</span><span class='line'>directory, or can be installed later with:  pkg install en-freebsd-doc
</span><span class='line'>For other languages, replace "en" with a language code like de or fr.
</span><span class='line'>
</span><span class='line'>Show the version of FreeBSD installed:  freebsd-version ; uname -a
</span><span class='line'>Please include that output and any error messages when posting questions.
</span><span class='line'>Introduction to manual pages:  man man
</span><span class='line'>FreeBSD directory layout:      man hier
</span><span class='line'>
</span><span class='line'>Edit /etc/motd to change this login announcement.
</span><span class='line'>root@stafbacula:~ # </span></code></pre></td></tr></table></div></figure>


<h2>Bacula installation</h2>

<h3>Install pkg</h3>

<p>Set up dns</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@stafbacula:~ # vi /etc/resolv.conf</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nameserver 192.168.1.1</span></code></pre></td></tr></table></div></figure>


<p>Bootstrap pkg</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@stafbacula:~ # pkg
</span><span class='line'>The package management tool is not yet installed on your system.
</span><span class='line'>Do you want to fetch and install it now? [y/N]: y
</span><span class='line'>Bootstrapping pkg from pkg+http://pkg.FreeBSD.org/FreeBSD:11:amd64/quarterly, please wait...
</span><span class='line'>Verifying signature with trusted certificate pkg.freebsd.org.2013102301... done
</span><span class='line'>[stafbacula] Installing pkg-1.10.1...
</span><span class='line'>[stafbacula] Extracting pkg-1.10.1: 100%
</span><span class='line'>pkg: not enough arguments
</span><span class='line'>Usage: pkg [-v] [-d] [-l] [-N] [-j &lt;jail name or id&gt;|-c &lt;chroot path&gt;|-r &lt;rootdir&gt;] [-C &lt;configuration file&gt;] [-R &lt;repo config dir&gt;] [-o var=value] [-4|-6] &lt;command&gt; [&lt;args&gt;]
</span><span class='line'>
</span><span class='line'>For more information on available commands and options see 'pkg help'.
</span><span class='line'>root@stafbacula:~ # </span></code></pre></td></tr></table></div></figure>


<p>Install the bacula server package</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@stafbacula:~ # pkg install bacula-server
</span><span class='line'>Updating FreeBSD repository catalogue...
</span><span class='line'>FreeBSD repository is up to date.
</span><span class='line'>All repositories are up to date.
</span><span class='line'>Updating database digests format: 100%
</span><span class='line'>The following 8 package(s) will be affected (of 0 checked):
</span><span class='line'>
</span><span class='line'>New packages to be INSTALLED:
</span><span class='line'>        bacula-server: 7.4.7_1
</span><span class='line'>        bacula-client: 7.4.7_1
</span><span class='line'>        readline: 7.0.3
</span><span class='line'>        indexinfo: 0.2.6
</span><span class='line'>        gettext-runtime: 0.19.8.1_1
</span><span class='line'>        lzo2: 2.10_1
</span><span class='line'>        postgresql95-client: 9.5.7_1
</span><span class='line'>        perl5: 5.24.1_1
</span><span class='line'>
</span><span class='line'>Number of packages to be installed: 8
</span><span class='line'>
</span><span class='line'>The process will require 69 MiB more space.
</span><span class='line'>17 MiB to be downloaded.
</span><span class='line'>
</span><span class='line'>Proceed with this action? [y/N]: y
</span><span class='line'>[stafbacula] [1/8] Fetching bacula-server-7.4.7_1.txz: 100%  678 KiB 694.6kB/s    00:01    
</span><span class='line'>[stafbacula] [2/8] Fetching bacula-client-7.4.7_1.txz: 100%  286 KiB 292.8kB/s    00:01    
</span><span class='line'>[stafbacula] [3/8] Fetching readline-7.0.3.txz: 100%  334 KiB 342.4kB/s    00:01    
</span><span class='line'>[stafbacula] [4/8] Fetching indexinfo-0.2.6.txz: 100%    5 KiB   5.3kB/s    00:01    
</span><span class='line'>[stafbacula] [5/8] Fetching gettext-runtime-0.19.8.1_1.txz: 100%  148 KiB 151.1kB/s    00:01    
</span><span class='line'>[stafbacula] [6/8] Fetching lzo2-2.10_1.txz: 100%  113 KiB 115.4kB/s    00:01    
</span><span class='line'>[stafbacula] [7/8] Fetching postgresql95-client-9.5.7_1.txz: 100%    2 MiB 772.9kB/s    00:03    
</span><span class='line'>[stafbacula] [8/8] Fetching perl5-5.24.1_1.txz: 100%   13 MiB 874.0kB/s    00:16    
</span><span class='line'>Checking integrity... done (0 conflicting)
</span><span class='line'>[stafbacula] [1/8] Installing indexinfo-0.2.6...
</span><span class='line'>[stafbacula] [1/8] Extracting indexinfo-0.2.6: 100%
</span><span class='line'>[stafbacula] [2/8] Installing readline-7.0.3...
</span><span class='line'>[stafbacula] [2/8] Extracting readline-7.0.3: 100%
</span><span class='line'>[stafbacula] [3/8] Installing gettext-runtime-0.19.8.1_1...
</span><span class='line'>[stafbacula] [3/8] Extracting gettext-runtime-0.19.8.1_1: 100%
</span><span class='line'>[stafbacula] [4/8] Installing lzo2-2.10_1...
</span><span class='line'>[stafbacula] [4/8] Extracting lzo2-2.10_1: 100%
</span><span class='line'>[stafbacula] [5/8] Installing perl5-5.24.1_1...
</span><span class='line'>[stafbacula] [5/8] Extracting perl5-5.24.1_1: 100%
</span><span class='line'>[stafbacula] [6/8] Installing bacula-client-7.4.7_1...
</span><span class='line'>===&gt; Creating groups.
</span><span class='line'>Creating group 'bacula' with gid '910'.
</span><span class='line'>===&gt; Creating users
</span><span class='line'>Creating user 'bacula' with uid '910'.
</span><span class='line'>[stafbacula] [6/8] Extracting bacula-client-7.4.7_1: 100%
</span><span class='line'>[stafbacula] [7/8] Installing postgresql95-client-9.5.7_1...
</span><span class='line'>[stafbacula] [7/8] Extracting postgresql95-client-9.5.7_1: 100%
</span><span class='line'>[stafbacula] [8/8] Installing bacula-server-7.4.7_1...
</span><span class='line'>===&gt; Creating groups.
</span><span class='line'>Using existing group 'bacula'.
</span><span class='line'>===&gt; Creating users
</span><span class='line'>Using existing user 'bacula'.
</span><span class='line'>[stafbacula] Extracting bacula-server-7.4.7_1: 100%
</span><span class='line'>Message from perl5-5.24.1_1:
</span><span class='line'>The /usr/bin/perl symlink has been removed starting with Perl 5.20.
</span><span class='line'>For shebangs, you should either use:
</span><span class='line'>
</span><span class='line'>#!/usr/local/bin/perl
</span><span class='line'>
</span><span class='line'>or
</span><span class='line'>
</span><span class='line'>#!/usr/bin/env perl
</span><span class='line'>
</span><span class='line'>The first one will only work if you have a /usr/local/bin/perl,
</span><span class='line'>the second will work as long as perl is in PATH.
</span><span class='line'>Message from bacula-client-7.4.7_1:
</span><span class='line'>################################################################################
</span><span class='line'>
</span><span class='line'>NOTE:
</span><span class='line'>Sample files are installed in /usr/local/etc/bacula:
</span><span class='line'>
</span><span class='line'>  bconsole.conf.sample, bacula-fd.conf.sample
</span><span class='line'>
</span><span class='line'>################################################################################
</span><span class='line'>Message from postgresql95-client-9.5.7_1:
</span><span class='line'>The PostgreSQL port has a collection of "side orders":
</span><span class='line'>
</span><span class='line'>postgresql-docs
</span><span class='line'>  For all of the html documentation
</span><span class='line'>
</span><span class='line'>p5-Pg
</span><span class='line'>  A perl5 API for client access to PostgreSQL databases.
</span><span class='line'>
</span><span class='line'>postgresql-tcltk
</span><span class='line'>  If you want tcl/tk client support.
</span><span class='line'>
</span><span class='line'>postgresql-jdbc
</span><span class='line'>  For Java JDBC support.
</span><span class='line'>
</span><span class='line'>postgresql-odbc
</span><span class='line'>  For client access from unix applications using ODBC as access
</span><span class='line'>  method. Not needed to access unix PostgreSQL servers from Win32
</span><span class='line'>  using ODBC. See below.
</span><span class='line'>
</span><span class='line'>ruby-postgres, py-PyGreSQL
</span><span class='line'>  For client access to PostgreSQL databases using the ruby & python
</span><span class='line'>  languages.
</span><span class='line'>
</span><span class='line'>postgresql-plperl, postgresql-pltcl & postgresql-plruby
</span><span class='line'>  For using perl5, tcl & ruby as procedural languages.
</span><span class='line'>
</span><span class='line'>postgresql-contrib
</span><span class='line'>  Lots of contributed utilities, postgresql functions and
</span><span class='line'>  datatypes. There you find pg_standby, pgcrypto and many other cool
</span><span class='line'>  things.
</span><span class='line'>
</span><span class='line'>etc...
</span><span class='line'>Message from bacula-server-7.4.7_1:
</span><span class='line'>###############################################################################
</span><span class='line'>
</span><span class='line'>bacula server was installed
</span><span class='line'>
</span><span class='line'>An auto-changer manipulation script based on FreeBSDs
</span><span class='line'>chio command is included and installed at
</span><span class='line'>
</span><span class='line'>  /usr/local/sbin/chio-bacula
</span><span class='line'>
</span><span class='line'>Please have a look at it if you want to use an
</span><span class='line'>autochanger. You have to configure the usage in
</span><span class='line'>
</span><span class='line'>  /usr/local/etc/bacula/bacula-dir.conf
</span><span class='line'>
</span><span class='line'>Take care of correct permissions for changer and
</span><span class='line'>tape device (e.g. /dev/ch0 and /dev/n[r]sa0) i.e.
</span><span class='line'>they must be accessible by user bacula.
</span><span class='line'>
</span><span class='line'>Due to lack of some features in the FreeBSD tape driver
</span><span class='line'>implementation you MUST add some OS dependent options to
</span><span class='line'>the bacula-sd.conf file:
</span><span class='line'>
</span><span class='line'>  Hardware End of Medium = no;
</span><span class='line'>  Backward Space Record  = no;
</span><span class='line'>  Backward Space File    = no;
</span><span class='line'>
</span><span class='line'>With 2 filemarks at EOT (see man mt):
</span><span class='line'>  Fast Forward Space File = no;
</span><span class='line'>  BSF at EOM = yes;
</span><span class='line'>  TWO EOF    = yes;
</span><span class='line'>
</span><span class='line'>With 1 filemarks at EOT (see man mt):
</span><span class='line'>  Fast Forward Space File = yes;
</span><span class='line'>  BSF at EOM = no;
</span><span class='line'>  TWO EOF   = no;
</span><span class='line'>
</span><span class='line'>NOTE: YOU CAN SWITCH EOT model ONLY when starting
</span><span class='line'>      from scratch with EMPTY tapes.
</span><span class='line'>
</span><span class='line'>It is also important that all the scripts accessed
</span><span class='line'>by RunBeforeJob and RunAfterJob will be executed by
</span><span class='line'>the user bacula.  Check your permissions.
</span><span class='line'>
</span><span class='line'>For USB support read the bacula manual. It could be necessary
</span><span class='line'>to configure/compile a new kernel.
</span><span class='line'>
</span><span class='line'>Look at /usr/local/share/bacula/update_bacula_tables for
</span><span class='line'>database update procedure. Details can be found in the
</span><span class='line'>ReleaseNotes
</span><span class='line'>
</span><span class='line'>If you are using sqlite you need to run the make_sqlite_tables script as
</span><span class='line'>the bacula user. Do this using 'sudo su -m bacula'.
</span><span class='line'>
</span><span class='line'>################################################################################
</span><span class='line'>root@stafbacula:~ # </span></code></pre></td></tr></table></div></figure>


<h1>Initialize the bacula catalog</h1>

<p>We&rsquo;ll have a postgreSQL server running in a FreeBSD jail as our catalog (see <a href="http://stafwag.github.io/blog/blog/2017/08/06/bacula-on-freebsd:w_part1/"><a href="http://stafwag.github.io/blog/blog/2017/08/06/bacula-on-freebsd:w_part1/">http://stafwag.github.io/blog/blog/2017/08/06/bacula-on-freebsd:w_part1/</a></a> howto install PostgreSQL into a FreeBSD jail).</p>

<h2>PostgreSQL setup</h2>

<p>The setup below describes howto configure the PostgreSQL catalog with certificate and username/password authentication. This might be overkill the bacula server runs on the same physical host so no data is going out on the network. But I wanted to setup the database conneection as secure as possible and will reuse this setup for my other database connection. We&rsquo;ll setup a &ldquo;self signed&rdquo; root ca for now, but I replace this with my own CA in further.</p>

<h3>PostgreSQL authentication methods</h3>

<p>PostgreSQL support a lot of authentication methods you&rsquo;ll find a description of the supported of the support authentication methods below (without too much details):</p>

<ul>
<li><strong>Trust Authentication</strong> <br />
With trust authentication the postgreSQL trust the connection from the remote host, this is the default for localhost host connection and &ldquo;socket&rdquo; connections.
<br />&nbsp;<br /></li>
<li><strong>Password Authentication</strong> <br />
Authentication with login/password
<br />&nbsp;<br /></li>
<li><strong>GSSAPI Authentication</strong> <br />
Authentication with the <a href="https://en.wikipedia.org/wiki/Generic_Security_Services_Application_Program_Interface">Generic Security Services Application Program Interface</a>
<br />&nbsp;<br /></li>
<li><strong>SSPI Authentication</strong> <br />
Authentication with the <a href="https://en.wikipedia.org/wiki/Security_Support_Provider_Interface"">Security Support Provider Interface</a> - SSPI is a proprietary variant of GSSAPI with extensions and very Windows-specific data types -
<br />&nbsp;<br /></li>
<li><strong>Kerberos Authentication</strong> <br />
Authentication using the <a href="https://en.wikipedia.org/wiki/Kerberos_(protocol)">Kerberos protocol</a>
<br />&nbsp;<br /></li>
<li><strong>Ident Authentication</strong> <br />
Authentication using the <a href="https://en.wikipedia.org/wiki/Ident_protocol">ident protocol</a>
<br />&nbsp;<br /></li>
<li><strong>Peer Authentication</strong> <br />
Authentication using the <a href="https://www.freebsd.org/cgi/man.cgi?query=getpeereid">getpeereid()</a> kernel function, only supported for local connection on BSD, MacOS and GNU/Linux.
<br />&nbsp;<br /></li>
<li><strong>LDAP Authentication</strong> <br />
<a href="https://en.wikipedia.org/wiki/Lightweight_Directory_Access_Protocol">LDAP</a> authentication.</a>
<br />&nbsp;<br /></li>
<li><strong>RADIUS Authentication</strong> <br />
<a href="https://en.wikipedia.org/wiki/RADIUS">Radius</a> authentication.
<br />&nbsp;<br /></li>
<li><strong>Certificate Authentication</strong> <br />
Authentication with a <a href="https://en.wikipedia.org/wiki/Public_key_infrastructure">PKI certificate</a>.
<br />&nbsp;<br /></li>
<li><strong>PAM Authentication</strong> <br />
<a href="https://en.wikipedia.org/wiki/Pluggable_authentication_module">PAM</a> based authentication</a>
<br />&nbsp;<br />
<br />&nbsp;<br />
I wanted to use password authentication over ssl with a client certificate.
The bacula documents isn&rsquo;t very clear on howto configure it. After a quick lot at the bacula source code it should be supported, so let&rsquo;s give it a try&hellip;</li>
</ul>


<h3>Configure the PostgreSQL jail</h3>

<h4>Allow network connections</h4>

<p>Logon the postgreSQL server jail move to the postgreSQL data directory and edit postgresql.conf to allow TCP/IP connections.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@stafdb:/var/db/postgres/data96 # pwd
</span><span class='line'>/var/db/postgres/data96
</span><span class='line'>root@stafdb:/var/db/postgres/data96 # vim postgresql.conf</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># - Connection Settings -
</span><span class='line'>
</span><span class='line'>listen_addresses = '192.168.1.51'               # what IP address(es) to listen on;
</span><span class='line'># listen_addresses = 'localhost'                # what IP address(es) to listen on;
</span><span class='line'>                                        # comma-separated list of addresses;
</span><span class='line'>                                        # defaults to 'localhost'; use '*' for all
</span><span class='line'>                                        # (change requires restart)
</span><span class='line'>#port = 5432                            # (change requires restart)
</span></code></pre></td></tr></table></div></figure>


<h4>SSL encryption</h4>

<p>It&rsquo;s always a good idea to encrypt your connections.</p>

<h5>SSL Server setup</h5>

<h6>Umask</h6>

<p>set the umask to prevent somebody can read you private key.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@stafdb:/var/db/postgres/data96 # su - postgres
</span><span class='line'>$ umask 077 
</span><span class='line'>$ </span></code></pre></td></tr></table></div></figure>


<h6>Create a private key</h6>

<p>Create a private key without encrypting it.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>openssl genrsa -out server.key 4096
</span><span class='line'>Generating RSA private key, 4096 bit long modulus
</span><span class='line'>........................................................................................................................................................................................................................++
</span><span class='line'>......++
</span><span class='line'>e is 65537 (0x10001)
</span><span class='line'>$ </span></code></pre></td></tr></table></div></figure>


<h6>Create a self-signed certificate</h6>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ openssl req -new -key server.key -days 3650 -out server.crt -x509 -subj '/C=BE/ST=Flanders/L=Antwerp/O=stafnet/CN=stafdb'
</span><span class='line'>$ ls -ltr                                                                                               total 23
</span><span class='line'>-rw-------   1 postgres  postgres  3247 Sep  9 11:47 server.key
</span><span class='line'>-rw-------   1 postgres  postgres  1964 Sep  9 11:52 server.crt
</span><span class='line'>$ </span></code></pre></td></tr></table></div></figure>


<h6>Root ca</h6>

<p>We created a self signed certificate so the server certificate is our trusted ca root.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ ln -s server.crt root.crt
</span><span class='line'>$ ls -ltr
</span><span class='line'>total 24
</span><span class='line'>-rw-------   1 postgres  postgres  3247 Sep  9 11:47 server.key
</span><span class='line'>-rw-------   1 postgres  postgres  1964 Sep  9 11:52 server.crt
</span><span class='line'>lrwx------   1 postgres  postgres    10 Sep  9 11:53 root.crt -&gt; server.crt
</span><span class='line'>$ </span></code></pre></td></tr></table></div></figure>


<h6>Enable ssl</h6>

<p>Edit postgresql.conf and  update the ssl setting</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ vi postgresql.conf
</span></code></pre></td></tr></table></div></figure>


<p>By default ssl_ca_file is not set but this directive is required so don&rsquo;t forget to set it.
We disable the 3DES ciphers they&rsquo;re obsolete&hellip; We don&rsquo;t speficy a crl for now.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#authentication_timeout = 1min          # 1s-600s
</span><span class='line'>ssl = on                                # (change requires restart)
</span><span class='line'>ssl_ciphers = 'HIGH:MEDIUM:!3DES:!aNULL' # allowed SSL ciphers
</span><span class='line'>                                        # (change requires restart)
</span><span class='line'>ssl_prefer_server_ciphers = on          # (change requires restart)
</span><span class='line'>#ssl_ecdh_curve = 'prime256v1'          # (change requires restart)
</span><span class='line'>ssl_cert_file = 'server.crt'            # (change requires restart)
</span><span class='line'>ssl_key_file = 'server.key'             # (change requires restart)
</span><span class='line'>ssl_ca_file = 'root.crt'                        # (change requires restart)
</span><span class='line'>#ssl_crl_file = ''                      # (change requires restart)
</span><span class='line'>#password_encryption = on</span></code></pre></td></tr></table></div></figure>


<h5>SSL Client setup</h5>

<h6>Become bacula</h6>

<p>Logon to the bacula jail and become the bacula user. We use &ldquo;su -m &hellip;&rdquo; to logon to the locked daemon account, this will take over the root environment.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@rataplan:~ # ezjail-admin console stafbacula
</span><span class='line'>Last login: Wed Sep  9 09:33:16 on pts/0
</span><span class='line'>FreeBSD 11.1-RELEASE-p1 (GENERIC) #0: Wed Sep  9 11:55:48 UTC 2017
</span><span class='line'>
</span><span class='line'>Welcome to FreeBSD!
</span><span class='line'>
</span><span class='line'>Release Notes, Errata: https://www.FreeBSD.org/releases/
</span><span class='line'>Security Advisories:   https://www.FreeBSD.org/security/
</span><span class='line'>FreeBSD Handbook:      https://www.FreeBSD.org/handbook/
</span><span class='line'>FreeBSD FAQ:           https://www.FreeBSD.org/faq/
</span><span class='line'>Questions List: https://lists.FreeBSD.org/mailman/listinfo/freebsd-questions/
</span><span class='line'>FreeBSD Forums:        https://forums.FreeBSD.org/
</span><span class='line'>
</span><span class='line'>Documents installed with the system are in the /usr/local/share/doc/freebsd/
</span><span class='line'>directory, or can be installed later with:  pkg install en-freebsd-doc
</span><span class='line'>For other languages, replace "en" with a language code like de or fr.
</span><span class='line'>
</span><span class='line'>Show the version of FreeBSD installed:  freebsd-version ; uname -a
</span><span class='line'>Please include that output and any error messages when posting questions.
</span><span class='line'>Introduction to manual pages:  man man
</span><span class='line'>FreeBSD directory layout:      man hier
</span><span class='line'>
</span><span class='line'>Edit /etc/motd to change this login announcement.
</span><span class='line'>You have new mail.
</span><span class='line'>root@stafbacula:~ # su -m bacula -c "/bin/sh"
</span><span class='line'>$ id
</span><span class='line'>uid=910(bacula) gid=910(bacula) groups=910(bacula)
</span><span class='line'>$ </span></code></pre></td></tr></table></div></figure>


<h6>umask</h6>

<p>Set the umask to prevent somebody can read you private key.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ umask 077
</span><span class='line'>$ </span></code></pre></td></tr></table></div></figure>


<h6>move to the bacula home directory</h6>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ cat /etc/passwd | grep bacula
</span><span class='line'>bacula:*:910:910:Bacula Daemon:/var/db/bacula:/usr/sbin/nologin
</span><span class='line'>$ cd /var/db/bacula</span></code></pre></td></tr></table></div></figure>


<h6>create the .postges directory</h6>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ mkdir .postgres
</span><span class='line'>$ ls -la
</span><span class='line'>total 12
</span><span class='line'>drwxrwx---   3 bacula  bacula   3 Sep  9 09:41 .
</span><span class='line'>drwxr-xr-x  14 root    wheel   18 Sep  9 14:41 ..
</span><span class='line'>drwx------   2 bacula  bacula   2 Sep  9 09:41 .postgres
</span><span class='line'>$ cd .postgres/
</span><span class='line'>$ </span></code></pre></td></tr></table></div></figure>


<h6>Create a private key</h6>

<p>We took over the root evironment therefor we need to set the RANDFILE variable to randfile in the bacula home directory.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ pwd
</span><span class='line'>/var/db/bacula/.postgres
</span><span class='line'>$ export RANDFILE=/var/db/bacula/.rnd
</span><span class='line'>$ </span></code></pre></td></tr></table></div></figure>


<p>Create the private key.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ openssl genrsa -out `hostname`.key 4096
</span><span class='line'>Generating RSA private key, 4096 bit long modulus
</span><span class='line'>..........++
</span><span class='line'>.......................................................++
</span><span class='line'>e is 65537 (0x10001)
</span><span class='line'>$ </span></code></pre></td></tr></table></div></figure>


<h6>Create the client csr</h6>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ openssl req -new -key stafbacula.key -out stafbacula.csr -subj '/C=BE/ST=Flanders/L=Antwerp/O=stafnet/CN=stafbacula'
</span><span class='line'>$ </span></code></pre></td></tr></table></div></figure>


<h6>Create the client certifocate</h6>

<p>Logon to the postgreSQL jail as postgres and sign the client csr.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[postgres@stafdb ~/data96]$ openssl x509 -req -in stafbacula.csr -CAcreateserial -CA root.crt -CAkey server.key -out stafbacula.crt 
</span><span class='line'>Signature ok
</span><span class='line'>subject=/C=BE/ST=Flanders/L=Antwerp/O=stafnet/CN=stafbacula
</span><span class='line'>Getting CA Private Key
</span><span class='line'>[postgres@stafdb ~/data96]$ 
</span></code></pre></td></tr></table></div></figure>


<h5>Copy the client certificate and the trusted root certificate to bacula jail</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ uname -a
</span><span class='line'>FreeBSD stafbacula 11.1-RELEASE-p1 FreeBSD 11.1-RELEASE-p1 #0: Wed Sep  9 11:55:48 UTC 2017     root@amd64-builder.daemonology.net:/usr/obj/usr/src/sys/GENERIC  amd64
</span><span class='line'>$ pwd
</span><span class='line'>/var/db/bacula/.postgres
</span><span class='line'>$ ls -ltr
</span><span class='line'>total 24
</span><span class='line'>-rw-------  1 bacula  bacula  3243 Sep  9 09:47 stafbacula.key
</span><span class='line'>-rw-------  1 bacula  bacula  1679 Sep  9 09:54 stafbacula.csr
</span><span class='line'>-rw-------  1 bacula  bacula  1964 Sep  9 10:04 root.crt
</span><span class='line'>-rw-------  1 bacula  bacula  1850 Sep  9 10:06 stafbacula.crt
</span><span class='line'>$ </span></code></pre></td></tr></table></div></figure>


<h4>Host file on the bacula jail</h4>

<p>The hostname of the posgresql jail has to match with the CN of the server certificate. So we&rsquo;ll add the hostname to /etc/hosts</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@stafbacula:~ # vi /etc/hosts</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>192.168.1.51    stafdb</span></code></pre></td></tr></table></div></figure>


<h2>Setup the bacula database</h2>

<h4>Create the bacula database user</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[postgres@stafdb ~/data96]$ id
</span><span class='line'>uid=770(postgres) gid=770(postgres) groups=770(postgres)
</span><span class='line'>[postgres@stafdb ~/data96]$ psql postgres
</span><span class='line'>psql (9.6.3)
</span><span class='line'>Type "help" for help.
</span><span class='line'>
</span><span class='line'>postgres=# create user bacula WITH PASSWORD 'xxxxxx';
</span><span class='line'>CREATE ROLE
</span><span class='line'>postgres=# </span></code></pre></td></tr></table></div></figure>


<p>To update the user password;</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>postgres=# alter user bacula PASSWORD 'yyyyyyy';
</span><span class='line'>ALTER ROLE
</span><span class='line'>postgres=# </span></code></pre></td></tr></table></div></figure>


<p>You can view the new permissions in the pg_user table or by execute the \du (describe user shortcut), by default the user has minimal permissions.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>postgres=# select * from pg_user where usename = 'bacula';
</span><span class='line'> usename | usesysid | usecreatedb | usesuper | userepl | usebypassrls |  passwd  | valuntil | useconfig 
</span><span class='line'>---------+----------+-------------+----------+---------+--------------+----------+----------+-----------
</span><span class='line'> bacula  |    16386 | f           | f        | f       | f            | ******** |          | 
</span><span class='line'>(1 row)
</span><span class='line'>
</span><span class='line'>postgres=# 
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>postgres=# \du
</span><span class='line'>                                   List of roles
</span><span class='line'> Role name |                         Attributes                         | Member of 
</span><span class='line'>-----------+------------------------------------------------------------+-----------
</span><span class='line'> bacula    |                                                            | {}
</span><span class='line'> postgres  | Superuser, Create role, Create DB, Replication, Bypass RLS | {}
</span><span class='line'>
</span><span class='line'>postgres=# </span></code></pre></td></tr></table></div></figure>


<h3>Allow the bacula user to create databases</h3>

<p>The bacula database script will try to create the bacula catalog database.
We&rsquo;ll allow the bacula user to create databases,</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>postgres=# alter user bacula CREATEDB;
</span><span class='line'>ALTER ROLE
</span><span class='line'>postgres=# select * from pg_user where usename = 'bacula';
</span><span class='line'> usename | usesysid | usecreatedb | usesuper | userepl | usebypassrls |  passwd  | valuntil | useconfig 
</span><span class='line'>---------+----------+-------------+----------+---------+--------------+----------+----------+-----------
</span><span class='line'> bacula  |    16386 | t           | f        | f       | f            | ******** |          | 
</span><span class='line'>(1 row)
</span><span class='line'>
</span><span class='line'>postgres=# \du
</span><span class='line'>                                   List of roles
</span><span class='line'> Role name |                         Attributes                         | Member of 
</span><span class='line'>-----------+------------------------------------------------------------+-----------
</span><span class='line'> bacula    | Create DB                                                  | {}
</span><span class='line'> postgres  | Superuser, Create role, Create DB, Replication, Bypass RLS | {}
</span><span class='line'>
</span><span class='line'>postgres=# </span></code></pre></td></tr></table></div></figure>


<h3>Create the bacula database</h3>

<p>We&rsquo;ll create a bacula database so we can verify the database connection from the bacula user to the bacula database.</p>

<p>Create a new bacula database</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>postgres=# create database bacula;
</span><span class='line'>CREATE DATABASE
</span><span class='line'>postgres=# </span></code></pre></td></tr></table></div></figure>


<p>Grant all permissions to the bacula user</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>postgres=# grant ALL on DATABASE bacula to bacula;
</span><span class='line'>GRANT
</span><span class='line'>postgres=# </span></code></pre></td></tr></table></div></figure>


<h2>Update pg_hba</h2>

<p>The pg_hba.conf configuration controls the <strong>H</strong>ost <strong>B</strong>ased <strong>A</strong>ccess to your postgreSQL database(s).</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[postgres@stafdb ~/data96]$ pwd
</span><span class='line'>/var/db/postgres/data96
</span><span class='line'>[postgres@stafdb ~/data96]$ id
</span><span class='line'>uid=770(postgres) gid=770(postgres) groups=770(postgres)
</span><span class='line'>[postgres@stafdb ~/data96]$ vi pg_hba.conf </span></code></pre></td></tr></table></div></figure>


<p>And add the next lines;</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># TYPE  DATABASE        USER            ADDRESS                 METHOD
</span><span class='line'>hostssl bacula          bacula          192.168.1.52/32         md5 clientcert=1
</span><span class='line'>hostssl template0       bacula          192.168.1.52/32         md5 clientcert=1
</span><span class='line'>hostssl template1       bacula          192.168.1.52/32         md5 clientcert=1
</span><span class='line'>hostssl postgres        bacula          192.168.1.52/32         md5 clientcert=1</span></code></pre></td></tr></table></div></figure>


<p>Our bacula jail <strong><em>192.168.1.52</em></strong> only needs to have to the <strong><em>bacula</em></strong> database with the <strong><em>bacula</em></strong> user over ssl <strong><em>hostssl</em></strong> passwords will be send as a <strong><em>md5</em></strong> hash and a client certificate is required <strong><em>clientcert=1</em></strong>.</p>

<p>We could also used the <strong><em>cert</em></strong> method and <strong><em>map</em></strong> the client certificate to postgresql user so we could authenticate with the client certificate only&hellip;</p>

<p>We allow access to the template* and the postgres database because it&rsquo;s required for the bacula database xcreate script. We can remove them ( only allow access to the bacula database ) after the catalog database is created.</p>

<h2>Restart postgresql</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@stafdb:/var/db/postgres/data96 # service postgresql restart
</span><span class='line'>DEBUG:  postgres: PostmasterMain: initial environment dump:
</span><span class='line'>DEBUG:  -----------------------------------------
</span><span class='line'>DEBUG:          LC_TIME=C
</span><span class='line'>DEBUG:          LC_NUMERIC=C
</span><span class='line'>DEBUG:          LC_MONETARY=C
</span><span class='line'>DEBUG:          LC_MESSAGES=C
</span><span class='line'>DEBUG:          LC_CTYPE=C
</span><span class='line'>DEBUG:          LC_COLLATE=C
</span><span class='line'>DEBUG:          MAIL=/var/mail/postgres
</span><span class='line'>DEBUG:          PGLOCALEDIR=/usr/local/share/locale
</span><span class='line'>DEBUG:          PATH=/sbin:/bin:/usr/sbin:/usr/bin:/usr/local/sbin:/usr/local/bin:/var/db/postgres/bin
</span><span class='line'>DEBUG:          PGDATA=/var/db/postgres/data96
</span><span class='line'>DEBUG:          PWD=/var/db/postgres
</span><span class='line'>DEBUG:          PGSYSCONFDIR=/usr/local/etc/postgresql
</span><span class='line'>DEBUG:          HOME=/var/db/postgres
</span><span class='line'>DEBUG:          USER=postgres
</span><span class='line'>DEBUG:          SHELL=/bin/sh
</span><span class='line'>DEBUG:          PG_GRANDPARENT_PID=79045
</span><span class='line'>DEBUG:          BLOCKSIZE=K
</span><span class='line'>DEBUG:  -----------------------------------------
</span><span class='line'>LOG:  could not create IPv6 socket: Protocol not supported
</span><span class='line'>LOG:  could not bind IPv4 socket: Address already in use
</span><span class='line'>HINT:  Is another postmaster already running on port 5432? If not, wait a few seconds and retry.
</span><span class='line'>WARNING:  could not create listen socket for "192.168.1.51"
</span><span class='line'>DEBUG:  invoking IpcMemoryCreate(size=148480000)
</span><span class='line'>DEBUG:  SlruScanDirectory invoking callback on pg_notify/0000
</span><span class='line'>DEBUG:  removing file "pg_notify/0000"
</span><span class='line'>DEBUG:  dynamic shared memory system will support 288 segments
</span><span class='line'>DEBUG:  created dynamic shared memory control segment 773439544 (2316 bytes)
</span><span class='line'>DEBUG:  max_safe_fds = 984, usable_fds = 1000, already_open = 6
</span><span class='line'>LOG:  ending log output to stderr
</span><span class='line'>HINT:  Future log output will go to log destination "syslog".
</span><span class='line'>DEBUG:  CommitTransaction
</span><span class='line'>DEBUG:  name: unnamed; blockState:       STARTED; state: INPROGR, xid/subid/cid: 0/1/0, nestlvl: 1, children: 
</span><span class='line'>root@stafdb:/var/db/postgres/data96 #
</span></code></pre></td></tr></table></div></figure>


<h2>Test the database connection</h2>

<h3>Verify</h3>

<p>Verify the database connection for the bacula jail. See <a href="https://www.postgresql.org/docs/9.6/static/libpq-connect.html"><a href="https://www.postgresql.org/docs/9.6/static/libpq-connect.html">https://www.postgresql.org/docs/9.6/static/libpq-connect.html</a></a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[bacula@stafbacula /var/db/bacula/.postgres]$ psql "sslmode=verify-full host=stafdb dbname=bacula sslcert=`pwd`/postgresql.crt sslkey=`pwd`/postgresql.key sslrootcert=`pwd`/root.crt"
</span><span class='line'>Password:
</span><span class='line'>DEBUG:  CommitTransaction
</span><span class='line'>DEBUG:  name: unnamed; blockState:       STARTED; state: INPROGR, xid/subid/cid: 0/1/0, nestlvl: 1, children:
</span><span class='line'>psql (9.5.7, server 9.6.3)
</span><span class='line'>WARNING: psql major version 9.5, server major version 9.6.
</span><span class='line'>         Some psql features might not work.
</span><span class='line'>SSL connection (protocol: TLSv1.2, cipher: ECDHE-RSA-AES256-GCM-SHA384, bits: 256, compression: off)
</span><span class='line'>Type "help" for help.
</span><span class='line'>bacula=&gt;</span></code></pre></td></tr></table></div></figure>


<h3>Create environment script</h3>

<p>Bacula comes with a few scripts to popilate the catalog we will create an &ldquo;environment&rdquo; script to setup the required environment variabeles to connect to the database. <a href="https://www.postgresql.org/docs/9.6/static/libpq-envars.html"><a href="https://www.postgresql.org/docs/9.6/static/libpq-envars.html">https://www.postgresql.org/docs/9.6/static/libpq-envars.html</a></a> gives an overview of PostgreSQL environment variabeles.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[bacula@stafbacula /var/db/bacula]$ vi psql_env.sh</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>PGHOST=stafdb
</span><span class='line'>PGUSER=bacula
</span><span class='line'>PGSSLMODE=verify-full
</span><span class='line'>PGSSLCERT=/var/db/bacula/.postgres/postgresql.crt
</span><span class='line'>PGSSLKEY=/var/db/bacula/.postgres/postgresql.key
</span><span class='line'>PGSSLROOTCERT=/var/db/bacula/.postgres/root.crt
</span><span class='line'>
</span><span class='line'>export PGHOST
</span><span class='line'>export PGUSER
</span><span class='line'>export PGSSLMODE
</span><span class='line'>export PGSSLCERT
</span><span class='line'>export PGSSLKEY
</span><span class='line'>export PGSSLROOTCERT</span></code></pre></td></tr></table></div></figure>


<p>Test the environment script</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@stafbacula:~ # su -m bacula -c /bin/sh
</span><span class='line'>$ . /var/db/bacula/psql_env.sh
</span><span class='line'>$ psql bacula
</span><span class='line'>Password: 
</span><span class='line'>DEBUG:  CommitTransaction
</span><span class='line'>DEBUG:  name: unnamed; blockState:       STARTED; state: INPROGR, xid/subid/cid: 0/1/0, nestlvl: 1, children: 
</span><span class='line'>psql (9.5.8, server 9.6.4)
</span><span class='line'>WARNING: psql major version 9.5, server major version 9.6.
</span><span class='line'>         Some psql features might not work.
</span><span class='line'>SSL connection (protocol: TLSv1.2, cipher: ECDHE-RSA-AES256-GCM-SHA384, bits: 256, compression: off)
</span><span class='line'>Type "help" for help.
</span><span class='line'>
</span><span class='line'>bacula=&gt; </span></code></pre></td></tr></table></div></figure>


<h2>Configure the bacula catalog</h2>

<h3>Configuration directives</h3>

<p>I found the bacula documention not very clear howto setup the catalog connection with certificate authentication - or I looked at the wrong place - so I downloaded the bacula source code ( version 7.4.7 )to verify the required directives. ./src/dird/d/dird_conf.c</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[staf@vicky bacula-7.4.7]$ vim ./src/dird/dird_conf.c</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/*
</span><span class='line'>   Bacula(R) - The Network Backup Solution
</span><span class='line'>
</span><span class='line'>   Copyright (C) 2000-2016 Kern Sibbald
</span><span class='line'>
</span><span class='line'>   The original author of Bacula is Kern Sibbald, with contributions
</span><span class='line'>   from many others, a complete list can be found in the file AUTHORS.
</span><span class='line'>
</span><span class='line'>   You may use this file and others of this release according to the
</span><span class='line'>   license defined in the LICENSE file, which includes the Affero General
</span><span class='line'>   Public License, v3.0 ("AGPLv3") and some additional permissions and
</span><span class='line'>   terms pursuant to its AGPLv3 Section 7.
</span><span class='line'>
</span><span class='line'>   This notice must be preserved when any source code is
</span><span class='line'>   conveyed and/or propagated.
</span><span class='line'>
</span><span class='line'>   Bacula(R) is a registered trademark of Kern Sibbald.
</span><span class='line'>*/
</span><span class='line'>
</span><span class='line'>&lt;snip&gt;
</span><span class='line'>
</span><span class='line'>/*
</span><span class='line'> *    Catalog Resource Directives
</span><span class='line'> *
</span><span class='line'> *   name          handler     value                 code flags    default_value
</span><span class='line'> */
</span><span class='line'>static RES_ITEM cat_items[] = {
</span><span class='line'>   {"Name",     store_name,     ITEM(res_cat.hdr.name),    0, ITEM_REQUIRED, 0},
</span><span class='line'>   {"Description", store_str,   ITEM(res_cat.hdr.desc),    0, 0, 0},
</span><span class='line'>   {"dbaddress", store_str,     ITEM(res_cat.db_address),  0, 0, 0},
</span><span class='line'>   {"Address",  store_str,      ITEM(res_cat.db_address),  0, 0, 0},
</span><span class='line'>   {"DbPort",   store_pint32,   ITEM(res_cat.db_port),      0, 0, 0},
</span><span class='line'>   /* keep this password as store_str for the moment */
</span><span class='line'>   {"dbpassword", store_str,    ITEM(res_cat.db_password), 0, 0, 0},
</span><span class='line'>   {"Password", store_str,      ITEM(res_cat.db_password), 0, 0, 0},
</span><span class='line'>   {"dbuser",   store_str,      ITEM(res_cat.db_user),     0, 0, 0},
</span><span class='line'>   {"User",     store_str,      ITEM(res_cat.db_user),     0, 0, 0},
</span><span class='line'>   {"DbName",   store_str,      ITEM(res_cat.db_name),     0, ITEM_REQUIRED, 0},
</span><span class='line'>   {"dbdriver", store_str,      ITEM(res_cat.db_driver),   0, 0, 0},
</span><span class='line'>   {"DbSocket", store_str,      ITEM(res_cat.db_socket),   0, 0, 0},
</span><span class='line'>   {"dbsslkey", store_str,      ITEM(res_cat.db_ssl_key),  0, 0, 0},
</span><span class='line'>   {"dbsslcert", store_str,     ITEM(res_cat.db_ssl_cert),  0, 0, 0},
</span><span class='line'>   {"dbsslca", store_str,       ITEM(res_cat.db_ssl_ca),  0, 0, 0},
</span><span class='line'>   {"dbsslcapath", store_str,   ITEM(res_cat.db_ssl_capath),  0, 0, 0},
</span><span class='line'>   {"dbsslcipher", store_str,   ITEM(res_cat.db_ssl_cipher),  0, 0, 0},
</span><span class='line'>   /* Turned off for the moment */
</span><span class='line'>   {"MultipleConnections", store_bit, ITEM(res_cat.mult_db_connections), 0, 0, 0},
</span><span class='line'>   {"DisableBatchInsert", store_bool, ITEM(res_cat.disable_batch_insert), 0, ITEM_DEFAULT, false},
</span><span class='line'>   {NULL, NULL, {0}, 0, 0, 0}
</span><span class='line'>};
</span></code></pre></td></tr></table></div></figure>


<p>The ssl directives didn&rsquo;t seem to work with postgresql :-( If we feed the postgresql environment variables with the correct ssl settings to the bacula director it seems to work.</p>

<h2>Initialize the database</h2>

<h3>Drop the existing bacula database</h3>

<p>The bacacla create script will try to create a new bacaula database so we&rsquo;ll to drop or test database on our database server.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@stafdb:~ # su - postgres
</span><span class='line'>$ psql
</span><span class='line'>psql (9.6.4)
</span><span class='line'>Type "help" for help.
</span><span class='line'>
</span><span class='line'>postgres=# drop database bacula ;
</span><span class='line'>DROP DATABASE
</span><span class='line'>postgres=# \l
</span><span class='line'>                             List of databases
</span><span class='line'>   Name    |  Owner   | Encoding | Collate | Ctype |   Access privileges   
</span><span class='line'>-----------+----------+----------+---------+-------+-----------------------
</span><span class='line'> postgres  | postgres | UTF8     | C       | C     | 
</span><span class='line'> template0 | postgres | UTF8     | C       | C     | =c/postgres          +
</span><span class='line'>           |          |          |         |       | postgres=CTc/postgres
</span><span class='line'> template1 | postgres | UTF8     | C       | C     | =c/postgres          +
</span><span class='line'>           |          |          |         |       | postgres=CTc/postgres
</span><span class='line'>(3 rows)
</span><span class='line'>
</span><span class='line'>postgres=# </span></code></pre></td></tr></table></div></figure>


<h3>Create the database</h3>

<p>Logon the bacula jail and create the bacula database.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ . /var/db/bacula/psql_env.sh
</span><span class='line'>$ ./create_bacula_database
</span><span class='line'>Creating postgresql database
</span><span class='line'>Password: 
</span><span class='line'>Password: 
</span><span class='line'>CREATE DATABASE
</span><span class='line'>ALTER DATABASE
</span><span class='line'>Creation of bacula database succeeded.
</span><span class='line'>Password: 
</span><span class='line'>Password: 
</span><span class='line'>Database encoding OK</span></code></pre></td></tr></table></div></figure>


<h3>Populate the bacula tables</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ ./make_bacula_tables 
</span><span class='line'>Making postgresql tables
</span><span class='line'>Password: 
</span><span class='line'>CREATE TABLE
</span><span class='line'>ALTER TABLE
</span><span class='line'>CREATE INDEX
</span><span class='line'>CREATE TABLE
</span><span class='line'>ALTER TABLE
</span><span class='line'>CREATE INDEX
</span><span class='line'>CREATE TABLE
</span><span class='line'>CREATE INDEX
</span><span class='line'>CREATE INDEX
</span><span class='line'>CREATE TABLE
</span><span class='line'>CREATE INDEX
</span><span class='line'>CREATE TABLE
</span><span class='line'>CREATE INDEX
</span><span class='line'>CREATE TABLE
</span><span class='line'>CREATE INDEX
</span><span class='line'>CREATE TABLE
</span><span class='line'>CREATE TABLE
</span><span class='line'>CREATE INDEX
</span><span class='line'>CREATE TABLE
</span><span class='line'>CREATE INDEX
</span><span class='line'>CREATE TABLE
</span><span class='line'>CREATE INDEX
</span><span class='line'>CREATE INDEX
</span><span class='line'>CREATE INDEX
</span><span class='line'>CREATE TABLE
</span><span class='line'>CREATE TABLE
</span><span class='line'>CREATE TABLE
</span><span class='line'>CREATE TABLE
</span><span class='line'>CREATE INDEX
</span><span class='line'>CREATE TABLE
</span><span class='line'>CREATE INDEX
</span><span class='line'>CREATE TABLE
</span><span class='line'>CREATE INDEX
</span><span class='line'>CREATE TABLE
</span><span class='line'>CREATE TABLE
</span><span class='line'>CREATE TABLE
</span><span class='line'>CREATE INDEX
</span><span class='line'>CREATE TABLE
</span><span class='line'>CREATE TABLE
</span><span class='line'>CREATE TABLE
</span><span class='line'>CREATE INDEX
</span><span class='line'>CREATE TABLE
</span><span class='line'>CREATE INDEX
</span><span class='line'>CREATE TABLE
</span><span class='line'>CREATE TABLE
</span><span class='line'>INSERT 0 1
</span><span class='line'>INSERT 0 1
</span><span class='line'>INSERT 0 1
</span><span class='line'>INSERT 0 1
</span><span class='line'>INSERT 0 1
</span><span class='line'>INSERT 0 1
</span><span class='line'>INSERT 0 1
</span><span class='line'>INSERT 0 1
</span><span class='line'>INSERT 0 1
</span><span class='line'>INSERT 0 1
</span><span class='line'>INSERT 0 1
</span><span class='line'>INSERT 0 1
</span><span class='line'>INSERT 0 1
</span><span class='line'>INSERT 0 1
</span><span class='line'>INSERT 0 1
</span><span class='line'>INSERT 0 1
</span><span class='line'>INSERT 0 1
</span><span class='line'>INSERT 0 1
</span><span class='line'>INSERT 0 1
</span><span class='line'>INSERT 0 1
</span><span class='line'>INSERT 0 1
</span><span class='line'>INSERT 0 1
</span><span class='line'>CREATE TABLE
</span><span class='line'>CREATE INDEX
</span><span class='line'>INSERT 0 1
</span><span class='line'>Creation of Bacula PostgreSQL tables succeeded.
</span><span class='line'>$ </span></code></pre></td></tr></table></div></figure>


<h3>Verify</h3>

<p>Logon the bacula database and verify that the database populated.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ psql
</span><span class='line'>Password: 
</span><span class='line'>psql (9.5.8, server 9.6.4)
</span><span class='line'>WARNING: psql major version 9.5, server major version 9.6.
</span><span class='line'>         Some psql features might not work.
</span><span class='line'>SSL connection (protocol: TLSv1.2, cipher: ECDHE-RSA-AES256-GCM-SHA384, bits: 256, compression: off)
</span><span class='line'>Type "help" for help.
</span><span class='line'>
</span><span class='line'>bacula=&gt; \d
</span><span class='line'>                       List of relations
</span><span class='line'> Schema |               Name                |   Type   | Owner  
</span><span class='line'>--------+-----------------------------------+----------+--------
</span><span class='line'> public | basefiles                         | table    | bacula
</span><span class='line'> public | basefiles_baseid_seq              | sequence | bacula
</span><span class='line'> public | cdimages                          | table    | bacula
</span><span class='line'> public | client                            | table    | bacula
</span><span class='line'> public | client_clientid_seq               | sequence | bacula
</span><span class='line'> public | counters                          | table    | bacula
</span><span class='line'> public | device                            | table    | bacula
</span><span class='line'> public | device_deviceid_seq               | sequence | bacula
</span><span class='line'> public | file                              | table    | bacula
</span><span class='line'> public | file_fileid_seq                   | sequence | bacula
</span><span class='line'> public | filename                          | table    | bacula
</span><span class='line'> public | filename_filenameid_seq           | sequence | bacula
</span><span class='line'> public | fileset                           | table    | bacula
</span><span class='line'> public | fileset_filesetid_seq             | sequence | bacula
</span><span class='line'> public | job                               | table    | bacula
</span><span class='line'> public | job_jobid_seq                     | sequence | bacula
</span><span class='line'> public | jobhisto                          | table    | bacula
</span><span class='line'> public | jobmedia                          | table    | bacula
</span><span class='line'> public | jobmedia_jobmediaid_seq           | sequence | bacula
</span><span class='line'> public | location                          | table    | bacula
</span><span class='line'> public | location_locationid_seq           | sequence | bacula
</span><span class='line'> public | locationlog                       | table    | bacula
</span><span class='line'> public | locationlog_loclogid_seq          | sequence | bacula
</span><span class='line'> public | log                               | table    | bacula
</span><span class='line'> public | log_logid_seq                     | sequence | bacula
</span><span class='line'> public | media                             | table    | bacula
</span><span class='line'> public | media_mediaid_seq                 | sequence | bacula
</span><span class='line'> public | mediatype                         | table    | bacula
</span><span class='line'> public | mediatype_mediatypeid_seq         | sequence | bacula
</span><span class='line'> public | path                              | table    | bacula
</span><span class='line'> public | path_pathid_seq                   | sequence | bacula
</span><span class='line'> public | pathhierarchy                     | table    | bacula
</span><span class='line'> public | pathvisibility                    | table    | bacula
</span><span class='line'> public | pool                              | table    | bacula
</span><span class='line'> public | pool_poolid_seq                   | sequence | bacula
</span><span class='line'> public | restoreobject                     | table    | bacula
</span><span class='line'> public | restoreobject_restoreobjectid_seq | sequence | bacula
</span><span class='line'> public | snapshot                          | table    | bacula
</span><span class='line'> public | snapshot_snapshotid_seq           | sequence | bacula
</span><span class='line'>--More--(byte 2667)</span></code></pre></td></tr></table></div></figure>


<h3>Cleanup</h3>

<p>Disable the access to template? and postgres databases.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@stafdb:/var/db/postgres/data96 # vi pg_hba.conf</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>host    all             all             ::1/128                 trust
</span><span class='line'>hostssl bacula          bacula          192.168.1.52/32         md5 clientcert=1
</span><span class='line'># hostssl       template0       bacula          192.168.1.52/32         md5 clientcert=1
</span><span class='line'># hostssl       template1       bacula          192.168.1.52/32         md5 clientcert=1
</span><span class='line'># hostssl       postgres        bacula          192.168.1.52/32         md5 clientcert=1</span></code></pre></td></tr></table></div></figure>


<p>Reload</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@stafdb:/var/db/postgres/data96 # service postgresql reload
</span><span class='line'>root@stafdb:/var/db/postgres/data96 # </span></code></pre></td></tr></table></div></figure>


<p>Test it. Verify that access to the postgres database is denied from the bacula host.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ psql postgres
</span><span class='line'>psql: FATAL:  no pg_hba.conf entry for host "192.168.1.52", user "bacula", database "postgres", SSL on
</span><span class='line'>$ </span></code></pre></td></tr></table></div></figure>


<h2>Bacula catalog configuration</h2>

<h3>Update the bacula director configuration</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@stafbacula:/usr/local/etc/bacula # vi bacula-dir.conf</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># Generic catalog service
</span><span class='line'>Catalog { 
</span><span class='line'>  Name = MyCatalog
</span><span class='line'>  dbname = "bacula"; dbuser = "bacula"; dbpassword = "********" ; dbsslkey = "/var/db/bacula/.postgres
</span><span class='line'>/postgresql.key"; dbsslcert = "/var/db/bacula/.postgres/postgresql.crt"; dbsslca= "/var/db/bacula/.postgres
</span><span class='line'>/root.crt"
</span><span class='line'>
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h3>Test the catalog connection</h3>

<p>bacula include a program to verify the bacula catalog &ldquo;dbcheck&rdquo;, the -c switch select the bacula director configuration file the -B switch print out the configuration.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>bacula@stafbacula /usr/local]$ dbcheck -c /usr/local/etc/bacula/bacula-dir.conf -B -v
</span><span class='line'>catalog=MyCatalog
</span><span class='line'>db_name=bacula
</span><span class='line'>db_driver=
</span><span class='line'>db_user=bacula
</span><span class='line'>db_password=*******
</span><span class='line'>db_address=stafdb
</span><span class='line'>db_port=0
</span><span class='line'>db_socket=
</span><span class='line'>db_type=PostgreSQL
</span><span class='line'>working_dir=/var/db/bacula
</span><span class='line'>[bacula@stafbacula /usr/local]$ 
</span></code></pre></td></tr></table></div></figure>


<p>For some reason the ssl directives aren&rsquo;t include and the connection fails</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[bacula@stafbacula /usr/local/etc/rc.d]$ dbcheck -c /usr/local/etc/bacula/bacula-dir.conf -v
</span><span class='line'>dbcheck: Fatal Error at dbcheck.c:303 because:
</span><span class='line'>postgresql.c:271 Unable to connect to PostgreSQL server. Database=bacula User=bacula
</span><span class='line'>Possible causes: SQL server not running; password incorrect; max_connections exceeded.
</span><span class='line'>09-Sep 14:22 dbcheck: Fatal Error at dbcheck.c:303 because:
</span><span class='line'>postgresql.c:271 Unable to connect to PostgreSQL server. Database=bacula User=bacula
</span><span class='line'>Possible causes: SQL server not running; password incorrect; max_connections exceeded.
</span><span class='line'>[bacula@stafbacula /usr/local/etc/rc.d]$ 
</span></code></pre></td></tr></table></div></figure>


<p>On our postgres host we get the error message that the bacula host tries to connect without SSL.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>oot@stafdb:/var/db/postgres/data96 # tail -f /var/log/messages
</span><span class='line'>Sep  9 14:22:10 stafdb postgres[14183]: [10-1] FATAL:  connection requires a valid client certificate
</span><span class='line'>Sep  9 14:22:10 stafdb postgres[14184]: [10-1] FATAL:  no pg_hba.conf entry for host "192.168.1.52", user "bacula", database "bacula", SSL off
</span><span class='line'>Sep  9 14:22:15 stafdb postgres[14185]: [10-1] FATAL:  connection requires a valid client certificate
</span><span class='line'>Sep  9 14:22:15 stafdb postgres[14186]: [10-1] FATAL:  no pg_hba.conf entry for host "192.168.1.52", user "bacula", database "bacula", SSL off
</span><span class='line'>Sep  9 14:22:20 stafdb postgres[14187]: [10-1] FATAL:  connection requires a valid client certificate
</span><span class='line'>Sep  9 14:22:20 stafdb postgres[14188]: [10-1] FATAL:  no pg_hba.conf entry for host "192.168.1.52", user "bacula", database "bacula", SSL off
</span><span class='line'>Sep  9 14:22:25 stafdb postgres[14190]: [10-1] FATAL:  connection requires a valid client certificate
</span><span class='line'>Sep  9 14:22:25 stafdb postgres[14191]: [10-1] FATAL:  no pg_hba.conf entry for host "192.168.1.52", user "bacula", database "bacula", SSL off
</span><span class='line'>Sep  9 14:22:30 stafdb postgres[14193]: [10-1] FATAL:  connection requires a valid client certificate
</span><span class='line'>Sep  9 14:22:30 stafdb postgres[14194]: [10-1] FATAL:  no pg_hba.conf entry for host "192.168.1.52", user "bacula", database "bacula", SSL off</span></code></pre></td></tr></table></div></figure>


<p>When set the postgresql varialables with the correct ssl settings the connnection works fine.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[bacula@stafbacula /usr/local/etc/rc.d]$ dbcheck -c /usr/local/etc/bacula/bacula-dir.conf -v
</span><span class='line'>Hello, this is the database check/correct program.
</span><span class='line'>Modify database is off. Verbose is on.
</span><span class='line'>Please select the function you want to perform.
</span><span class='line'>
</span><span class='line'>     1) Toggle modify database flag
</span><span class='line'>     2) Toggle verbose flag
</span><span class='line'>     3) Check for bad Filename records
</span><span class='line'>     4) Check for bad Path records
</span><span class='line'>     5) Check for duplicate Filename records
</span><span class='line'>     6) Check for duplicate Path records
</span><span class='line'>     7) Check for orphaned Jobmedia records
</span><span class='line'>     8) Check for orphaned File records
</span><span class='line'>     9) Check for orphaned Path records
</span><span class='line'>    10) Check for orphaned Filename records
</span><span class='line'>    11) Check for orphaned FileSet records
</span><span class='line'>    12) Check for orphaned Client records
</span><span class='line'>    13) Check for orphaned Job records
</span><span class='line'>    14) Check for all Admin records
</span><span class='line'>    15) Check for all Restore records
</span><span class='line'>    16) All (3-15)
</span><span class='line'>    17) Quit
</span><span class='line'>Select function number: 
</span></code></pre></td></tr></table></div></figure>


<h2>Bacula director</h2>

<h3>Enable the  bacula director</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@stafbacula:/usr/local/etc/rc.d # sysrc bacula_dir_enable=yes
</span><span class='line'>bacula_dir_enable:  -&gt; yes
</span><span class='line'>root@stafbacula:/usr/local/etc/rc.d # 
</span></code></pre></td></tr></table></div></figure>


<h4>Create the bacula.log</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@stafbacula:/var/log # touch /var/log/bacula.log
</span><span class='line'>root@stafbacula:/var/log # chown bacula:bacula /var/log/bacula.log</span></code></pre></td></tr></table></div></figure>


<h4>Include the postgreSQL ssl settings in the bacula director startup script</h4>

<p>Update the bacula-dir startup sript to include the ssl settings.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># Add the following lines to /etc/rc.conf.local or /etc/rc.conf
</span><span class='line'># to enable this service:
</span><span class='line'>#
</span><span class='line'># bacula_dir_enable  (bool):   Set to NO by default.
</span><span class='line'>#                Set it to YES to enable bacula_dir.
</span><span class='line'># bacula_dir_flags (params):   Set params used to start bacula_dir.
</span><span class='line'>#
</span><span class='line'>
</span><span class='line'>. /etc/rc.subr
</span><span class='line'>. /var/db/bacula/psql_env.sh
</span></code></pre></td></tr></table></div></figure>


<h3>bconsole access</h3>

<p>To test that the catalog works correctly with the director we need to setup bconsole access.
Open the bacula director configuration file.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@stafbacula /usr/local/etc/bacula]# vim bacula-dir.conf</span></code></pre></td></tr></table></div></figure>


<p>And defined and Password</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Director {                            # define myself
</span><span class='line'>  Name = MyBaculaDirector
</span><span class='line'>  DIRport = 9101                # where we listen for UA connections
</span><span class='line'>  QueryFile = "/usr/local/share/bacula/query.sql"
</span><span class='line'>  WorkingDirectory = "/var/db/bacula"
</span><span class='line'>  PidDirectory = "/var/run"
</span><span class='line'>  Maximum Concurrent Jobs = 20
</span><span class='line'>  Password = "*******"         # Console password
</span><span class='line'>  Messages = Daemon
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>Open the bconsole configuration file</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@stafbacula /usr/local/etc/bacula]# vi bconsole.conf</span></code></pre></td></tr></table></div></figure>


<p>and setup the same password</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># Bacula User Agent (or Console) Configuration File
</span><span class='line'>#
</span><span class='line'># Copyright (C) 2000-2015 Kern Sibbald
</span><span class='line'># License: BSD 2-Clause; see file LICENSE-FOSS
</span><span class='line'>#
</span><span class='line'>
</span><span class='line'>Director {
</span><span class='line'>  Name = MyBaculaDirector
</span><span class='line'>  DIRport = 9101
</span><span class='line'>  address = localhost
</span><span class='line'>  Password = "*****"
</span><span class='line'>}
</span></code></pre></td></tr></table></div></figure>


<h3>Start the director &amp; test</h3>

<p>Start the bacula-dir service</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@stafbacula /usr/local/etc/bacula]# service bacula-dir start
</span><span class='line'>Starting bacula_dir.
</span><span class='line'>[root@stafbacula /usr/local/etc/bacula]# ps aux | grep -i bacula 
</span><span class='line'>bacula 14416  0.0  0.1 51424 6588  -  SsJ  14:40   0:00.12 /usr/local/sbin/bacula-dir -u bacula -g bacula 
</span><span class='line'>root   14420  0.0  0.0 14796 1968  0  R+J  14:40   0:00.00 grep -i bacula
</span><span class='line'>root   13530  0.0  0.0  8300 1596  2  I+J  13:47   0:00.00 tail -f /var/log/bacula.log
</span><span class='line'>[root@stafbacula /usr/local/etc/bacula]#
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>And test the console access</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>bacula@stafbacula:/usr/local/etc/bacula % bconsole
</span><span class='line'>Connecting to Director localhost:9101
</span><span class='line'>1000 OK: 102 MyBaculaDirector Version: 7.4.7 (16 March 2017)
</span><span class='line'>Enter a period to cancel a command.
</span><span class='line'>*version
</span><span class='line'>MyBaculaDirector Version: 7.4.7 (16 March 2017) amd64-portbld-freebsd11.0 freebsd 11.0-RELEASE-p12 
</span><span class='line'>You have messages.
</span><span class='line'>*</span></code></pre></td></tr></table></div></figure>


<p>In a next blog post we&rsquo;ll continue with the bacula configuration.</p>

<p style="font-style: italic;">
Have fun!
</p>


<h1>Links</h1>

<ul>
<li>bacula manual: <a href="http://www.bacula.org/9.0.x-manuals/en/main/"><a href="http://www.bacula.org/9.0.x-manuals/en/main/">http://www.bacula.org/9.0.x-manuals/en/main/</a></a></li>
<li><a href="https://dan.langille.org/2015/01/10/bacula-on-freebsd-with-zfs/"><a href="https://dan.langille.org/2015/01/10/bacula-on-freebsd-with-zfs/">https://dan.langille.org/2015/01/10/bacula-on-freebsd-with-zfs/</a></a></li>
</ul>

</div>
  
  

<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- blog_actrikel -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-4659298941528586"
     data-ad-slot="7394058542"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2017/08/06/bacula-on-freebsd:w_part1/">Bacula on FreeBSD (Part 1 PostgresSQL in a Jail)</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2017-08-06T08:43:28+02:00'><span class='date'><span class='date-month'>Aug</span> <span class='date-day'>6</span><span class='date-suffix'>th</span>, <span class='date-year'>2017</span></span> <span class='time'>8:43 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I do take backups; my current solution are couple of shell script wrapper around dump/zfs send/btrfs send/rsync which is a mess.
So decided give <a href="http://www.bacula.org/">bacula</a> a try</p>

<p>I use <a href="http://erdgeist.org/arts/software/ezjail/">ezjail</a> to manage my <a href="https://en.wikipedia.org/wiki/FreeBSD_jail">FreeBSD jails</a>. <a href="https://www.postgresql.org/">PostgresSQL</a> is my favorite database and will use this database as the backend for bacula  and will use this database as the backend for bacula. I want to move all my databases to 1 FreeBSD jail this should make the easier to create reliable database backup in the further. For this reason we&rsquo;ll setup 2 FreeBSD jails 1 for the database and 1 for bacula.</p>

<p>You&rsquo;ll find my journey of installing PostgreSQL on a FreeBSD jail. In another blog post we will continue with the installation of baccula.</p>

<h2>PostgreSQL</h2>

<h3>Jail</h3>

<h4>Create the PostgreSQL Jail</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@rataplan:~ # ezjail-admin create stafdb "em0|192.168.1.51"
</span><span class='line'>Warning: Some services already seem to be listening on all IP, (including 192.168.1.51)
</span><span class='line'>  This may cause some confusion, here they are:
</span><span class='line'>root     ntpd       754   20 udp6   *:123                 *:*
</span><span class='line'>root     ntpd       754   21 udp4   *:123                 *:*
</span><span class='line'>root     rpc.statd  717   4  udp6   *:640                 *:*
</span><span class='line'>root     rpc.statd  717   5  tcp6   *:640                 *:*
</span><span class='line'>root     rpc.statd  717   6  udp4   *:640                 *:*
</span><span class='line'>root     rpc.statd  717   7  tcp4   *:640                 *:*
</span><span class='line'>root     nfsd       713   5  tcp4   *:2049                *:*
</span><span class='line'>root     nfsd       713   6  tcp6   *:2049                *:*
</span><span class='line'>root     mountd     707   5  udp6   *:753                 *:*
</span><span class='line'>root     mountd     707   6  tcp6   *:753                 *:*
</span><span class='line'>root     mountd     707   7  udp4   *:753                 *:*
</span><span class='line'>root     mountd     707   8  tcp4   *:753                 *:*
</span><span class='line'>root     rpcbind    676   6  udp6   *:111                 *:*
</span><span class='line'>root     rpcbind    676   7  udp6   *:847                 *:*
</span><span class='line'>root     rpcbind    676   8  tcp6   *:111                 *:*
</span><span class='line'>root     rpcbind    676   9  udp4   *:111                 *:*
</span><span class='line'>root     rpcbind    676   10 udp4   *:766                 *:*
</span><span class='line'>root     rpcbind    676   11 tcp4   *:111                 *:*
</span><span class='line'>root     syslogd    657   6  udp6   *:514                 *:*
</span><span class='line'>root     syslogd    657   7  udp4   *:514                 *:*
</span><span class='line'>root@rataplan:~ # </span></code></pre></td></tr></table></div></figure>


<h4>PostgreSQL requires shared memory</h4>

<p>PostgreSQL uses shared memory it&rsquo;s required to set &ldquo;allow.sysvipc=1&rdquo; for the jail. I don&rsquo;t want to enable this globaly since this might be a security risk. Shared memory has permissions set based on the uid enabling sysvipc on a jail might cause the jail to read shared memory from the host system or another jail.</p>

<p>To enable &ldquo;allow.sysvipc=1&rdquo; a jail we can update the ezjail configuration. Ezjail keep the jail configuration in /usr/local/etc/ezjail</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@rataplan:~ # cd /usr/local/etc/ezjail
</span><span class='line'>root@rataplan:/usr/local/etc/ezjail # ls
</span><span class='line'>stafansible     staffs          stafproxy       staftestbuild
</span><span class='line'>stafdb          stafmail        stafpuppet
</span><span class='line'>root@rataplan:/usr/local/etc/ezjail # </span></code></pre></td></tr></table></div></figure>


<p>Open the database jail file and update the configuration.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@rataplan:/usr/local/etc/ezjail # vi stafdb</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#
</span><span class='line'># Required to run PostgeSQL in the jail
</span><span class='line'>#
</span><span class='line'>
</span><span class='line'>export jail_stafdb_parameters="allow.sysvipc=1"</span></code></pre></td></tr></table></div></figure>


<h4>Start the database jail</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@rataplan:~ # ezjail-admin start stafdb
</span><span class='line'>Starting jails: stafdb.
</span><span class='line'>/etc/rc.d/jail: WARNING: Per-jail configuration via jail_* variables  is obsolete.  Please consider migrating to /etc/jail.conf.
</span><span class='line'>root@rataplan:~ #</span></code></pre></td></tr></table></div></figure>


<h4>Console access</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@rataplan:~ # ezjail-admin console stafdb
</span><span class='line'>FreeBSD 11.0-RELEASE-p9 (GENERIC) #0: Tue Apr 11 08:48:40 UTC 2017
</span><span class='line'>
</span><span class='line'>Welcome to FreeBSD!
</span><span class='line'>
</span><span class='line'>Release Notes, Errata: https://www.FreeBSD.org/releases/
</span><span class='line'>Security Advisories:   https://www.FreeBSD.org/security/
</span><span class='line'>FreeBSD Handbook:      https://www.FreeBSD.org/handbook/
</span><span class='line'>FreeBSD FAQ:           https://www.FreeBSD.org/faq/
</span><span class='line'>Questions List: https://lists.FreeBSD.org/mailman/listinfo/freebsd-questions/
</span><span class='line'>FreeBSD Forums:        https://forums.FreeBSD.org/
</span><span class='line'>
</span><span class='line'>Documents installed with the system are in the /usr/local/share/doc/freebsd/
</span><span class='line'>directory, or can be installed later with:  pkg install en-freebsd-doc
</span><span class='line'>For other languages, replace "en" with a language code like de or fr.
</span><span class='line'>
</span><span class='line'>Show the version of FreeBSD installed:  freebsd-version ; uname -a
</span><span class='line'>Please include that output and any error messages when posting questions.
</span><span class='line'>Introduction to manual pages:  man man
</span><span class='line'>FreeBSD directory layout:      man hier
</span><span class='line'>
</span><span class='line'>Edit /etc/motd to change this login announcement.
</span><span class='line'>root@stafdb:~ # 
</span><span class='line'>root@stafdb:~ # </span></code></pre></td></tr></table></div></figure>


<h3>ProgreSQL installation</h3>

<h4>Install pkg</h4>

<p>Set up dns</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@stafdb:~ # vi /etc/resolv.conf</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nameserver 192.168.1.1</span></code></pre></td></tr></table></div></figure>


<p>Bootstrap pkg</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@stafdb:~ # pkg
</span><span class='line'>The package management tool is not yet installed on your system.
</span><span class='line'>Do you want to fetch and install it now? [y/N]: y
</span><span class='line'>Bootstrapping pkg from pkg+http://pkg.FreeBSD.org/FreeBSD:11:amd64/quarterly, please wait...
</span><span class='line'>Verifying signature with trusted certificate pkg.freebsd.org.2013102301... done
</span><span class='line'>[stafdb] Installing pkg-1.10.1...
</span><span class='line'>[stafdb] Extracting pkg-1.10.1: 100%
</span><span class='line'>pkg: not enough arguments
</span><span class='line'>Usage: pkg [-v] [-d] [-l] [-N] [-j &lt;jail name or id&gt;|-c &lt;chroot path&gt;|-r &lt;rootdir&gt;] [-C &lt;configuration file&gt;] [-R &lt;repo config dir&gt;] [-o var=value] [-4|-6] &lt;command&gt; [&lt;args&gt;]
</span><span class='line'>
</span><span class='line'>For more information on available commands and options see 'pkg help'.
</span><span class='line'>root@stafdb:~ # </span></code></pre></td></tr></table></div></figure>


<h4>Install PostgreSQL</h4>

<p>Search for the latest PostgreSQL server version.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@stafdb:~ # pkg search postgresql | grep server
</span><span class='line'>pgtcl-postgresql92-2.0.0_1     TCL extension for accessing a PostgreSQL server (PGTCL-NG)
</span><span class='line'>pgtcl-postgresql93-2.0.0_1     TCL extension for accessing a PostgreSQL server (PGTCL-NG)
</span><span class='line'>pgtcl-postgresql94-2.0.0_1     TCL extension for accessing a PostgreSQL server (PGTCL-NG)
</span><span class='line'>pgtcl-postgresql95-2.0.0_1     TCL extension for accessing a PostgreSQL server (PGTCL-NG)
</span><span class='line'>pgtcl-postgresql96-2.0.0_1     TCL extension for accessing a PostgreSQL server (PGTCL-NG)
</span><span class='line'>postgresql92-server-9.2.21_1   PostgreSQL is the most advanced open-source database available anywhere
</span><span class='line'>postgresql93-server-9.3.17_1   PostgreSQL is the most advanced open-source database available anywhere
</span><span class='line'>postgresql94-server-9.4.12_1   PostgreSQL is the most advanced open-source database available anywhere
</span><span class='line'>postgresql95-server-9.5.7_1    PostgreSQL is the most advanced open-source database available anywhere
</span><span class='line'>postgresql96-server-9.6.3_1    PostgreSQL is the most advanced open-source database available anywhere
</span><span class='line'>root@stafdb:~ # </span></code></pre></td></tr></table></div></figure>


<p>Install the PostgreSQL package.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@stafdb:~ # pkg install postgresql96-server
</span><span class='line'>Updating FreeBSD repository catalogue...
</span><span class='line'>FreeBSD repository is up to date.
</span><span class='line'>All repositories are up to date.
</span><span class='line'>The following 8 package(s) will be affected (of 0 checked):
</span><span class='line'>
</span><span class='line'>New packages to be INSTALLED:
</span><span class='line'>        postgresql96-server: 9.6.3_1
</span><span class='line'>        libxml2: 2.9.4
</span><span class='line'>        icu: 58.2_2,1
</span><span class='line'>        gettext-runtime: 0.19.8.1_1
</span><span class='line'>        indexinfo: 0.2.6
</span><span class='line'>        postgresql96-client: 9.6.3_2
</span><span class='line'>        perl5: 5.24.1_1
</span><span class='line'>        readline: 7.0.3
</span><span class='line'>
</span><span class='line'>Number of packages to be installed: 8
</span><span class='line'>
</span><span class='line'>The process will require 131 MiB more space.
</span><span class='line'>30 MiB to be downloaded.
</span><span class='line'>
</span><span class='line'>Proceed with this action? [y/N]: y
</span><span class='line'>[stafdb] [1/8] Fetching postgresql96-server-9.6.3_1.txz: 100%    4 MiB 357.1kB/s    00:11    
</span><span class='line'>[stafdb] [2/8] Fetching libxml2-2.9.4.txz: 100%  802 KiB 410.4kB/s    00:02    
</span><span class='line'>[stafdb] [3/8] Fetching icu-58.2_2,1.txz: 100%    9 MiB 313.3kB/s    00:30    
</span><span class='line'>[stafdb] [4/8] Fetching gettext-runtime-0.19.8.1_1.txz: 100%  147 KiB 151.0kB/s    00:01    
</span><span class='line'>[stafdb] [5/8] Fetching indexinfo-0.2.6.txz: 100%    5 KiB   5.3kB/s    00:01    
</span><span class='line'>[stafdb] [6/8] Fetching postgresql96-client-9.6.3_2.txz: 100%    2 MiB 300.0kB/s    00:08    
</span><span class='line'>[stafdb] [7/8] Fetching perl5-5.24.1_1.txz: 100%   13 MiB 341.5kB/s    00:41    
</span><span class='line'>[stafdb] [8/8] Fetching readline-7.0.3.txz: 100%  334 KiB 342.3kB/s    00:01    
</span><span class='line'>Checking integrity... done (0 conflicting)
</span><span class='line'>[stafdb] [1/8] Installing indexinfo-0.2.6...
</span><span class='line'>[stafdb] [1/8] Extracting indexinfo-0.2.6: 100%
</span><span class='line'>[stafdb] [2/8] Installing gettext-runtime-0.19.8.1_1...
</span><span class='line'>[stafdb] [2/8] Extracting gettext-runtime-0.19.8.1_1: 100%
</span><span class='line'>[stafdb] [3/8] Installing perl5-5.24.1_1...
</span><span class='line'>[stafdb] [3/8] Extracting perl5-5.24.1_1: 100%
</span><span class='line'>[stafdb] [4/8] Installing readline-7.0.3...
</span><span class='line'>[stafdb] [4/8] Extracting readline-7.0.3: 100%
</span><span class='line'>[stafdb] [5/8] Installing libxml2-2.9.4...
</span><span class='line'>[stafdb] [5/8] Extracting libxml2-2.9.4: 100%
</span><span class='line'>[stafdb] [6/8] Installing icu-58.2_2,1...
</span><span class='line'>[stafdb] [6/8] Extracting icu-58.2_2,1: 100%
</span><span class='line'>[stafdb] [7/8] Installing postgresql96-client-9.6.3_2...
</span><span class='line'>[stafdb] [7/8] Extracting postgresql96-client-9.6.3_2: 100%
</span><span class='line'>[stafdb] [8/8] Installing postgresql96-server-9.6.3_1...
</span><span class='line'>===&gt; Creating groups.
</span><span class='line'>Creating group 'postgres' with gid '770'.
</span><span class='line'>===&gt; Creating users
</span><span class='line'>Creating user 'postgres' with uid '770'.
</span><span class='line'>
</span><span class='line'>  =========== BACKUP YOUR DATA! =============
</span><span class='line'>  As always, backup your data before
</span><span class='line'>  upgrading. If the upgrade leads to a higher
</span><span class='line'>  minor revision (e.g. 8.3.x -&gt; 8.4), a dump
</span><span class='line'>  and restore of all databases is
</span><span class='line'>  required. This is *NOT* done by the port!
</span><span class='line'>  ===========================================
</span><span class='line'>[stafdb] Extracting postgresql96-server-9.6.3_1: 100%
</span><span class='line'>Message from perl5-5.24.1_1:
</span><span class='line'>The /usr/bin/perl symlink has been removed starting with Perl 5.20.
</span><span class='line'>For shebangs, you should either use:
</span><span class='line'>
</span><span class='line'>#!/usr/local/bin/perl
</span><span class='line'>
</span><span class='line'>or
</span><span class='line'>
</span><span class='line'>#!/usr/bin/env perl
</span><span class='line'>
</span><span class='line'>The first one will only work if you have a /usr/local/bin/perl,
</span><span class='line'>the second will work as long as perl is in PATH.
</span><span class='line'>Message from postgresql96-client-9.6.3_2:
</span><span class='line'>The PostgreSQL port has a collection of "side orders":
</span><span class='line'>
</span><span class='line'>postgresql-docs
</span><span class='line'>  For all of the html documentation
</span><span class='line'>
</span><span class='line'>p5-Pg
</span><span class='line'>  A perl5 API for client access to PostgreSQL databases.
</span><span class='line'>
</span><span class='line'>postgresql-tcltk 
</span><span class='line'>  If you want tcl/tk client support.
</span><span class='line'>
</span><span class='line'>postgresql-jdbc
</span><span class='line'>  For Java JDBC support.
</span><span class='line'>
</span><span class='line'>postgresql-odbc
</span><span class='line'>  For client access from unix applications using ODBC as access
</span><span class='line'>  method. Not needed to access unix PostgreSQL servers from Win32
</span><span class='line'>  using ODBC. See below.
</span><span class='line'>
</span><span class='line'>ruby-postgres, py-PyGreSQL
</span><span class='line'>  For client access to PostgreSQL databases using the ruby & python
</span><span class='line'>  languages.
</span><span class='line'>
</span><span class='line'>postgresql-plperl, postgresql-pltcl & postgresql-plruby
</span><span class='line'>  For using perl5, tcl & ruby as procedural languages.
</span><span class='line'>
</span><span class='line'>postgresql-contrib
</span><span class='line'>  Lots of contributed utilities, postgresql functions and
</span><span class='line'>  datatypes. There you find pg_standby, pgcrypto and many other cool
</span><span class='line'>  things.
</span><span class='line'>
</span><span class='line'>etc...
</span><span class='line'>Message from postgresql96-server-9.6.3_1:
</span><span class='line'>For procedural languages and postgresql functions, please note that
</span><span class='line'>you might have to update them when updating the server.
</span><span class='line'>
</span><span class='line'>If you have many tables and many clients running, consider raising
</span><span class='line'>kern.maxfiles using sysctl(8), or reconfigure your kernel
</span><span class='line'>appropriately.
</span><span class='line'>
</span><span class='line'>The port is set up to use autovacuum for new databases, but you might
</span><span class='line'>also want to vacuum and perhaps backup your database regularly. There
</span><span class='line'>is a periodic script, /usr/local/etc/periodic/daily/502.pgsql, that
</span><span class='line'>you may find useful. You can use it to backup and perform vacuum on all
</span><span class='line'>databases nightly. Per default, it performs `vacuum analyze'. See the
</span><span class='line'>script for instructions. For autovacuum settings, please review
</span><span class='line'>~pgsql/data/postgresql.conf.
</span><span class='line'>
</span><span class='line'>If you plan to access your PostgreSQL server using ODBC, please
</span><span class='line'>consider running the SQL script /usr/local/share/postgresql/odbc.sql
</span><span class='line'>to get the functions required for ODBC compliance.
</span><span class='line'>
</span><span class='line'>Please note that if you use the rc script,
</span><span class='line'>/usr/local/etc/rc.d/postgresql, to initialize the database, unicode
</span><span class='line'>(UTF-8) will be used to store character data by default.  Set
</span><span class='line'>postgresql_initdb_flags or use login.conf settings described below to
</span><span class='line'>alter this behaviour. See the start rc script for more info.
</span><span class='line'>
</span><span class='line'>To set limits, environment stuff like locale and collation and other
</span><span class='line'>things, you can set up a class in /etc/login.conf before initializing
</span><span class='line'>the database. Add something similar to this to /etc/login.conf:
</span><span class='line'>---
</span><span class='line'>postgres:\
</span><span class='line'>        :lang=en_US.UTF-8:\
</span><span class='line'>        :setenv=LC_COLLATE=C:\
</span><span class='line'>        :tc=default:
</span><span class='line'>---
</span><span class='line'>and run `cap_mkdb /etc/login.conf'.
</span><span class='line'>Then add 'postgresql_class="postgres"' to /etc/rc.conf.
</span><span class='line'>
</span><span class='line'>======================================================================
</span><span class='line'>
</span><span class='line'>To initialize the database, run
</span><span class='line'>
</span><span class='line'>  /usr/local/etc/rc.d/postgresql initdb
</span><span class='line'>
</span><span class='line'>You can then start PostgreSQL by running:
</span><span class='line'>
</span><span class='line'>  /usr/local/etc/rc.d/postgresql start
</span><span class='line'>
</span><span class='line'>For postmaster settings, see ~pgsql/data/postgresql.conf
</span><span class='line'>
</span><span class='line'>NB. FreeBSD's PostgreSQL port logs to syslog by default
</span><span class='line'>    See ~pgsql/data/postgresql.conf for more info
</span><span class='line'>
</span><span class='line'>======================================================================
</span><span class='line'>
</span><span class='line'>To run PostgreSQL at startup, add
</span><span class='line'>'postgresql_enable="YES"' to /etc/rc.conf</span></code></pre></td></tr></table></div></figure>


<p>Enable the postgresql daemon at the jail startup</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@stafdb:~ # sysrc postgresql_enable="YES"
</span><span class='line'>postgresql_enable:  -&gt; YES
</span><span class='line'>root@stafdb:~ # grep postgresql_enable /etc/rc.conf
</span><span class='line'>postgresql_enable="YES"
</span><span class='line'>root@stafdb:~ # </span></code></pre></td></tr></table></div></figure>


<p>Initialize the database</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@stafdb:~ # service postgresql initdb
</span><span class='line'>The files belonging to this database system will be owned by user "postgres".
</span><span class='line'>This user must also own the server process.
</span><span class='line'>
</span><span class='line'>The database cluster will be initialized with locale "C".
</span><span class='line'>The default text search configuration will be set to "english".
</span><span class='line'>
</span><span class='line'>Data page checksums are disabled.
</span><span class='line'>
</span><span class='line'>creating directory /var/db/postgres/data96 ... ok
</span><span class='line'>creating subdirectories ... ok
</span><span class='line'>selecting default max_connections ... 100
</span><span class='line'>selecting default shared_buffers ... 128MB
</span><span class='line'>selecting dynamic shared memory implementation ... posix
</span><span class='line'>creating configuration files ... ok
</span><span class='line'>running bootstrap script ... ok
</span><span class='line'>performing post-bootstrap initialization ... ok
</span><span class='line'>syncing data to disk ... ok
</span><span class='line'>
</span><span class='line'>WARNING: enabling "trust" authentication for local connections
</span><span class='line'>You can change this by editing pg_hba.conf or using the option -A, or
</span><span class='line'>--auth-local and --auth-host, the next time you run initdb.
</span><span class='line'>
</span><span class='line'>Success. You can now start the database server using:
</span><span class='line'>
</span><span class='line'>    /usr/local/bin/pg_ctl -D /var/db/postgres/data96 -l logfile start
</span><span class='line'>
</span><span class='line'>root@stafdb:~ # </span></code></pre></td></tr></table></div></figure>


<p>Start the database</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Droot@stafdb:~ # service postgresql start
</span><span class='line'>LOG:  could not create IPv6 socket: Protocol not supported
</span><span class='line'>LOG:  ending log output to stderr
</span><span class='line'>HINT:  Future log output will go to log destination "syslog".
</span><span class='line'>root@stafdb:~ # </span></code></pre></td></tr></table></div></figure>


<p>Verify the database</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@stafdb:~ # su - postgres                                                                                                   
</span><span class='line'>$ psql -l                                                                                                                       
</span><span class='line'>psql: could not connect to server: No such file or directory                                                                    
</span><span class='line'>        Is the server running locally and accepting                                                                             
</span><span class='line'>        connections on Unix domain socket "/tmp/.s.PGSQL.5432"?                                                                 
</span><span class='line'>$ ^Droot@stafdb:~ # service postgresql start
</span><span class='line'>LOG:  could not create IPv6 socket: Protocol not supported                                                                      
</span><span class='line'>LOG:  ending log output to stderr                                                                                               
</span><span class='line'>HINT:  Future log output will go to log destination "syslog".                                                                   
</span><span class='line'>root@stafdb:~ # su - postgres
</span><span class='line'>$ psql -l
</span><span class='line'>                             List of databases
</span><span class='line'>   Name    |  Owner   | Encoding | Collate | Ctype |   Access privileges   
</span><span class='line'>-----------+----------+----------+---------+-------+-----------------------
</span><span class='line'> postgres  | postgres | UTF8     | C       | C     | 
</span><span class='line'> template0 | postgres | UTF8     | C       | C     | =c/postgres          +
</span><span class='line'>           |          |          |         |       | postgres=CTc/postgres
</span><span class='line'> template1 | postgres | UTF8     | C       | C     | =c/postgres          +
</span><span class='line'>           |          |          |         |       | postgres=CTc/postgres
</span><span class='line'>(3 rows)
</span><span class='line'>
</span><span class='line'>$ </span></code></pre></td></tr></table></div></figure>




<p style="font-style: italic;">
Have fun!
</p>


<h1>Links</h1>

<ul>
<li><a href="https://dan.langille.org/2015/01/10/bacula-on-freebsd-with-zfs/">https://dan.langille.org/2015/01/10/bacula-on-freebsd-with-zfs/</a></li>
<li><a href="https://cwharton.com/blog/2016/10/postgresql-and-freebsd-quick-start/">https://cwharton.com/blog/2016/10/postgresql-and-freebsd-quick-start/</a></li>
<li><a href="https://dan.langille.org/2013/07/09/fatal-could-not-create-shared-memory-segment-function-not-implemented/">https://dan.langille.org/2013/07/09/fatal-could-not-create-shared-memory-segment-function-not-implemented/</a></li>
</ul>

</div>
  
  

<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- blog_actrikel -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-4659298941528586"
     data-ad-slot="7394058542"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/posts/2">&larr; Older</a>
    
    <a href="/blog/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>About Me</h1>
  <p><a href="http://www.wagemakers.be">http://www.wagemakers.be</a></p>
  <p><a href="http://www.linkedin.com/in/stafwagemakers">LinkedIn profile</a></p>
  <p><a href="https://google.com/+StafWagemakers">Google Plus profile</a></p>
<!-- Place this tag where you want the widget to render. -->
<div class="g-person" data-width="180" data-href="http://google.com/+StafWagemakers" data-showtagline="false" data-showcoverphoto="false" data-rel="author"></div>

<!-- Place this tag after the last widget tag. -->
<script type="text/javascript">
  (function() {
    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    po.src = 'https://apis.google.com/js/plusone.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  })();
</script>
</section>

<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/blog/2018/04/27/how-to-start-dlm-monitoring-on-a-vdsl-line-in-belgium/">How to Start DLM Monitoring on a VDSL Line in Belgium</a>
      </li>
    
      <li class="post">
        <a href="/blog/blog/2018/04/22/high-screen-resolution-on-a-kvm-virtual-machine-with-qxl/">High Screen Resolution on a KVM Virtual Machine With QXL</a>
      </li>
    
      <li class="post">
        <a href="/blog/blog/2018/03/04/postfix-smarthost-with-authentication/">Postfix Smarthost With Authentication</a>
      </li>
    
      <li class="post">
        <a href="/blog/blog/2018/02/10/update-your-cpu-microcodeon-arch-linux/">Update Your CPU Microcode on Arch Linux</a>
      </li>
    
      <li class="post">
        <a href="/blog/blog/2017/12/27/bacula-on-freebsd-part3/">Bacula on FreeBSD (Part 3 Storage Setup)</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/stafwag">@stafwag</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'stafwag',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/blog/javascripts/github.js" type="text/javascript"> </script>
</section>





<hr />
<br />
<br />
<br />
<br />
<script type="text/javascript"><!--
google_ad_client = "ca-pub-4659298941528586";
/* blogads_right */
google_ad_slot = "8839948148";
google_ad_width = 160;
google_ad_height = 600;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>

  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2018 - staf wagemakers -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'stafwag';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>

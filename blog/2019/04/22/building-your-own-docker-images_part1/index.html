
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Building Your Own Docker Base Images (Part 1: Debian GNU/Linux & Co) - stafwag Blog</title>
  <meta name="author" content="staf wagemakers">

  
  <meta name="description" content="Building Your Own Docker Base Images (Part 1: Debian GNU/Linux & Co) Apr 22nd, 2019 10:36 am I was using docker on an Odroid U3, but my Odroid &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="https://stafwag.github.io/blog/blog/2019/04/22/building-your-own-docker-images_part1/">
  <link href="/blog/favicon.png" rel="icon">
  <link href="/blog/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/blog/atom.xml" rel="alternate" title="stafwag Blog" type="application/atom+xml">
  <script src="/blog/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/blog/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-37258385-2']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/blog/">stafwag Blog</a></h1>
  
    <h2>staf wagemakers blog</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/blog/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="stafwag.github.io/blog">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/blog/">Blog</a></li>
  <li><a href="/blog/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Building Your Own Docker Base Images (Part 1: Debian GNU/Linux & Co)</h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2019-04-22T10:36:01+02:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>22</span><span class='date-suffix'>nd</span>, <span class='date-year'>2019</span></span> <span class='time'>10:36 am</span></time>
        
      </p>
    
  </header>


<div class="entry-content"><p>I was using <a href="https://stafwag.github.io/blog/blog/2015/12/26/running-docker-on-arm/">docker on an Odroid U3</a>, but my Odroid stopped working. I switched to another system that is i386 only.</p>

<p>You&rsquo;ll find my journey to build docker images for i386 below.</p>

<h1>Reasons to build your own docker images</h1>

<p>If you want to use <a href="https://www.docker.com/">docker</a> you can start with docker images on the <a href="https://hub.docker.com/">docker registry</a>.
There are several reasons to build your own base images.</p>

<ul>
<li><h2>Security</h2></li>
</ul>


<p>The first reason is security, docker images are not signed by default.</p>

<p>Anyone can upload docker images to the public docker hub with bugs or malicious code.</p>

<p>There are &ldquo;official&rdquo; docker images available at <a href="https://docs.docker.com/docker-hub/official_images/">https://docs.docker.com/docker-hub/official_images/</a> when you execute a <code>docker search</code>  the official docker images are tagged on the official column and are also signed by Docker. To only allow signed docker images you need to set the <code>DOCKER_CONTENT_TRUST=1</code> environment variable. - This should be the default IMHO -</p>

<p>There is one distinction, the &ldquo;official&rdquo; docker images are signed by the &ldquo;Repo admin&rdquo; of the Docker hub, not by the official GNU/Linux distribution project.
If you want to trust the official project instead of the Docker repo admin you can resolve this building your own images.</p>

<ul>
<li><h2>Support other architectures</h2></li>
</ul>


<p>Docker images are generally built for <a href="https://en.wikipedia.org/wiki/X86-64">AMD64 architecture</a>. If you want to use other architectures - <a href="https://en.wikipedia.org/wiki/ARM_architecture">ARM</a>, <a href="https://en.wikipedia.org/wiki/Power.org#Power_Architecture">Power</a>, <a href="https://en.wikipedia.org/wiki/SPARC">SPARC</a> or even <a href="https://en.wikipedia.org/wiki/Intel_80386">i386</a> - you&rsquo;ll find some images on the Docker hub but these are usually not Official docker images.</p>

<ul>
<li><h2>Control</h2></li>
</ul>


<p>When you build your own images, you have more control over what goes or not goes into the image.</p>

<h1>Building your own docker base images</h1>

<p>There are several ways to build your own docker images.</p>

<p>The <a href="https://mobyproject.org/">Mobyproject</a> is Docker&rsquo;s development project - a bit like what Fedora is to RedHat -.
The Moby project has a few scripts that help you to create docker base images and is also a good start if you want to review how to build your own images.</p>

<h1>GNU/Linux distributions</h1>

<p>I build the images on the same GNU/Linux distribution (e.g. The debian images are build on a Debian system) to get the correct gpg keys.</p>

<h2>Debian GNU/Linux &amp; Co</h2>

<p>Debian GNU/Linux makes it very easy to build your own Docker base images. Only debootstrap is required.
I&rsquo;ll use the moby script to the Debian base image and debootstrap to build an i386 docker Ubuntu 18.04 image.</p>

<p>Ubuntu doesn&rsquo;t support i386 officially but includes the i386 userland so it&rsquo;s possible to build i386 Docker images.</p>

<h3>Clone moby</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>staf@whale:~/github$ git clone https://github.com/moby/moby
</span><span class='line'>Cloning into 'moby'...
</span><span class='line'>remote: Enumerating objects: 265639, done.
</span><span class='line'>remote: Total 265639 (delta 0), reused 0 (delta 0), pack-reused 265640
</span><span class='line'>Receiving objects: 99% (265640/265640), 137.75 MiB | 3.05 MiB/s, done.
</span><span class='line'>Resolving deltas: 99% (179885/179885), done.
</span><span class='line'>Checking out files: 99% (5508/5508), done.
</span><span class='line'>staf@whale:~/github$ </span></code></pre></td></tr></table></div></figure>


<h3>Make sure that debootstrap is installed</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>staf@whale:~/github/moby/contrib$ sudo apt install debootstrap
</span><span class='line'>[sudo] password for staf: 
</span><span class='line'>Reading package lists... Done
</span><span class='line'>Building dependency tree       
</span><span class='line'>Reading state information... Done
</span><span class='line'>debootstrap is already the newest version (1.0.114).
</span><span class='line'>debootstrap set to manually installed.
</span><span class='line'>0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
</span><span class='line'>staf@whale:~/github/moby/contrib$ </span></code></pre></td></tr></table></div></figure>


<h3>The Moby way</h3>

<h4>Go to the contrib directory</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>staf@whale:~/github$ cd moby/contrib/
</span><span class='line'>staf@whale:~/github/moby/contrib$ </span></code></pre></td></tr></table></div></figure>


<h4>mkimage.sh</h4>

<p> <code>mkimage.sh --help</code> gives you more details howto use the script.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>staf@whale:~/github/moby/contrib$ ./mkimage.sh --help
</span><span class='line'>usage: mkimage.sh [-d dir] [-t tag] [--compression algo| --no-compression] script [script-args]
</span><span class='line'>   ie: mkimage.sh -t someuser/debian debootstrap --variant=minbase jessie
</span><span class='line'>       mkimage.sh -t someuser/ubuntu debootstrap --include=ubuntu-minimal --components=main,universe trusty
</span><span class='line'>       mkimage.sh -t someuser/busybox busybox-static
</span><span class='line'>       mkimage.sh -t someuser/centos:5 rinse --distribution centos-5
</span><span class='line'>       mkimage.sh -t someuser/mageia:4 mageia-urpmi --version=4
</span><span class='line'>       mkimage.sh -t someuser/mageia:4 mageia-urpmi --version=4 --mirror=http://somemirror/
</span><span class='line'>staf@whale:~/github/moby/contrib$ </span></code></pre></td></tr></table></div></figure>


<h4>build the image</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>staf@whale:~/github/moby/contrib$ sudo ./mkimage.sh -t stafwag/debian_i386:stretch debootstrap --variant=minbase stretch
</span><span class='line'>[sudo] password for staf: 
</span><span class='line'>+ mkdir -p /var/tmp/docker-mkimage.dY9y9apEoK/rootfs
</span><span class='line'>+ debootstrap --variant=minbase stretch /var/tmp/docker-mkimage.dY9y9apEoK/rootfs
</span><span class='line'>I: Target architecture can be executed
</span><span class='line'>I: Retrieving InRelease 
</span><span class='line'>I: Retrieving Release 
</span><span class='line'>I: Retrieving Release.gpg 
</span><span class='line'>I: Checking Release signature
</span><span class='line'>I: Valid Release signature (key id 067E3C456BAE240ACEE88F6FEF0F382A1A7B6500)
</span><span class='line'>I: Retrieving Packages 
</span><span class='line'>&lt;snip&gt;</span></code></pre></td></tr></table></div></figure>


<h4>Test</h4>

<p>Verify that images is imported.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>staf@whale:~/github/moby/contrib$ docker images
</span><span class='line'>REPOSITORY            TAG                 IMAGE ID            CREATED              SIZE
</span><span class='line'>stafwag/debian_i386   stretch             cb96d1663079        About a minute ago   97.6MB
</span><span class='line'>staf@whale:~/github/moby/contrib$ </span></code></pre></td></tr></table></div></figure>


<p>Run a test docker instance</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>staf@whale:~/github/moby/contrib$ docker run -t -i --rm stafwag/debian_i386:stretch /bin/sh
</span><span class='line'># cat /etc/debian_version 
</span><span class='line'>9.8
</span><span class='line'># </span></code></pre></td></tr></table></div></figure>


<h3>The debootstrap way</h3>

<h4>Make sure that debootstrap is installed</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>staf@ubuntu184:~/github/moby$ sudo apt install debootstrap
</span><span class='line'>Reading package lists... Done
</span><span class='line'>Building dependency tree       
</span><span class='line'>Reading state information... Done
</span><span class='line'>Suggested packages:
</span><span class='line'>  ubuntu-archive-keyring
</span><span class='line'>The following NEW packages will be installed:
</span><span class='line'>  debootstrap
</span><span class='line'>0 upgraded, 1 newly installed, 0 to remove and 0 not upgraded.
</span><span class='line'>Need to get 35,7 kB of archives.
</span><span class='line'>After this operation, 270 kB of additional disk space will be used.
</span><span class='line'>Get:1 http://be.archive.ubuntu.com/ubuntu bionic-updates/main amd64 debootstrap all 1.0.95ubuntu0.3 [35,7 kB]
</span><span class='line'>Fetched 35,7 kB in 0s (85,9 kB/s)    
</span><span class='line'>Selecting previously unselected package debootstrap.
</span><span class='line'>(Reading database ... 163561 files and directories currently installed.)
</span><span class='line'>Preparing to unpack .../debootstrap_1.0.95ubuntu0.3_all.deb ...
</span><span class='line'>Unpacking debootstrap (1.0.95ubuntu0.3) ...
</span><span class='line'>Processing triggers for man-db (2.8.3-2ubuntu0.1) ...
</span><span class='line'>Setting up debootstrap (1.0.95ubuntu0.3) ...
</span><span class='line'>staf@ubuntu184:~/github/moby$ </span></code></pre></td></tr></table></div></figure>


<h4>bootsrap</h4>

<p>Create a directory that will hold the chrooted operating system.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>staf@ubuntu184:~$ mkdir -p dockerbuild/ubuntu
</span><span class='line'>staf@ubuntu184:~/dockerbuild/ubuntu$ </span></code></pre></td></tr></table></div></figure>


<p>Bootstrap.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>staf@ubuntu184:~/dockerbuild/ubuntu$ sudo debootstrap --verbose --include=iputils-ping --arch i386 bionic ./chroot-bionic http://ftp.ubuntu.com/ubuntu/
</span><span class='line'>I: Retrieving InRelease 
</span><span class='line'>I: Checking Release signature
</span><span class='line'>I: Valid Release signature (key id 790BC7277767219C42C86F933B4FE6ACC0B21F32)
</span><span class='line'>I: Validating Packages 
</span><span class='line'>I: Resolving dependencies of required packages...
</span><span class='line'>I: Resolving dependencies of base packages...
</span><span class='line'>I: Checking component main on http://ftp.ubuntu.com/ubuntu...
</span><span class='line'>I: Retrieving adduser 3.116ubuntu1
</span><span class='line'>I: Validating adduser 3.116ubuntu1
</span><span class='line'>I: Retrieving apt 1.6.1
</span><span class='line'>I: Validating apt 1.6.1
</span><span class='line'>I: Retrieving apt-utils 1.6.1
</span><span class='line'>I: Validating apt-utils 1.6.1
</span><span class='line'>I: Retrieving base-files 10.1ubuntu2
</span><span class='line'>&lt;snip&gt;
</span><span class='line'>I: Configuring python3-yaml...
</span><span class='line'>I: Configuring python3-dbus...
</span><span class='line'>I: Configuring apt-utils...
</span><span class='line'>I: Configuring netplan.io...
</span><span class='line'>I: Configuring nplan...
</span><span class='line'>I: Configuring networkd-dispatcher...
</span><span class='line'>I: Configuring kbd...
</span><span class='line'>I: Configuring console-setup-linux...
</span><span class='line'>I: Configuring console-setup...
</span><span class='line'>I: Configuring ubuntu-minimal...
</span><span class='line'>I: Configuring libc-bin...
</span><span class='line'>I: Configuring systemd...
</span><span class='line'>I: Configuring ca-certificates...
</span><span class='line'>I: Configuring initramfs-tools...
</span><span class='line'>I: Base system installed successfully.</span></code></pre></td></tr></table></div></figure>


<h4>Customize</h4>

<p>You can customize your installation before it goes into the image. One thing that you should customize is include update in the image.</p>

<p>Update <code>/etc/resolve.conf</code></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>staf@ubuntu184:~/dockerbuild/ubuntu$ sudo vi chroot-bionic/etc/resolv.conf</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nameserver 9.9.9.9</span></code></pre></td></tr></table></div></figure>


<p>Update <code>/etc/apt/sources.list</code></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>staf@ubuntu184:~/dockerbuild/ubuntu$ sudo vi chroot-bionic/etc/apt/sources.list</span></code></pre></td></tr></table></div></figure>


<p>And include the updates</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>deb http://ftp.ubuntu.com/ubuntu bionic main
</span><span class='line'>deb http://security.ubuntu.com/ubuntu bionic-security main
</span><span class='line'>deb http://ftp.ubuntu.com/ubuntu/ bionic-updates main</span></code></pre></td></tr></table></div></figure>


<p>Chroot into your installation and run <code>apt-get update</code></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>staf@ubuntu184:~/dockerbuild/ubuntu$ sudo chroot $PWD/chroot-bionic
</span><span class='line'>root@ubuntu184:/# apt update
</span><span class='line'>Hit:1 http://ftp.ubuntu.com/ubuntu bionic InRelease
</span><span class='line'>Get:2 http://ftp.ubuntu.com/ubuntu bionic-updates InRelease [88.7 kB]   
</span><span class='line'>Get:3 http://security.ubuntu.com/ubuntu bionic-security InRelease [88.7 kB]       
</span><span class='line'>Get:4 http://ftp.ubuntu.com/ubuntu bionic/main Translation-en [516 kB]                  
</span><span class='line'>Get:5 http://ftp.ubuntu.com/ubuntu bionic-updates/main i386 Packages [492 kB]           
</span><span class='line'>Get:6 http://ftp.ubuntu.com/ubuntu bionic-updates/main Translation-en [214 kB]          
</span><span class='line'>Get:7 http://security.ubuntu.com/ubuntu bionic-security/main i386 Packages [241 kB]     
</span><span class='line'>Get:8 http://security.ubuntu.com/ubuntu bionic-security/main Translation-en [115 kB]
</span><span class='line'>Fetched 1755 kB in 1s (1589 kB/s)      
</span><span class='line'>Reading package lists... Done
</span><span class='line'>Building dependency tree... Done</span></code></pre></td></tr></table></div></figure>


<p>and <code>apt-get upgrade</code></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@ubuntu184:/# apt upgrade
</span><span class='line'>Reading package lists... Done
</span><span class='line'>Building dependency tree... Done
</span><span class='line'>Calculating upgrade... Done
</span><span class='line'>The following NEW packages will be installed:
</span><span class='line'>  python3-netifaces
</span><span class='line'>The following packages will be upgraded:
</span><span class='line'>  apt apt-utils base-files bsdutils busybox-initramfs console-setup console-setup-linux
</span><span class='line'>  distro-info-data dpkg e2fsprogs fdisk file gcc-8-base gpgv initramfs-tools
</span><span class='line'>  initramfs-tools-bin initramfs-tools-core keyboard-configuration kmod libapparmor1
</span><span class='line'>  libapt-inst2.0 libapt-pkg5.0 libblkid1 libcom-err2 libcryptsetup12 libdns-export1100
</span><span class='line'>  libext2fs2 libfdisk1 libgcc1 libgcrypt20 libglib2.0-0 libglib2.0-data libidn11
</span><span class='line'>  libisc-export169 libkmod2 libmagic-mgc libmagic1 libmount1 libncurses5 libncursesw5
</span><span class='line'>  libnss-systemd libpam-modules libpam-modules-bin libpam-runtime libpam-systemd
</span><span class='line'>  libpam0g libprocps6 libpython3-stdlib libpython3.6-minimal libpython3.6-stdlib
</span><span class='line'>  libseccomp2 libsmartcols1 libss2 libssl1.1 libstdc++6 libsystemd0 libtinfo5 libudev1
</span><span class='line'>  libunistring2 libuuid1 libxml2 mount ncurses-base ncurses-bin netcat-openbsd
</span><span class='line'>  netplan.io networkd-dispatcher nplan openssl perl-base procps python3 python3-gi
</span><span class='line'>  python3-minimal python3.6 python3.6-minimal systemd systemd-sysv tar tzdata
</span><span class='line'>  ubuntu-keyring ubuntu-minimal udev util-linux
</span><span class='line'>84 upgraded, 1 newly installed, 0 to remove and 0 not upgraded.
</span><span class='line'>Need to get 26.6 MB of archives.
</span><span class='line'>After this operation, 450 kB of additional disk space will be used.
</span><span class='line'>Do you want to continue? [Y/n] y
</span><span class='line'>Get:1 http://security.ubuntu.com/ubuntu bionic-security/main i386 netplan.io i386 0.40.1~18.04.4 [64.6 kB]
</span><span class='line'>Get:2 http://ftp.ubuntu.com/ubuntu bionic-updates/main i386 base-files i386 10.1ubuntu2.4 [60.3 kB]
</span><span class='line'>Get:3 http://security.ubuntu.com/ubuntu bionic-security/main i386 libapparmor1 i386 2.12-4ubuntu5.1 [32.7 kB]
</span><span class='line'>Get:4 http://security.ubuntu.com/ubuntu bionic-security/main i386 libgcrypt20 i386 1.8.1-
</span><span class='line'>&lt;snip&gt;
</span><span class='line'>running python rtupdate hooks for python3.6...
</span><span class='line'>running python post-rtupdate hooks for python3.6...
</span><span class='line'>Setting up initramfs-tools-core (0.130ubuntu3.7) ...
</span><span class='line'>Setting up initramfs-tools (0.130ubuntu3.7) ...
</span><span class='line'>update-initramfs: deferring update (trigger activated)
</span><span class='line'>Setting up python3-gi (3.26.1-2ubuntu1) ...
</span><span class='line'>Setting up file (1:5.32-2ubuntu0.2) ...
</span><span class='line'>Setting up python3-netifaces (0.10.4-0.1build4) ...
</span><span class='line'>Processing triggers for systemd (237-3ubuntu10.20) ...
</span><span class='line'>Setting up networkd-dispatcher (1.7-0ubuntu3.3) ...
</span><span class='line'>Installing new version of config file /etc/default/networkd-dispatcher ...
</span><span class='line'>Setting up netplan.io (0.40.1~18.04.4) ...
</span><span class='line'>Setting up nplan (0.40.1~18.04.4) ...
</span><span class='line'>Setting up ubuntu-minimal (1.417.1) ...
</span><span class='line'>Processing triggers for libc-bin (2.27-3ubuntu1) ...
</span><span class='line'>Processing triggers for initramfs-tools (0.130ubuntu3.7) ...
</span><span class='line'>root@ubuntu184:/# 
</span><span class='line'>staf@ubuntu184:~/dockerbuild/ubuntu$ </span></code></pre></td></tr></table></div></figure>


<h4>Import</h4>

<p>Go to your chroot installation.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>staf@ubuntu184:~/dockerbuild/ubuntu$ cd chroot-bionic/
</span><span class='line'>staf@ubuntu184:~/dockerbuild/ubuntu/chroot-bionic$ </span></code></pre></td></tr></table></div></figure>


<p>and import the image.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>staf@ubuntu184:~/dockerbuild/ubuntu/chroot-bionic$ sudo tar cpf - . | docker import - stafwag/ubuntu_i386:bionic
</span><span class='line'>sha256:83560ef3c8d48b737983ab8ffa3ec3836b1239664f8998038bfe1b06772bb3c2
</span><span class='line'>staf@ubuntu184:~/dockerbuild/ubuntu/chroot-bionic$ </span></code></pre></td></tr></table></div></figure>


<h4>Test</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>staf@ubuntu184:~/dockerbuild/ubuntu/chroot-bionic$ docker images
</span><span class='line'>REPOSITORY            TAG                 IMAGE ID            CREATED              SIZE
</span><span class='line'>stafwag/ubuntu_i386   bionic              83560ef3c8d4        About a minute ago   315MB
</span><span class='line'>staf@ubuntu184:~/dockerbuild/ubuntu/chroot-bionic$ </span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>staf@ubuntu184:~/dockerbuild/ubuntu/chroot-bionic$ docker run -it --rm stafwag/ubuntu_i386:bionic /bin/bash
</span><span class='line'>root@665cec6ee24f:/# lsb_release -a
</span><span class='line'>No LSB modules are available.
</span><span class='line'>Distributor ID: Ubuntu
</span><span class='line'>Description:    Ubuntu 18.04.2 LTS
</span><span class='line'>Release:        18.04
</span><span class='line'>Codename:       bionic
</span><span class='line'>root@665cec6ee24f:/# </span></code></pre></td></tr></table></div></figure>


<p><strong><em> Have fun! </em></strong></p>

<h1>Links</h1>

<ul>
<li><a href="https://docs.docker.com/docker-hub/official_images/">https://docs.docker.com/docker-hub/official_images/</a></li>
<li><a href="https://docs.docker.com/engine/security/trust/content_trust/">https://docs.docker.com/engine/security/trust/content_trust/</a></li>
</ul>

</div>

<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- blog_actrikel -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-4659298941528586"
     data-ad-slot="7394058542"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">staf wagemakers</span></span>

      




<time class='entry-date' datetime='2019-04-22T10:36:01+02:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>22</span><span class='date-suffix'>nd</span>, <span class='date-year'>2019</span></span> <span class='time'>10:36 am</span></time>
      

<span class="categories">
  
    <a class='category' href='/blog/blog/categories/debian/'>debian</a>, <a class='category' href='/blog/blog/categories/docker/'>docker</a>, <a class='category' href='/blog/blog/categories/security/'>security</a>, <a class='category' href='/blog/blog/categories/ubuntu/'>ubuntu</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="https://stafwag.github.io/blog/blog/2019/04/22/building-your-own-docker-images_part1/" data-via="" data-counturl="https://stafwag.github.io/blog/blog/2019/04/22/building-your-own-docker-images_part1/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
  <span style="overflow: hidden; text-overflow: ellipsis;white-space: nowrap;">
    <script src="//platform.linkedin.com/in.js" type="text/javascript">
    lang: en_US
  </script>
  <script type="IN/Share" data-url="https://stafwag.github.io/blog/blog/2019/04/22/building-your-own-docker-images_part1/" data-counter="right"></script>
  </snap>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/blog/2019/03/03/howto-use-centos-cloud-images-with-cloud-init/" title="Previous Post: Howto use centos cloud images with cloud-init on KVM/libvirtd">&laquo; Howto use centos cloud images with cloud-init on KVM/libvirtd</a>
      
      
        <a class="basic-alignment right" href="/blog/blog/2019/05/05/building-your-own-docker-images-part2/" title="Next Post: Building your own docker images (Part2: Arch GNU/Linux & Co)">Building your own docker images (Part2: Arch GNU/Linux & Co) &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>


</div>

<aside class="sidebar">
  
    <section>
  <h1>About Me</h1>
  <p><a href="http://www.wagemakers.be">http://www.wagemakers.be</a></p>
  <p><a href="http://www.linkedin.com/in/stafwagemakers">LinkedIn profile</a></p>
  <p><a href="https://google.com/+StafWagemakers">Google Plus profile</a></p>
<!-- Place this tag where you want the widget to render. -->
<div class="g-person" data-width="180" data-href="http://google.com/+StafWagemakers" data-showtagline="false" data-showcoverphoto="false" data-rel="author"></div>

<!-- Place this tag after the last widget tag. -->
<script type="text/javascript">
  (function() {
    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    po.src = 'https://apis.google.com/js/plusone.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  })();
</script>
</section>

<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/blog/2019/05/12/building-your-own-docker-base-images-part-3-yum/">Building Your Own Docker Base Images (Part 3: Yum)</a>
      </li>
    
      <li class="post">
        <a href="/blog/blog/2019/05/05/building-your-own-docker-images-part2/">Building Your Own Docker Images (Part2: Arch GNU/Linux & Co)</a>
      </li>
    
      <li class="post">
        <a href="/blog/blog/2019/04/22/building-your-own-docker-images_part1/">Building Your Own Docker Base Images (Part 1: Debian GNU/Linux & Co)</a>
      </li>
    
      <li class="post">
        <a href="/blog/blog/2019/03/03/howto-use-centos-cloud-images-with-cloud-init/">Howto Use Centos Cloud Images With Cloud-init on KVM/libvirtd</a>
      </li>
    
      <li class="post">
        <a href="/blog/blog/2019/02/10/how-to-install-libreboot-on-a-thinkspad-w500/">How to Install Libreboot on a ThinkPad W500</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/stafwag">@stafwag</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'stafwag',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/blog/javascripts/github.js" type="text/javascript"> </script>
</section>





<hr />
<br />
<br />
<br />
<br />
<script type="text/javascript"><!--
google_ad_client = "ca-pub-4659298941528586";
/* blogads_right */
google_ad_slot = "8839948148";
google_ad_width = 160;
google_ad_height = 600;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2019 - staf wagemakers -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'stafwag';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'https://stafwag.github.io/blog/blog/2019/04/22/building-your-own-docker-images_part1/';
        var disqus_url = 'https://stafwag.github.io/blog/blog/2019/04/22/building-your-own-docker-images_part1/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
